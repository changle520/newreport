#连接数据库的配置
[DEFAULT]
dbname_dp=ipharmacare_dp354
dbname_sys=ipharmacare_syscenter354
dbname_knowledge=ipharmacare_knowledge354

[mysql]
host:10.1.1.89
port:3306
username:root
passwd:root
dbname_report:ipharmacare_reportcenter2
charset:utf8

#获取自定义报表中数据库里面的相关内容
[reportsql]
allReportNames:SELECT report_name FROM `report`
reportID:SELECT report_id ,data_dimension_value FROM report WHERE report_name=%%s AND is_deleted=0
reportItemid:SELECT item_id FROM `report_item_relation` WHERE report_id=%%s
allItems:SELECT item_id,item_name FROM `report_item`
esValue:SELECT * FROM {}
dimension_name:SELECT dimension_name FROM `report_data_dimension` WHERE dimension_value IN (SELECT data_dimension_value FROM `report` WHERE report_name=%%s)
business_dimension:SELECT  dimension_name FROM  `report_business_dimension` WHERE dimension_value IN  (SELECT business_dimension_value FROM  `report`   WHERE report_name =%%s)
hospital:SELECT zone_id,dept_id,doc_id,doc_group,product_id,analysis_type,operation_code FROM {}
docname:SELECT username FROM %(dbname_sys)s.`auth_user` WHERE realname = %%s
deptid:SELECT code from %(dbname_sys)s.`medical_dept` where dept_name=%%s
reportDate:SELECT start_date,end_date FROM `report_data_record` WHERE record_id=%%s
esValue_test:SELECT statistic_value FROM %%s where doc_name=%%s
operation_code:SELECT icd9_code FROM `report_operations` WHERE operation_name=%%s
recordid:select record_id from report_data_record where report_id=%%s
columnname:select column_name from information_schema.Columns where table_name='{}'
#zoneid:select zone_id from %(dbname_sys)s.medical_org where zone_name=%%s
zoneid:select zone_id from %(dbname_sys)s.medical_org where zone_id=%%s

#缺省维度+机构 常规指标及对应的SQL
[zone]
急诊省基药金额:SELECT distinct(drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` t1 WHERE t1.zone_id=%%s AND key_time BETWEEN %%s AND %%s and t1.base_drug=2 AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0 )
门诊患者就诊总人次:SELECT COUNT(DISTINCT key_time,Patient_Id,dept_id) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source='门诊' and key_time between %%s and %%s
门诊患者静脉使用抗菌药物处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物输液')  and zone_id=%%s and recipe_source = '门诊' AND key_time BETWEEN %%s	AND %%s
门诊静脉输液处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '输液药物')  and zone_id=%%s and recipe_source = '门诊' AND key_time BETWEEN %%s	AND %%s
门诊患者就诊使用抗菌药物处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物')  and zone_id=%%s and recipe_source = '门诊' AND key_time BETWEEN %%s	AND %%s
门诊患者就诊使用质子泵抑制剂处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '质子泵抑制剂')  and zone_id=%%s and recipe_source = '门诊' AND key_time BETWEEN %%s	AND %%s
门诊使用中药注射剂输液处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '中药注射剂输液药物')  and zone_id=%%s and recipe_source = '门诊' AND key_time BETWEEN %%s	AND %%s
急诊患者就诊总人次:SELECT COUNT(DISTINCT key_time,patient_id,dept_id) FROM %(dbname_dp)s.`opt_recipe` WHERE zone_id=%%s and recipe_source='急诊'and key_time between %%s and %%s
急诊患者静脉使用抗菌药物处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物输液')  and zone_id=%%s and recipe_source = '急诊' AND key_time BETWEEN %%s	AND %%s
急诊患者就诊使用抗菌药物处方人次 :select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物')  and zone_id=%%s and recipe_source = '急诊' AND key_time BETWEEN %%s	AND %%s
急诊静脉输液处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '输液药物')  and zone_id=%%s and recipe_source = '急诊' AND key_time BETWEEN %%s	AND %%s
急诊患者就诊使用质子泵抑制剂处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '质子泵抑制剂')  and zone_id=%%s and recipe_source = '急诊' AND key_time BETWEEN %%s	AND %%s
门急诊患者就诊使用抗菌药物处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物')  and zone_id=%%s and recipe_source in ('门诊','急诊') AND key_time BETWEEN %%s	AND %%s
门急诊患者静脉使用抗菌药物处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物输液')  and zone_id=%%s and recipe_source in ('门诊','急诊') AND key_time BETWEEN %%s	AND %%s
门急诊就诊处方人次:SELECT COUNT(DISTINCT key_time,patient_id,dept_id) FROM ipharmacare_dp354.opt_recipe WHERE zone_id=%%s and recipe_source in ('急诊','门诊') and key_time between %%s and %%s;
出院患者总人次:SELECT COUNT(distinct key_time,event_no) FROM %(dbname_dp)s.`ipt_inpatient` WHERE zone_id=%%s and key_time between %%s and %%s
出院患者使用抗菌药物人次:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者抗菌药物预防使用人次:SELECT COUNT(DISTINCT Key_Time,Event_No) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s and drug_using_aim = '预防'
出院患者中抗菌药物治疗使用人次:SELECT COUNT(DISTINCT Key_Time,Event_No) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s and drug_using_aim = '治疗'
出院患者中使用静脉输液人次:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用质子泵抑制剂的出院总人数:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者预防使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT Key_Time,Event_No) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s and drug_using_aim = '预防'
出院患者使用碳青霉烯类抗菌药物人次:SELECT COUNT(distinct key_time,event_no) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007001004%%%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)  AND Antimicrobial=1
出院患者使用替加环素人次:SELECT COUNT(distinct key_time,event_no) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007004007%%%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用抗真菌药物人次:SELECT COUNT(distinct key_time,event_no) FROM %(dbname_dp)s.`ipt_drug`  WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE t2.drug_code LIKE '001003001005%%%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用特殊级抗菌药物人次:SELECT COUNT(DISTINCT(t1.patient_id)) FROM %(dbname_dp)s.`ipt_inpatient` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No`=t2.`Event_No`  WHERE t1.`Zone_ID`=%%s  AND  t1.key_time BETWEEN %%s AND %%s  AND  t2.Antimicrobial_Level = 3 AND t2.Antimicrobial=1
住院三级警示信息人次数:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=3  and key_date between %%s and %%s
住院四级警示信息人次数:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=4  and key_date between %%s and %%s
住院五级警示信息人次数:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=5  and key_date between %%s and %%s

门诊患者就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM 	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s AND %%s
门诊患者就诊用药总品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s  AND %%s
门诊患者就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s AND %%s
急诊患者就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '急诊' AND t1.key_time BETWEEN %%s AND %%s
急诊患者就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '急诊' AND t1.key_time BETWEEN %%s AND %%s
出院患者使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s
出院患者使用质子泵抑制剂总品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM 	%(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s
出院患者住院总天数:select SUM(if(In_Hospital_Days is not Null,In_Hospital_Days,if(datediff(discharge_date,in_dpet_time)=0,1,datediff(discharge_date,in_dpet_time)))) FROM %(dbname_dp)s.`ipt_inpatient` where zone_id=%%s and key_time  between %%s and %%s
出院患者I类切口手术例次:SELECT COUNT(*) FROM %(dbname_dp)s.`ipt_operation` WHERE  Zone_ID = %%s  AND Operation_Cut_Type = 'Ⅰ' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
I类切口手术预防使用抗菌药物例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s
出院患者预防使用抗菌药物手术例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND t1.Zone_ID = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
I类切口手术前0.5-2.0小时内给药例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND t1.Zone_ID = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 2 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 2 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))
总手术例次:select count(distinct(operation_no)) FROM %(dbname_dp)s.`ipt_operation` where zone_id=%%s and key_time between %%s and %%s
门诊处方总数:SELECT count(DISTINCT(recipe_id)) FROM ipharmacare_dp354.opt_recipe WHERE zone_id =%%s AND recipe_source = '门诊' AND key_time BETWEEN  %%s AND %%s And Recipe_Status!='1' AND recipe_id IN (SELECT DISTINCT(recipe_id)	FROM	ipharmacare_dp354.opt_recipe_drug) and recipe_id not in (select recipe_id from (select recipe_id,sum(Despensing_Num) as sum from  %(dbname_dp)s.opt_recipe_drug group by recipe_id having sum<=0) as rlt) AND recipe_id NOT IN (SELECT DISTINCT	recipe_id	FROM	ipharmacare_dp354.opt_recipe_drug t	WHERE	Cancel_Flag = 1	AND NOT EXISTS (SELECT	Recipe_Id	FROM ipharmacare_dp354.opt_recipe_drug WHERE	Recipe_Id = t.Recipe_Id	AND Cancel_Flag = 0	))



≥14岁患者抗菌药物门诊处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.opt_alertrecipe t1 WHERE t1.age_as_num >= 140000 and t1.recipe_source='门诊'  AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_alertmessage t2 WHERE analysis_type = '自定义分析'  AND analysis_result_type = '抗菌药物' AND t2.zone_id =%%s and t2.key_date between %%s and %%s)  and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
＜14岁患者抗菌药物门诊处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.opt_alertrecipe t1 WHERE t1.age_as_num < 140000  AND t1.recipe_source='门诊' and t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_alertmessage t2 WHERE analysis_type = '自定义分析'  AND analysis_result_type = '抗菌药物' AND t2.zone_id =%%s and t2.key_date between %%s and %%s) and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门诊静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '输液药物'  AND zone_id = %%s   AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊')  AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数（≥14岁）:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source = '门诊')   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_alertrecipe`  WHERE age_as_num >= 140000) AND key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门诊抗菌药物静脉输液处方数（＜14岁）:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source = '门诊')   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_alertrecipe`  WHERE age_as_num < 140000) AND key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门诊抗菌药物静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊') AND key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门诊中药注射剂输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药注射剂输液'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id  FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊') AND key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门诊抗菌药物处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊') AND key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
三级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
四级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
五级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
急诊静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '输液药物'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s. `opt_recipe`   WHERE recipe_source = '急诊') and  key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
急诊抗菌药物静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物输液'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊') and  key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
急诊抗菌药物处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊') and  key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门急诊静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '输液药物'   AND zone_id =%%s  AND  key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门急诊抗菌药物静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id =%%s  AND  key_date between %%s and %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门诊药品总品规数:SELECT COUNT(DISTINCT drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID = %%s and Key_Time between %%s and %%s and recipe_id in (select recipe_id FROM %(dbname_dp)s.`opt_recipe` where recipe_source='门诊')
门诊静脉输液药品品规数:SELECT COUNT(DISTINCT t1.drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '输液药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s AND %%s
住院药品总品规数:SELECT COUNT(DISTINCT drug_id) FROM %(dbname_dp)s.`ipt_drug` WHERE  Zone_ID = %%s AND Key_Time between %%s and %%s
门诊三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and t1.key_date between %%s and %%s
门诊四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and t1.key_date between %%s and %%s
门诊五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and t1.key_date between %%s and %%s
门诊所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.key_date between %%s and %%s
住院三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and t1.key_date between %%s and %%s
住院四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and t1.key_date between %%s and %%s
住院五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and t1.key_date between %%s and %%s
住院所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.key_date between %%s and %%s
门诊患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM	%(dbname_dp)s.`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '抗菌药物' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE	recipe_source ='门诊') AND key_time BETWEEN %%s AND %%s
出院患者中联合使用抗菌药物人次:SELECT COUNT(DISTINCT key_date,event_no) FROM  %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物联用'   AND zone_id = %%s  AND event_no IN   (SELECT event_no FROM  %(dbname_dp)s.`ipt_inpatient`  WHERE key_time BETWEEN %%s AND %%s)
门诊患者单次就诊用药品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s  AND %%s
门诊患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s AND %%s
门诊患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s AND %%s
急诊患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '急诊' AND t1.key_time BETWEEN %%s AND %%s
急诊患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source = '急诊' AND t1.key_time BETWEEN %%s AND %%s
住院患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.event_no,t3.drug_name) FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s
住院患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.event_no,t3.drug_name) FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s
门诊患者就诊使用中药饮片的处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '中药饮片')  and zone_id=%%s and recipe_source = '门诊' AND key_time BETWEEN %%s	AND %%s
急诊患者就诊使用中药饮片的处方人次:select count(DISTINCT key_time,patient_id,dept_id) from %(dbname_dp)s.`opt_recipe` WHERE recipe_id in (select recipe_id from %(dbname_dp)s.opt_alertmessage WHERE analysis_type = '自定义分析' AND analysis_result_type = '中药饮片')  and zone_id=%%s and recipe_source = '急诊' AND key_time BETWEEN %%s	AND %%s

急诊处方总数:SELECT count(DISTINCT(recipe_id)) FROM ipharmacare_dp354.opt_recipe WHERE zone_id =%%s AND recipe_source = '急诊' AND key_time BETWEEN  %%s AND %%s And Recipe_Status!='1' AND recipe_id IN (SELECT DISTINCT(recipe_id)	FROM	ipharmacare_dp354.opt_recipe_drug) and recipe_id not in (select recipe_id from (select recipe_id,sum(Despensing_Num) as sum from %(dbname_dp)s.opt_recipe_drug group by recipe_id having sum<=0) as rlt) AND recipe_id NOT IN (SELECT DISTINCT	recipe_id	FROM	ipharmacare_dp354.opt_recipe_drug t	WHERE	Cancel_Flag = 1	AND NOT EXISTS (SELECT	Recipe_Id	FROM ipharmacare_dp354.opt_recipe_drug WHERE	Recipe_Id = t.Recipe_Id	AND Cancel_Flag = 0	))
门急诊处方总数:SELECT count(DISTINCT(recipe_id)) FROM ipharmacare_dp354.opt_recipe WHERE zone_id =%%s AND recipe_source in ( '门诊','急诊') AND key_time BETWEEN  %%s AND %%s And Recipe_Status!='1' AND recipe_id IN (SELECT DISTINCT(recipe_id)	FROM	ipharmacare_dp354.opt_recipe_drug) and recipe_id not in (select recipe_id from (select recipe_id,sum(Despensing_Num) as sum from %(dbname_dp)s.opt_recipe_drug group by recipe_id having sum<=0) as rlt) AND recipe_id NOT IN (SELECT DISTINCT	recipe_id	FROM	ipharmacare_dp354.opt_recipe_drug t	WHERE	Cancel_Flag = 1	AND NOT EXISTS (SELECT	Recipe_Id	FROM ipharmacare_dp354.opt_recipe_drug WHERE	Recipe_Id = t.Recipe_Id	AND Cancel_Flag = 0	))

急诊草药方处方数量:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '急诊')   AND key_date BETWEEN %%s AND %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门急诊草药方处方数量:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source in ('门诊','急诊'))   AND key_date BETWEEN %%s AND %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
门诊草药方处方总数:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '门诊')   AND key_date BETWEEN %%s AND %%s
门诊中药饮片总帖数:SELECT SUM(herb_packet_count) FROM %(dbname_dp)s.`opt_recipe` WHERE Recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%%%' AND t1.`is_ignore` =0 ))  AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
门诊中药饮片总味数:SELECT count(DISTINCT Key_Time,drug_name) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '中药饮片' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE	recipe_source ='门诊') AND key_time BETWEEN %%s AND %%s
最高处方金额:SELECT MAX(Recipe_Fee_Total) FROM %(dbname_dp)s.`opt_recipe` WHERE Zone_ID =%%s AND Key_Time between %%s and %%s
出院患者最高用药金额:select max(drug_money) from (select event_no,sum(price*despensing_num) as drug_money from  %(dbname_dp)s.`ipt_drug` where zone_id=%%s and Key_Time between %%s and %%s group by event_no) as drugmoney
术后使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1   AND t1.`Operation_Cut_Type` = 'Ⅰ' AND t2.zone_id=%%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>=0*60*60))
I类切口手术预防使用抗菌药物时间≤24小时:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No  WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s AND t1.Key_Time between %%s and %%s AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞24h且≤48h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 48 * 60 * 60)) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞48h且≤72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >48 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >72 * 60 * 60 )) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防'
术前24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` = 'Ⅰ'  AND t2.zone_id = %%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(operation_start_time,Invalid_Time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(operation_start_time,valid_time))>0*60*60))
术后24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` = 'Ⅰ'  AND t2.zone_id = %%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(valid_time,operation_end_time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>0*60*60))
收费前药师审核处方数:SELECT COUNT(Recipe_id) FROM %(dbname_dp)s.`opt_recipe` WHERE ((TIME_TO_SEC(TIMEDIFF(fee_taken_time,check_time))>0*60*60)) AND zone_id=%%s AND key_time BETWEEN %%s AND %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))

门诊总收入:SELECT sum(Fee_Total) FROM %(dbname_dp)s.`opt_fee` where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s and fee_form_no in (select fee_form_no FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
急诊总收入:SELECT sum(Fee_Total) FROM %(dbname_dp)s.`opt_fee` where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s and fee_form_no in (select fee_form_no FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
住院总收入:SELECT sum(Fee_Total) FROM %(dbname_dp)s.ipt_inpatient where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s

住院患者静脉输液使用量（瓶/袋）:SELECT sum(Despensing_Num*IFNULL(herb_packet_count,1)) FROM %(dbname_dp)s.`ipt_drug` WHERE Order_ID IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM 	%(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1) WHERE 	a.analysis_type = '自定义分析' 	AND a.analysis_result_type = '输液药物' ORDER BY 	a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s
门诊患者静脉输液使用量（瓶/袋）:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '输液药物' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE	recipe_source ='门诊') AND key_time BETWEEN %%s AND %%s
门诊患者使用质子泵抑制剂费用:SELECT SUM(price * Despensing_Num) FROM	%(dbname_dp)s.`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '质子泵抑制剂' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE	recipe_source ='门诊') AND key_time BETWEEN %%s AND %%s
门诊静脉输液药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '输液药物' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE	recipe_source ='门诊') AND key_time BETWEEN %%s AND %%s
门诊输液药物输液总量:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '输液药物' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE	recipe_source ='门诊') AND key_time BETWEEN %%s AND %%s
门诊患者使用药物总费用:select sum(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` where zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊') and key_time between %%s and %%s
急诊患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM	%(dbname_dp)s.`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '抗菌药物' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE	recipe_source ='急诊') AND key_time BETWEEN %%s AND %%s
急诊患者使用质子泵抑制剂费用:SELECT SUM(price * Despensing_Num) FROM	%(dbname_dp)s.`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '质子泵抑制剂' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE	recipe_source ='急诊') AND key_time BETWEEN %%s AND %%s
出院患者使用抗菌药物费用:SELECT	SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'		ORDER BY	a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s;
出院患者使用质子泵抑制剂总费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s;
门诊患者使用中药饮片总费用:SELECT SUM(t1.price * t1.Despensing_Num) FROM %(dbname_dp)s.opt_recipe t2 LEFT JOIN %(dbname_dp)s.`opt_recipe_drug` t1 on t1.recipe_id=t2.recipe_id WHERE 	t1.id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1 ),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '') ) + 1) WHERE a.analysis_type = '自定义分析' 	AND a.analysis_result_type = '中药饮片' 	ORDER BY 	a.id ) AND t1.zone_id = %%s AND t1.key_time BETWEEN %%s AND %%s AND t2.recipe_source = '门诊'
急诊患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE  t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '急诊' ) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
急诊患者使用中药饮片总费用:SELECT SUM(t1.price * t1.Despensing_Num) FROM %(dbname_dp)s.opt_recipe t2 LEFT JOIN %(dbname_dp)s.`opt_recipe_drug` t1 on t1.recipe_id=t2.recipe_id WHERE 	t1.id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1 ),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '') ) + 1) WHERE a.analysis_type = '自定义分析' 	AND a.analysis_result_type = '中药饮片' 	ORDER BY 	a.id ) AND t1.zone_id = %%s AND t1.key_time BETWEEN %%s AND %%s AND t2.recipe_source = '急诊'
出院患者用药总金额:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE t1.`is_ignore` =0 ) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
住院患者使用中药饮片总费用:SELECT sum(price*Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE Order_ID IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM 	%(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1) WHERE 	a.analysis_type = '自定义分析' 	AND a.analysis_result_type = '中药饮片' ORDER BY 	a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s

门诊患者使用国家基药人次:SELECT COUNT(DISTINCT key_time,patient_id,dept_id) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source='门诊' and key_time between %%s and %%s and recipe_id in (select DISTINCT  recipe_id from %(dbname_dp)s.opt_recipe_drug where base_drug=1)
门诊患者国家基药品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s  AND %%s and t1.base_drug=1
门诊患者国家基药总金额:SELECT SUM(Price * Despensing_Num) AS Total_Money FROM %(dbname_dp)s.opt_recipe_drug t0 INNER JOIN %(dbname_dp)s.`opt_recipe` t ON t0.recipe_id = t.recipe_id WHERE t0.Zone_Id = %% s AND t0.Key_Time BETWEEN %% s AND %% s AND t0.base_drug=1
出院患者国家基药品种数:SELECT	COUNT(DISTINCT t3.drug_name) FROM	%(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.Zone_ID = %%s AND t1.key_time BETWEEN %%s AND %%s AND t1.base_drug = 1
出院患者药品累计品种数:SELECT	COUNT(DISTINCT t3.drug_name) FROM	%(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.Zone_ID = %%s AND t1.key_time BETWEEN %%s AND %%s
出院患者国家基药总金额:SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.ipt_drug WHERE Zone_Id = %%s AND Key_Time between %%s and %%s AND base_drug=1
出院患者使用国家基药总人次:SELECT COUNT(distinct key_time,event_no) FROM %(dbname_dp)s.`ipt_inpatient` WHERE zone_id=%%s and key_time between %%s and %%s and event_no in (select event_no from %(dbname_dp)s.ipt_drug where base_drug=1)
出院患者使用国家基药总人次_test:select event_no from (SELECT distinct key_time,event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE zone_id=%%s and key_time between %%s and %%s and event_no in (select event_no from %(dbname_dp)s.ipt_drug where base_drug=1)) as rlt

门诊输液总人次（≥14岁）:SELECT COUNT(DISTINCT patient_id,hos_dept_id) FROM 	%(dbname_dp)s.opt_alertrecipe t1 WHERE 	t1.age_as_num >= 140000 AND t1.recipe_source = '门诊' AND t1.recipe_id IN (	SELECT 	recipe_id FROM %(dbname_dp)s.opt_alertmessage t2 	WHERE analysis_type = '自定义分析' 	AND analysis_result_type = '输液药物' AND t2.zone_id =%% s AND t2.key_date BETWEEN %% s AND %% s)
门诊输液总人次（＜14岁）:SELECT COUNT(DISTINCT patient_id,hos_dept_id) FROM 	%(dbname_dp)s.opt_alertrecipe t1 WHERE 	t1.age_as_num < 140000 AND t1.recipe_source = '门诊' AND t1.recipe_id IN (	SELECT 	recipe_id FROM %(dbname_dp)s.opt_alertmessage t2 	WHERE analysis_type = '自定义分析' 	AND analysis_result_type = '输液药物' AND t2.zone_id =%% s AND t2.key_date BETWEEN %% s AND %% s)
出院患者使用输液药物总金额:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '输液药物'	ORDER BY a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s;
住院输液药物输液总量:SELECT	SUM(Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '输液药物'	ORDER BY a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s;
出院患者抗菌药物输液总人次:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用抗菌药物输液金额:SELECT	SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物输液'		ORDER BY	a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s;
门诊中药饮片处方总数:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '门诊')   AND key_date BETWEEN %%s AND %%s and recipe_id not in(select DISTINCT recipe_id from %(dbname_dp)s.opt_recipe_drug t where Cancel_Flag=1 and not EXISTS(select Recipe_Id from %(dbname_dp)s.opt_recipe_drug where Recipe_Id=t.Recipe_Id and Cancel_Flag=0))
出院患者使用中药饮片人次数:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='中药饮片' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
门急诊处方药品总金额:select sum(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` where zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source in ('门诊','急诊')) and key_time between %%s and %%s
门急诊质子泵品规数:SELECT COUNT(DISTINCT t1.drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id = t4.recipe_id WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t4.recipe_source  in( '门诊','急诊') AND t1.key_time BETWEEN %%s AND %%s
出院患者质子泵品规数:SELECT count(DISTINCT t1.drug_id) FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s
手术前0.5-1.0小时内给药例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No WHERE t2.Antimicrobial =1  AND t1.Zone_ID = %%s   AND t1.Key_Time BETWEEN %%s AND %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 1 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 1 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 1 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 1 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))
手术预防使用抗菌药物时间≤24小时例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No  WHERE t2.Antimicrobial =1 AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s AND t1.Key_Time between %%s and %%s AND t2.Drug_Using_Aim = '预防'
I类切口手术前0.5-1.0小时内给药例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 1 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 1 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 1 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 1 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))
I类切口手术预防使用抗菌药物时间≤24小时例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No  WHERE t2.Antimicrobial =1  AND t1.Operation_Cut_Type='Ⅰ' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s AND t1.Key_Time between %%s and %%s AND t2.Drug_Using_Aim = '预防'
门诊抗菌药物品规数:SELECT count(DISTINCT t1.drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s
出院患者限制级抗菌药物使用人次数:SELECT COUNT(DISTINCT Key_Time,Event_No) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s and Antimicrobial_Level = 2
出院患者使用非限制级抗菌药物人次:SELECT COUNT(DISTINCT Key_Time,Event_No) FROM %(dbname_dp)s.`ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	%(dbname_dp)s.ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY a.id) AND zone_id =%%s AND key_time BETWEEN %%s AND %%s and Antimicrobial_Level = 1
出院患者中联合使用抗菌药物人次:SELECT COUNT(distinct key_date,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物联用' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
I类切口手术前0.5-1.0小时内抗菌药物给药例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND t2.Drug_Using_Aim = '预防' AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 1 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 1 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 1 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 1 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))

[zone_ddds]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
self_values_ddd:select product_id,VALUE,unit from %(dbname_knowledge)s.tb_product_extend where owner=0 and type='DDD'
self_values_trans:select product_id,VALUE,unit from %(dbname_knowledge)s.tb_product_extend where owner=0 and type='TRANS'
product_ddd:select product_id,VALUE,unit from %(dbname_knowledge)s.tb_product_extend where owner=-1 and type='DDD'
product_trans:select product_id,VALUE,unit from %(dbname_knowledge)s.tb_product_extend where owner=-1 and type='TRANS'
门诊抗菌药物累计DDD数:SELECT  t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2     ON t1.recipe_id = t2.recipe_id   INNER JOIN %(dbname_knowledge)s.`base_product` t3     ON t1.drug_id = t3.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t4     ON t3.map_product_id = t4.id WHERE t1.zone_id =%%s  AND t1.Key_Time BETWEEN %%s  AND %%s  AND t1.Antimicrobial = 1   AND t2.recipe_source = '门诊'
急诊患者抗菌药物使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id =%%s  AND t1.Key_Time between %%s and %%s  AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'
急诊碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2   ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.id =t5.product_id WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'  AND t5.drug_code LIKE '001003001007001004002%%%%'
急诊药品使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='急诊'
出院患者抗菌药物使用量（累计DDD数）（非出院带药）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1  AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1  AND t1.Key_Time BETWEEN %%s AND %%s
出院患者特殊使用级抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit   FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 and t1.`Antimicrobial_Level`=3 AND t1.Key_Time BETWEEN %%s AND %%s
出院患者质子泵抑制剂药物使用量（累计DDD数）:SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t4  ON t3.id = t4.product_id  WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 AND t1.key_time BETWEEN %%s AND %%s   AND t4.analysis_type = '自定义分析'   AND t4.analysis_result_type = '质子泵抑制剂'   AND t1.Order_Type != '出院带药'
住院患者碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2   ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4    ON t3.id = t4.product_id WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 AND key_time BETWEEN %%s AND %%s  AND t4.drug_code LIKE '001003001007001004%%%%'
住院患者替加环素使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2     ON t1.drug_id = t2.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4   ON t3.id = t4.product_id  WHERE t1.zone_id = %%s AND key_time BETWEEN %%s AND %%s AND  t4.drug_code LIKE "001003001007004007%%%%"
住院患者抗真菌药物使用量（累计DDD数):SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id  WHERE t1.zone_id = %%s AND key_time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1   AND t4.drug_code LIKE "001003001005%%%%"
住院药品使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 AND t1.Key_Time BETWEEN %%s AND %%s
急诊消耗总克数:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1  AND t3.map_product_id=%%s and t2.recipe_source='急诊'
门诊消耗总克数:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1  AND t3.map_product_id=%%s and t2.recipe_source='门诊'
住院消耗总克数:SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit,t1.qty,t1.qty_unit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1 AND t2.map_product_id=%%s
出院患者限制级抗菌药物使用量（累计DDD数）（不含出院带药）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit   FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 and t1.`Antimicrobial_Level`=2 AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者特殊级抗菌药物使用量（累计DDD数）（不含出院带药）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit   FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 and t1.`Antimicrobial_Level`=3 AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者非限制级抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit   FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 and t1.`Antimicrobial_Level`=1 AND t1.Key_Time BETWEEN %%s AND %%s
出院患者非限制级抗菌药物使用量（累计DDD数）（不含出院带药）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit   FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 and t1.`Antimicrobial_Level`=1 AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'


#缺省维度+机构 全院使用量指标及对应的SQL
[hospital_ddds]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
self_values_ddd:select product_id,VALUE,unit from tb_product_extend where owner=0 and type='DDD'
self_values_trans:select product_id,VALUE,unit from tb_product_extend where owner=0 and type='TRANS'
product_ddd:select product_id,VALUE,unit from tb_product_extend where owner=-1 and type='DDD'
product_trans:select product_id,VALUE,unit from tb_product_extend where owner=-1 and type='TRANS'
全院抗菌药物使用量:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 UNION ALL SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1)  rlt
全院特殊级抗菌药物使用量:SELECT * FROM (SELECT SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t1.`Antimicrobial_Level`=3 UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t1.`Antimicrobial_Level`=3)  rlt
全院注射剂型抗菌药物使用量（累计DDD数）:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit  FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t4.formulation='注射剂' UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t3.formulation='注射剂')  rlt
全院口服型抗菌药物使用量（累计DDD数）:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit  FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t4.formulation='肠胃道给药' UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t3.formulation='肠胃道给药')  rlt
消耗总克数:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t3.map_product_id=%%s UNION ALL SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1 AND t2.map_product_id=%%s)  rlt
全院患者使用数量:select sum(num) from (SELECT SUM(Despensing_Num) as num FROM %(dbname_dp)s.`ipt_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s) union SELECT SUM(Despensing_Num) as num FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s)) as rlt
全院患者使用频次:SELECT SUM(drugCount) from (SELECT COUNT(*) AS drugCount FROM  %(dbname_dp)s.`opt_recipe_drug` t WHERE t.Zone_ID = %%s  AND t.Key_Time BETWEEN %%s AND %%s AND t.Drug_ID IN (SELECT  b.product_id  FROM %(dbname_knowledge)s.`base_product` b WHERE b.map_product_id=%%s) UNION ALL SELECT COUNT(*) AS drugCount FROM  %(dbname_dp)s.`ipt_drug` t WHERE t.Zone_ID = %%s  AND t.Key_Time BETWEEN %%s AND %%s AND t.Drug_ID IN (SELECT  b.product_id  FROM %(dbname_knowledge)s.`base_product` b WHERE b.map_product_id=%%s)) AS result



#计算指标及对应的计算公式（两个指标相除）
[item_calc]

#731版本新增计算指标
使用抗菌药物出院患者中病原学检查送检人次占比:使用抗菌药物出院患者中病原学检查送检人次/出院患者使用抗菌药物人次
出院患者中抗菌药物治疗使用前病原学检查送检人次占比:出院患者中抗菌药物治疗使用前病原学检查送检人次/出院患者使用抗菌药物人次
使用非限制级抗菌药物出院患者中病原学检查送检人次占比:使用非限制级抗菌药物出院患者中病原学检查送检人次/出院患者使用抗菌药物人次
使用限制级抗菌药物出院患者中病原学检查送检人次占比:使用限制级抗菌药物出院患者中病原学检查送检人次/出院患者使用抗菌药物人次
使用特殊级抗菌药物出院患者中病原学检查送检人次占比:使用特殊级抗菌药物出院患者中病原学检查送检人次/出院患者使用抗菌药物人次
门诊患者国家基药品种数占比:门诊患者国家基药品种数/门诊患者用药总品种数
门诊患者国家基药总金额占比:门诊患者国家基药总金额/门诊处方药品总金额
门诊患者使用国家基药人次占比:门诊患者使用国家基药人次/门诊患者就诊总人次
出院患者国家基药品种数占比:出院患者国家基药品种数/出院患者药品累计品种数
出院患者国家基药总金额占比:出院患者国家基药总金额/出院患者使用药物总金额
出院患者使用国家基药总人次占比:出院患者使用国家基药总人次/出院患者总人次
门诊输液人次(≥14岁)占比:门诊输液总人次(≥14岁)/门诊患者就诊总人次
门诊输液人次占比:门诊输液总人次/门诊患者就诊总人次
门诊输液总人次(＜14岁)占比:门诊输液总人次(＜14岁)/门诊患者就诊总人次|
出院患者抗菌药物输液总人次占比:出院患者抗菌药物输液总人次/住院患者静脉输液总人次
出院患者使用抗菌药物输液金额占比:出院患者使用抗菌药物输液金额/出院患者使用输液药物总金额|
出院患者抗菌药物静脉输液使用量(瓶/袋)占比:出院患者抗菌药物静脉输液使用量(瓶/袋)/门诊患者静脉输液使用量(瓶/袋)
门诊平均处方药品品规数:门诊药品总品规数/门诊处方总数
门诊人均药品品规数:门诊药品总品规数/门诊处方人次
门诊平均处方药品金额:门诊处方药品总金额/门诊处方总数
门诊人均药品金额:门诊处方药品总金额/门诊处方人次
出院患者抗菌药物限制级使用人次数占比:出院患者抗菌药物限制级使用人次数/出院患者总人次(排除中药饮片)
门诊抗菌药物处方数占比:门诊抗菌药物处方数/门诊处方总数(排除中药饮片)
门诊中药饮片平均处方药品金额:门诊患者使用中药饮片总费用/门诊中药饮片处方总数
门诊中药饮片人均药品金额:门诊患者使用中药饮片总费用/门诊中药饮片处方人次
出院患者平均住院天数:出院患者住院总天数/出院患者总人次
出院患者人均药品品规数:住院药品总品规数/出院患者总人次
出院患者使用中药饮片人次数占比:出院患者使用中药饮片人次数/出院患者总人次
出院患者使用中药饮片总金额占比:出院患者使用中药饮片总金额/出院患者用药总金额
门诊人均抗菌药物品规数:门诊抗菌药物品规数/门诊处方人次（排除中药饮片）
出院患者使用特殊级抗菌药物人次占比:出院患者特殊级抗菌药物使用人次数/出院患者总人次(排除中药饮片)
出院患者使用非限制级抗菌药物人次占比:出院患者使用非限制级抗菌药物人次/出院患者总人次(排除中药饮片)
出院患者抗菌药物预防使用率:出院患者抗菌药物预防使用人次/出院患者总人次(排除中药饮片)
出院患者抗菌药物治疗使用率:出院患者中抗菌药物治疗使用人次/出院患者总人次(排除中药饮片)
出院患者抗菌药物联合用药率:出院患者中联合使用抗菌药物人次/出院患者总人次(排除中药饮片)
手术预防使用抗菌药物时间≤24小时例次占比:I类切口手术预防使用抗菌药物时间≤24小时例次/总手术例次
抗菌药物在门诊处方的比例(%):门诊抗菌药物处方数/门诊处方总数(排除中药饮片)
门诊次均药费:门诊处方药品总金额/门诊患者就诊总人次
出院患者次均药费:出院患者用药总金额/出院患者总人次
门诊去年同期次均药费:门诊去年同期药品金额/门诊去年同期就诊人次数
去年同期平均住院天数:出院患者去年同期住院天数/去年同期出院患者总人次
出院患者去年同期次均药费:出院患者用药总金额/出院患者总人次


门诊质子泵使用处方人次占比:门诊质子泵使用处方人次/门急诊处方人次(排除中药饮片)
急诊质子泵使用处方人次占比:急诊质子泵使用处方人次/门急诊处方人次(排除中药饮片)
门诊质子泵费用占比:门诊质子泵费用/门急诊处方药品总金额(排除中药饮片)
急诊质子泵费用占比:急诊质子泵费用/门急诊处方药品总金额(排除中药饮片)
出院患者质子泵总费用占比:出院患者质子泵总费用/出院患者用药总金额(排除中药饮片)
出院患者预防使用抗菌药物手术例次占比:出院患者预防使用抗菌药物手术例次/总手术例次
手术前0.5-1.0小时内给药例次占比:手术前0.5-1.0小时内给药例次/总手术例次
手术预防使用抗菌药物疗程≤24小时占比:手术预防使用抗菌药物时间≤24小时例次/总手术例次
I类切口手术预防使用抗菌药物例次占比:I类切口手术预防使用抗菌药物例次/出院患者I类切口手术例次
原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次占比:原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次/出院患者I类切口手术例次
I类切口手术预防使用抗菌药物品种选择符合指南例次占比:I类切口手术前0.5-1.0小时内抗菌药物给药例次/|出院患者I类切口手术例次
国家基药目录品种使用金额比例(%):国家基药目录品种使用金额/医疗药品总收入
门诊处方平均金额:门诊处方药品总金额/门诊处方人次
出院患者使用抗菌药物金额占比:出院患者使用抗菌药物金额/出院患者用药总金额(排除中药饮片)
出院患者总人次（排除中药饮片）占比:出院患者总人次(排除中药饮片)/出院患者总人次
出院患者用药总金额（排除中药饮片）占比:出院患者用药总金额（排除中药饮片）/出院患者总人次

门诊就诊使用抗菌药物的百分率:门诊患者就诊使用抗菌药物处方人次/门诊患者就诊总人次
门诊静脉输液使用百分率:门诊静脉输液处方人次/门诊患者就诊总人次
门诊患者抗菌药物静脉使用人次占比:门诊患者静脉使用抗菌药物处方人次/门诊患者就诊使用抗菌药物处方人次
门诊患者质子泵抑制剂处方人次比例:门诊患者就诊使用质子泵抑制剂处方人次/门诊患者就诊使用药物处方人次(不含中药饮片)
门诊使用中药注射剂输液处方人次比例:门诊使用中药注射剂输液处方人次/门诊患者就诊总人次
急诊就诊使用抗菌药物的百分率:急诊患者就诊使用抗菌药物处方人次/急诊患者就诊总人次
急诊静脉输液使用百分率:急诊患者就诊使用抗菌药物处方人次/急诊患者就诊总人次
急诊患者抗菌药物静脉使用人次占比:急诊患者静脉使用抗菌药物处方人次/急诊患者就诊使用抗菌药物处方人次
急诊患者质子泵抑制剂处方人次比例:急诊患者就诊使用质子泵抑制剂处方人次/急诊患者就诊使用药物处方人次(不含中药饮片)
门急诊患者抗菌药物静脉使用人次占比:门急诊患者静脉使用抗菌药物处方人次/门急诊患者就诊使用抗菌药物处方人次
住院患者静脉输液使用百分率:出院患者中使用静脉输液人次/出院患者总人次
住院患者联合使用抗菌药物占比:出院患者中联合使用抗菌药物人次/出院患者使用抗菌药物人次

门诊抗菌药物费用占比:门诊患者使用抗菌药物费用/门诊患者使用药物总费用（排除中药饮片）
门诊静脉输液药物费用占比:门诊静脉输液药物费用/门诊患者使用药物总费用
急诊抗菌药物费用占比:急诊患者使用抗菌药物费用/急诊患者使用药物总费用(排除中药饮片）
住院患者抗菌药物费用占比:出院患者使用抗菌药物费用/出院患者使用药物总费用(排除中药饮片）
清洁手术预防使用抗菌药物比例:I类切口手术预防使用抗菌药物例次/出院患者I类切口手术例次
原则上不需要预防使用抗菌药物的清洁手术预防使用抗菌药物比例:原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次/原则上不需要预防使用抗菌药物I类切口手术例次
清洁手术预防使用抗菌药物品种选择合理率:I类切口手术预防使用抗菌药物品种选择合理例次/I类切口手术预防使用抗菌药物例次
抗菌药物处方在门诊处方的比例（≥14岁患者）:≥14岁患者抗菌药物门诊处方数/门诊处方总数
抗菌药物处方在门诊处方的比例（＜14岁患者）:＜14岁患者抗菌药物门诊处方数/门诊处方总数
门诊患者抗菌药物处方占比:门诊抗菌药物处方数/门诊处方总数（排除中药饮片）

急诊抗菌药物处方数占比:急诊抗菌药物处方数/急诊处方总数（排除中药饮片）
门诊质子泵抑制剂费用占比:门诊患者使用质子泵抑制剂费用/门诊患者使用药物总费用（排除中药饮片）
急诊质子泵抑制剂费用占比:急诊患者使用质子泵抑制剂费用/急诊患者使用药物总费用(排除中药饮片）
住院患者人均使用质子泵抑制剂百分率:出院患者使用质子泵抑制剂的出院总人数/出院患者总人次
住院质子泵抑制剂费用占比:出院患者使用质子泵抑制剂总费用/出院患者使用药物总费用(排除中药饮片）
住院质子泵抑制剂预防用药百分率:出院患者预防使用质子泵抑制剂的出院总人数/出院患者使用质子泵抑制剂的出院总人数
急诊患者碳青霉烯类抗菌药物使用量占比:急诊碳青霉烯类抗菌药物使用量（累计DDD数）/急诊患者抗菌药物使用量
住院患者特殊使用级抗菌药物使用量占比:出院患者特殊使用级抗菌药物使用量（累计DDD数）/出院患者抗菌药物使用量（累计DDD数）
门诊静脉输液处方占比:门诊静脉输液处方数/门诊处方总数（排除中药饮片）
门诊抗菌药物静脉输液处方占比（≥14岁）:门诊抗菌药物静脉输液处方数（≥14岁）/门诊处方总数（排除中药饮片）
门诊抗菌药物静脉输液处方占比（＜14岁）:门诊抗菌药物静脉输液处方数（＜14岁）/门诊处方总数（排除中药饮片）
门诊抗菌药物静脉输液处方占比:门诊抗菌药物静脉输液处方数/门诊处方总数（排除中药饮片）
门诊中药注射剂输液处方占比:门诊中药注射剂输液处方数/门诊处方总数
急诊静脉输液处方占比:急诊静脉输液处方数/急诊处方总数（排除中药饮片）
急诊抗菌药物静脉输液处方占比:急诊抗菌药物静脉输液处方数/急诊处方总数（排除中药饮片）
门急诊静脉输液处方占比:门急诊静脉输液处方数/门急诊处方总数（排除中药饮片）
门急诊抗菌药物静脉输液处方占比:门急诊抗菌药物静脉输液处方数/门急诊处方总数（排除中药饮片）
门诊静脉输液药品品规占比:门诊静脉输液药品品规数/门诊药品总品规数
门诊病人均次药品费:门诊患者使用药物总费用（排除中药饮片）/门诊患者就诊总人次
门诊患者人均用药品种数:门诊患者单次就诊用药品种数/门诊患者就诊总人次
门诊患者处方人均使用抗菌药物品种数:门诊患者单次就诊使用抗菌药物累计品种数/门诊患者就诊使用抗菌药物处方人次
门诊患者处方人均使用质子泵抑制剂品种数:门诊患者单次就诊使用质子泵抑制剂品种数/门诊患者就诊使用质子泵抑制剂处方人次
急诊病人均次药品费:急诊患者使用药物总费用(排除中药饮片）/急诊患者就诊总人次
急诊患者处方人均使用抗菌药物品种数:急诊患者单次就诊使用抗菌药物累计品种数/急诊患者就诊使用抗菌药物处方人次
急诊患者处方人均使用质子泵抑制剂品种数:急诊患者单次就诊使用质子泵抑制剂品种数/急诊患者就诊使用质子泵抑制剂处方人次
出院病人均次药品费:出院患者使用药物总费用(排除中药饮片）/出院患者总人次
住院患者人均使用质子泵抑制剂品种数:住院患者单次就诊使用质子泵抑制剂品种数/出院患者使用质子泵抑制剂的出院总人数
住院患者人均使用质子泵抑制剂费用:出院患者使用质子泵抑制剂总费用/出院患者使用质子泵抑制剂的出院总人数
住院患者人均使用抗菌药物品种数:住院患者单次就诊使用抗菌药物累计品种数/出院患者使用抗菌药物人次
住院患者人均使用抗菌药物费用:出院患者使用抗菌药物费用/出院患者使用抗菌药物人次

住院患者碳青霉烯类抗菌药物使用率:出院患者使用碳青霉烯类抗菌药物人次/出院患者总人次
住院患者替加环素使用率:出院患者使用替加环素人次/出院患者总人次
住院患者使用抗真菌药物使用率:出院患者使用抗真菌药物人次/出院患者总人次
住院患者抗菌药物使用率:出院患者使用抗菌药物人次/出院患者总人次
住院患者特殊级抗菌药物使用率:出院患者使用特殊级抗菌药物人次/出院患者使用抗菌药物人次
国家基药目录品种使用金额比例:国家基药目录品种使用金额/医疗药品总收入（排除中药饮片）
抗菌药物占药品使用金额比例:全院抗菌药物使用金额/医疗药品总收入（排除中药饮片）
抗菌药物处方在门诊处方的比例（≥14岁患者):≥14岁患者抗菌药物门诊处方数/门诊处方总数
抗菌药物处方在门诊处方的比例（＜14岁患者）:＜14岁患者抗菌药物门诊处方数/门诊处方总数
住院治疗使用抗菌药物患者使用前病原学检查检查率:出院患者中抗菌药物治疗使用前病原学检查送检人次/出院患者中抗菌药物治疗使用人次
住院使用抗菌药物患者病原学检查百分率:使用抗菌药物出院患者中病原学检查送检人次/出院患者使用抗菌药物人次
I类切口预防用抗菌药物时间＞72h百分率:I类切口预防用抗菌药物时间＞72h/I类切口手术例数
门诊中药饮片帖均味数:门诊中药饮片总味数/门诊中药饮片总帖数
门诊中药饮片帖均费用:门诊患者使用中药饮片总费用/门诊中药饮片总帖数
门诊人均输液量:门诊输液药物输液总量/门诊静脉输液处方人次
#住院平均床日输液量:住院输液药物输液总量/出院患者总人次*(出院患者住院总天数/出院患者总人次)
I类切口预防用抗菌药物时间＞24h且≤48h占比:I类切口预防用抗菌药物时间＞24h且≤48h例数/出院患者I类切口手术例次
I类切口预防用抗菌药物时间＞48h且≤72h占比:I类切口预防用抗菌药物时间＞48h且≤72h例数/出院患者I类切口手术例次

#计算指标及对应的公式（计算之后的结果乘100）
[item_calc100]
出院患者限制级抗菌药物使用强度:出院患者限制级抗菌药物使用量（累计DDD数）/出院患者住院总天数
出院患者限制级抗菌药物使用强度（不含出院带药）:出院患者限制级抗菌药物使用量（累计DDD数）（不含出院带药）/出院患者住院总天数
住院患者抗菌药物使用强度:出院患者抗菌药物使用量（累计DDD数）/出院患者住院总天数
出院患者抗菌药物使用强度（非出院带药）:出院患者抗菌药物使用量（累计DDD数）(非出院带药)/出院患者住院总天数
住院患者质子泵抑制剂使用强度:出院患者质子泵抑制剂药物使用量（累计DDD数）/出院患者住院总天数
住院患者碳青霉烯类抗菌药物使用强度:住院患者碳青霉烯类抗菌药物使用量（累计DDD数）/出院患者住院总天数
住院患者替加环素使用强度:住院患者替加环素使用量（累计DDD数）/出院患者住院总天数
住院患者抗真菌药使用强度:住院患者抗真菌药物使用量（累计DDD数)/出院患者住院总天数
住院患者特殊使用级抗菌药物使用强度:出院患者特殊使用级抗菌药物使用量（累计DDD数）/出院患者住院总天数
出院患者特殊级抗菌药物使用强度（不含出院带药）:出院患者特殊使用级抗菌药物使用量（累计DDD数）（不含出院带药）/出院患者住院总天数
出院患者非限制级抗菌药物强度:出院患者非限制级抗菌药物使用量（累计DDD数）/出院患者住院总天数
出院患者非限制级抗菌药物强度（不含出院带药）:出院患者非限制级抗菌药物使用量（累计DDD数）（不含出院带药）/出院患者住院总天数
出院患者特殊级抗菌药物使用强度:出院患者特殊级抗菌药物使用量（累计DDD数）/出院患者住院总天数

门诊三级警示信息发生次数占比(%):门诊三级警示信息发生次数/门诊所有警示等级发生次数
门诊四级警示信息发生次数占比(%):门诊四级警示信息发生次数/门诊所有警示等级发生次数
门诊五级警示信息发生次数占比(%):门诊五级警示信息发生次数/门诊所有警示等级发生次数
住院三级警示信息发生次数占比(%):住院三级警示信息发生次数/住院所有警示等级发生次数
住院四级警示信息发生次数占比(%):住院四级警示信息发生次数/住院所有警示等级发生次数
住院五级警示信息发生次数占比(%):住院五级警示信息发生次数/住院所有警示等级发生次数
住院三级警示信息人次占比(%):住院三级警示信息人次数/出院患者总人次
住院四级警示信息人次占比(%):住院四级警示信息人次数/出院患者总人次
住院五级警示信息人次占比(%):住院五级警示信息人次数/出院患者总人次
三级警示信息发生处方占比(%):三级警示信息发生处方数/门诊处方总数
四级警示信息发生处方占比(%):四级警示信息发生处方数/门诊处方总数
五级警示信息发生处方占比(%):五级警示信息发生处方数/门诊处方总数

门诊适宜性过敏占比:门诊适宜性过敏/门诊不适宜问题发生数
门诊适宜性配伍占比:门诊适宜性配伍/门诊不适宜问题发生数
门诊适宜性用法用量占比:门诊适宜性用法用量/门诊不适宜问题发生数
门诊适宜性特殊人群占比:门诊适宜性特殊人群/门诊不适宜问题发生数
门诊适宜性相互作用占比:门诊适宜性相互作用/门诊不适宜问题发生数
门诊适宜性给药途径占比:门诊适宜性给药途径/门诊不适宜问题发生数
门诊适宜性重复用药占比:门诊适宜性重复用药/门诊不适宜问题发生数
门诊适宜性给药时机占比:门诊适宜性给药时机/门诊不适宜问题发生数
住院适宜性不良反应占比:住院适宜性给药时机/住院不适宜问题发生数
住院适宜性肾功能占比:住院适宜性肾功能/住院不适宜问题发生数
住院适宜性适应症占比:住院适宜性适应症/住院不适宜问题发生数
住院适宜性诊断占比:住院适宜性诊断/住院不适宜问题发生数
门诊适宜性诊断占比:门诊适宜性诊断/门诊不适宜问题发生数
门诊适宜性适应症占比:门诊适宜性适应症/门诊不适宜问题发生数
门诊适宜性肾功能占比:门诊适宜性肾功能/门诊不适宜问题发生数
门诊适宜性不良反应占比:门诊适宜性不良反应/门诊不适宜问题发生数
住院适宜性配伍占比:住院适宜性配伍/住院不适宜问题发生数
住院适宜性相互作用占比:住院适宜性相互作用/住院不适宜问题发生数
住院适宜性给药途径占比:住院适宜性给药途径/住院不适宜问题发生数
住院适宜性给药时机占比:住院适宜性给药时机/住院不适宜问题发生数
住院适宜性用法用量占比:住院适宜性用法用量/住院不适宜问题发生数
住院适宜性过敏占比:住院适宜性过敏/住院不适宜问题发生数
住院适宜性重复用药占比:住院适宜性重复用药/住院不适宜问题发生数
住院适宜性特殊人群占比:住院适宜性特殊人群/住院不适宜问题发生数

急诊适宜性过敏占比:急诊适宜性过敏/急诊不适宜问题发生数
急诊适宜性配伍占比:急诊适宜性配伍/急诊不适宜问题发生数
急诊适宜性用法用量占比:急诊适宜性用法用量/急诊不适宜问题发生数
急诊适宜性特殊人群占比:急诊适宜性特殊人群/急诊不适宜问题发生数
急诊适宜性相互作用占比:急诊适宜性相互作用/急诊不适宜问题发生数
急诊适宜性给药途径占比:急诊适宜性给药途径/急诊不适宜问题发生数
急诊适宜性重复用药占比:急诊适宜性重复用药/急诊不适宜问题发生数
急诊适宜性给药时机占比:急诊适宜性给药时机/急诊不适宜问题发生数
急诊适宜性诊断占比:急诊适宜性诊断/急诊不适宜问题发生数
急诊适宜性适应症占比:急诊适宜性适应症/急诊不适宜问题发生数
急诊适宜性肾功能占比:急诊适宜性肾功能/急诊不适宜问题发生数
急诊适宜性不良反应占比:急诊适宜性不良反应/急诊不适宜问题发生数

#计算指标及对应的公式（两个指标相减）
[item_calc_minus]
门诊患者就诊使用药物处方人次（不含中药饮片）:门诊患者就诊总人次-门诊患者就诊使用中药饮片的处方人次
急诊患者就诊使用药物处方人次（不含中药饮片）:急诊患者就诊总人次-急诊患者就诊使用中药饮片的处方人次
门诊患者使用药物总费用（排除中药饮片）:门诊患者使用药物总费用-门诊患者使用中药饮片总费用
急诊患者使用药物总费用(排除中药饮片）:急诊患者使用药物总费用-急诊患者使用中药饮片总费用
出院患者使用药物总费用(排除中药饮片）:住院患者使用药物总费用-住院患者使用中药饮片总费用
医疗药品总收入（排除中药饮片）:医疗药品总收入-全院患者使用中药饮片费用
门诊处方总数(排除中药饮片):门诊处方总数-门诊草药方处方总数
急诊处方总数（排除中药饮片）:急诊处方总数-急诊草药方处方数量
门急诊处方总数（排除中药饮片）:门急诊处方总数-门急诊草药方处方数量
门诊处方药品总金额(排除中药饮片):门诊处方药品总金额-门诊患者使用中药饮片总费用
出院患者总人次(排除中药饮片):出院患者总人次-出院患者使用中药饮片人次数
出院患者用药总金额(排除中药饮片):出院患者用药总金额-出院患者使用中药饮片总金额
#0731版增加
西药使用金额(含中成药):医疗药品总收入-全院患者使用中药饮片费用
门诊西药使用金额(含中成药):门诊患者使用药物总费用-门诊患者使用中药饮片总费用
住院西药使用金额(含中成药):住院患者使用药物总费用- 住院患者使用中药饮片总费用
急诊患者就诊使用药物处方人次(不含中药饮片):急诊患者就诊总人次-急诊患者就诊使用中药饮片的处方人次

抗菌药物占药品使用金额比例:全院抗菌药物使用金额/(医疗药品总收入-全院患者使用中药饮片费用)
门诊人均药品总金额（排除中药饮片）:(门诊处方药品总金额-门诊患者使用中药饮片总金额)/门诊处方人次（排除中药饮片）
门诊平均处方药品金额（排除中药饮片）:(门诊处方药品总金额-门诊患者使用中药饮片总金额)/(门诊处方总数-门诊中药饮片处方总数)



#缺省维度+机构 需要获取配置项的指标
[ConfigurationItem_zone]
原则上不需要预防使用抗菌药物I类切口手术例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND t1.Zone_ID = %%s  AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND t1.`Operation_Name` REGEXP %%s
原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次:SELECT COUNT(distinct Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND Drug_Using_Aim = '预防' AND Antimicrobial = 1 AND t1.Zone_ID = %%s  AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND t1.`Operation_Name` REGEXP %%s
使用抗菌药物出院患者中病原学检查送检人次:SELECT COUNT(DISTINCT t1.key_time,t1.`event_no`) FROM  %(dbname_dp)s.ipt_inpatient t1  INNER JOIN %(dbname_dp)s.ipt_drug t2  ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3  ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s  AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s  AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗' AND TIMESTAMPDIFF(SECOND,Order_Time,Sample_Collect_Time)<0
出院患者中抗菌药物治疗使用前病原学检查送检人次:SELECT COUNT(DISTINCT t1.key_time,t1.`event_no`) FROM %(dbname_dp)s.ipt_inpatient t1 INNER JOIN %(dbname_dp)s.ipt_drug t2 ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3 ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s  AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗' AND TIMESTAMPDIFF(SECOND,Order_Time,Sample_Collect_Time)<0
I类切口手术预防使用抗菌药物品种选择合理例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no inner join %(dbname_knowledge)s.`base_product` t4 on t2.drug_id=t4.product_id inner join %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.map_product_id = t5.product_id WHERE  t1.Zone_ID = %%s and t1.key_time between %%s and %%s AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND  drug_code regexp %%s
使用非限制级抗菌药物出院患者中病原学检查送检人次:SELECT COUNT(DISTINCT t1.key_time,t1.`event_no`) FROM  %(dbname_dp)s.ipt_inpatient t1  INNER JOIN %(dbname_dp)s.ipt_drug t2  ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3  ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s  AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s  AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗' And t2.Antimicrobial_Level=1  AND TIMESTAMPDIFF(SECOND,Order_Time,Sample_Collect_Time) < 0
使用限制级抗菌药物出院患者中病原学检查送检人次:SELECT COUNT(DISTINCT t1.key_time,t1.`event_no`) FROM  %(dbname_dp)s.ipt_inpatient t1  INNER JOIN %(dbname_dp)s.ipt_drug t2  ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3  ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s  AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s  AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗' And t2.Antimicrobial_Level=2 AND TIMESTAMPDIFF(SECOND,Order_Time,Sample_Collect_Time)< 0
使用特殊级抗菌药物出院患者中病原学检查送检人次:SELECT COUNT(DISTINCT t1.key_time,t1.`event_no`) FROM  %(dbname_dp)s.ipt_inpatient t1  INNER JOIN %(dbname_dp)s.ipt_drug t2  ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3  ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s  AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s  AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗' And t2.Antimicrobial_Level=3 AND TIMESTAMPDIFF(SECOND,Order_Time,Sample_Collect_Time) < 0
住院手术患者预防使用抗菌药物用药时机合理率切皮前0.5-1h例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no INNER JOIN %(dbname_knowledge)s.`base_product` t4 ON t2.drug_id=t4.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.map_product_id = t5.product_id WHERE  t1.Zone_ID = %%s AND t1.key_time BETWEEN %%s AND %%s AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND  drug_code REGEXP %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 1 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 1 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 1 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 1 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))

#缺省维度+机构 全院指标及对应的SQL
[hospital]
全院患者抗菌药物累计品种数:SELECT	COUNT(DISTINCT(drug_name)) FROM (	SELECT DISTINCT t3.drug_name FROM 	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s 	UNION ALL	SELECT DISTINCT t3.drug_name FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s ) rlt
全院患者药品累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s   AND t1.key_time BETWEEN %%s AND %%s  UNION ALL  SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s) rlt
全院患者使用西药药品累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id   WHERE t1.Zone_ID = %%s   AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001003%%%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001003%%%%') rlt
全院患者使用中成药总品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id   WHERE t1.Zone_ID = %%s   AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002002%%%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002002%%%%') rlt
全院患者使用中药饮片总品种数:SELECT	COUNT(DISTINCT(drug_name)) FROM (	SELECT DISTINCT t3.drug_name FROM 	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '中药饮片'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s 	UNION ALL	SELECT DISTINCT t3.drug_name FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '中药饮片'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s ) rlt
全院患者使用抗菌药物累计品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE 	t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s 	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s ) rlt
全院患者使用口服剂型抗菌药物品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '口服剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s 	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '口服剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s ) rlt
全院患者使用注射剂型抗菌药物品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '注射剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s 	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '注射剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s ) rlt
全院使用头霉素类抗菌药物品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM 	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t1.key_time BETWEEN %%s AND %%s  AND t3.drug_code LIKE '001003001007001004004%%%%' 	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s AND t3.drug_code LIKE '001003001007001004004%%%%' ) rlt
全院患者使用三代及四代头孢菌素注射剂型品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM 	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '注射剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t1.key_time BETWEEN %%s AND %%s  AND t3.drug_code LIKE '001003001006002003%%%%' 	OR t3.drug_code LIKE '001003001006002004%%%%'	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '注射剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s AND t3.drug_code LIKE '001003001006002003%%%%' 	OR t3.drug_code LIKE '001003001006002004%%%%' ) rlt
全院患者使用三代及四代头孢菌素口服剂型品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM 	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '口服型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s  AND t3.drug_code LIKE '001003001006002003%%%%' 	OR t3.drug_code LIKE '001003001006002004%%%%'	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '口服型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s AND t3.drug_code LIKE '001003001006002003%%%%' 	OR t3.drug_code LIKE '001003001006002004%%%%' ) rlt
全院碳青霉烯类注射剂型品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '注射剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s  AND t3.drug_code LIKE '001003001007001004%%%%' 	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '注射剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s AND t3.drug_code LIKE '001003001007001004%%%%' ) rlt
全院氟喹诺酮类口服剂型品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM 	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '口服剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t1.key_time BETWEEN %%s AND %%s  AND t3.drug_code LIKE '001003001007001002003%%%%' OR t3.drug_code LIKE '001003001007001002004%%%%'	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '口服剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s AND t3.drug_code LIKE '001003001007001002003%%%%' 	OR t3.drug_code LIKE '001003001007001002004%%%%' ) rlt
全院氟喹诺酮类注射剂型品规数:SELECT	COUNT(DISTINCT(drug_id)) FROM (	SELECT DISTINCT t1.drug_id FROM 	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '注射剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND t1.key_time BETWEEN %%s AND %%s  AND t3.drug_code LIKE '001003001007001002003%%%%' OR t3.drug_code LIKE '001003001007001002004%%%%'	UNION ALL	SELECT DISTINCT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)		WHERE		a.analysis_type = '自定义分析'	AND a.analysis_result_type = '注射剂型抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s AND t3.drug_code LIKE '001003001007001002003%%%%' 	OR t3.drug_code LIKE '001003001007001002004%%%%' ) rlt
全院患者使用药品总品规数:SELECT COUNT(DISTINCT(drug_id)) FROM  (SELECT  drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t1   WHERE Zone_ID = %%s AND key_time BETWEEN %%s AND %%s  UNION ALL  SELECT  drug_id  FROM  %(dbname_dp)s.`ipt_drug`   WHERE Zone_ID =%%s AND key_time BETWEEN %%s AND %%s  ) rlt
全院患者使用西药药品总品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT drug_id FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN  (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001003%%%%') AND Zone_ID =%%s AND key_time BETWEEN %%s AND %%s   UNION ALL SELECT drug_id FROM %(dbname_dp)s.`opt_recipe_drug`  WHERE drug_id IN  (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001003%%%%') AND Zone_ID =%%s AND key_time BETWEEN %%s AND %%s ) rlt
全院患者使用中成药总品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT drug_id FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN  (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001002002%%%%') AND Zone_ID =%%s AND key_time BETWEEN %%s AND %%s   UNION ALL SELECT drug_id FROM %(dbname_dp)s.`opt_recipe_drug`  WHERE drug_id IN  (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001002002%%%%') AND Zone_ID =%%s AND key_time BETWEEN %%s AND %%s ) rlt
医疗药品总收入:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`opt_recipe_drug` t1 WHERE t1.zone_id=%%s AND key_time BETWEEN %%s AND %%s AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`ipt_drug` t1 WHERE t1.zone_id=%%s  AND key_time BETWEEN %%s AND %%s AND t1.drug_id  IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0)) AS rlt
国家基药目录品种使用金额:select sum(Total_Money) from (SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.opt_recipe_drug WHERE Zone_Id = %%s AND Key_Time between %%s and %%s AND base_drug=1 UNION ALL SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.ipt_drug WHERE Zone_Id = %%s AND Key_Time between %%s and %%s AND base_drug=1) rlt
全院抗菌药物使用金额:SELECT SUM(price) from (SELECT SUM(price * Despensing_Num) as price FROM %(dbname_dp)s.`ipt_drug` WHERE  Zone_ID=%%s AND  key_time BETWEEN %%s AND %%s  AND Antimicrobial= 1 UNION ALL SELECT SUM(price * Despensing_Num) as price FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID=%%s AND  key_time BETWEEN %%s AND %%s  AND Antimicrobial= 1) rlt
全院患者使用中药饮片费用:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`opt_recipe_drug` t1 WHERE t1.zone_id=%%s AND key_time BETWEEN %%s AND %%s AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t3.drug_code LIKE '001002001%%%%' and t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`ipt_drug` t1 WHERE t1.zone_id=%%s  AND key_time BETWEEN %%s AND %%s AND t1.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t3.drug_code LIKE '001002001%%%%' and t2.is_ignore =0)) AS rlt
全院患者使用数量:select sum(num) from (SELECT SUM(Despensing_Num) as num  FROM %(dbname_dp)s.`ipt_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s union SELECT SUM(Despensing_Num) as num FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s) as rlt
医疗总收入:select sum(money) from (SELECT sum(Fee_Total) as money FROM %(dbname_dp)s.`opt_fee` where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s union all SELECT sum(Fee_Total) as money FROM %(dbname_dp)s.`ipt_inpatient` where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s) as rlt
省增补基本药物使用金额:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) as price FROM %(dbname_dp)s.`opt_recipe_drug` t1 WHERE t1.zone_id=%%s AND key_time BETWEEN %%s AND %%s and t1.base_drug=2 AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) as price FROM %(dbname_dp)s.`ipt_drug` t1 WHERE t1.zone_id=%%s  AND key_time BETWEEN %%s AND %%s AND t1.base_drug=2 AND t1.drug_id  IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0)) AS rlt
医保目录内药品使用金额:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) as price FROM %(dbname_dp)s.`opt_recipe_drug` t1 WHERE t1.zone_id=%%s AND key_time BETWEEN %%s AND %%s and t1.medicare_type in ('甲类','乙类') AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) as price FROM %(dbname_dp)s.`ipt_drug` t1 WHERE t1.zone_id=%%s  AND key_time BETWEEN %%s AND %%s AND t1.medicare_type in ('甲类','乙类') AND t1.drug_id  IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0)) AS rlt



#药品维度+机构下的指标及对应的SQL
[drug_zone]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
门诊药品使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2     ON t1.recipe_id = t2.recipe_id   INNER JOIN %(dbname_knowledge)s.`base_product` t3     ON t1.drug_id = t3.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t4     ON t3.map_product_id = t4.id WHERE t1.zone_id =%%s  AND t1.Key_Time BETWEEN %%s  AND %%s  AND t1.Antimicrobial = 1   AND t2.recipe_source = '门诊' and t3.map_product_id=%%s
急诊患者就诊总人次:SELECT COUNT(DISTINCT key_time,patient_id,dept_id) FROM %(dbname_dp)s.`opt_recipe` WHERE zone_id=%%s AND recipe_source='急诊'AND key_time BETWEEN %%s AND %%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
出院患者总人次:SELECT COUNT(patient_id) FROM %(dbname_dp)s.`ipt_inpatient` WHERE zone_id=%%s AND key_time BETWEEN %%s AND %%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
门诊患者使用药物总费用:SELECT SUM(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊') AND key_time BETWEEN %%s AND %%s AND drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)
急诊药品使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='急诊' and t3.map_product_id=%%s
急诊患者使用药物总费用:SELECT SUM(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='急诊') AND key_time BETWEEN %%s AND %%s AND drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)

全院患者使用处方数:SELECT count(DISTINCT(recipe_id)) FROM %(dbname_dp)s.opt_recipe WHERE	zone_id =%%s AND key_time BETWEEN %%s AND %%s and  recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe_drug where drug_id IN (SELECT product_id	FROM %(dbname_knowledge)s.`base_product` t1	WHERE	t1.`map_product_id` =%%s))
门诊患者使用处方数:SELECT count(DISTINCT(recipe_id)) FROM %(dbname_dp)s.opt_recipe WHERE	zone_id =%%s AND recipe_source = '门诊' AND key_time BETWEEN %%s AND %%s AND recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe_drug where drug_id IN (SELECT product_id	FROM %(dbname_knowledge)s.`base_product` t1	WHERE	t1.`map_product_id` =%%s))
急诊患者使用处方数:SELECT count(DISTINCT(recipe_id)) FROM %(dbname_dp)s.opt_recipe WHERE	zone_id =%%s AND recipe_source = '急诊' AND key_time BETWEEN %%s AND %%s AND recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe_drug where drug_id IN (SELECT product_id	FROM %(dbname_knowledge)s.`base_product` t1	WHERE	t1.`map_product_id` =%%s))
住院患者使用频次:SELECT COUNT(*) AS drugCount FROM	%(dbname_dp)s.`ipt_drug` t WHERE t.Zone_ID = %%s	AND t.Key_Time BETWEEN %%s AND %%s 	AND t.Drug_ID IN (SELECT b.product_id FROM %(dbname_knowledge)s.`base_product` b	WHERE b.map_product_id =%%s)
门诊患者使用频次:SELECT COUNT(*) AS drugCount FROM	%(dbname_dp)s.`opt_recipe_drug` t WHERE t.Zone_ID = %%s	AND t.Key_Time BETWEEN %%s AND %%s 	AND t.Drug_ID IN (SELECT b.product_id FROM %(dbname_knowledge)s.`base_product` b	WHERE b.map_product_id =%%s) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
急诊患者使用频次:SELECT COUNT(*) AS drugCount FROM	%(dbname_dp)s.`opt_recipe_drug` t WHERE t.Zone_ID = %%s	AND t.Key_Time BETWEEN %%s AND %%s 	AND t.Drug_ID IN (SELECT b.product_id FROM %(dbname_knowledge)s.`base_product` b	WHERE b.map_product_id =%%s) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
住院患者使用数量:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s)
门诊患者使用数量:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
急诊患者使用数量:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
住院出院带药药品使用数量:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s) and Order_Type = '出院带药'
抗菌药物使用数量:SELECT sum（num） FROM (SELECT sum(Despensing_Num) as num  FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY	a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s 	UNION ALL	SELECT sum(Despensing_Num) as num FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE t1.order_id IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.ipt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1) WHERE a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY a.id)	AND t1.Zone_ID = %%s AND  t1.key_time BETWEEN %%s AND %%s ) rlt
门诊抗菌药物使用数量:SELECT sum(Despensing_Num) as num  FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  WHERE t1.id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1	),',' ,- 1) AS `name`	FROM %(dbname_dp)s.opt_alertmessage a	LEFT JOIN mysql.help_topic b ON b.help_topic_id < (	LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'	ORDER BY a.id)	AND t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s

出院患者用药总金额:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`ipt_drug` WHERE  zone_id =%%s AND key_time BETWEEN %%s  AND %%s and drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE t1.`is_ignore` =0 and t1.map_product_id=%%s)
最高处方金额:SELECT MAX(Recipe_Fee_Total) FROM %(dbname_dp)s.`opt_recipe` WHERE Zone_ID =%%s AND Key_Time BETWEEN %%s AND %%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.`Drug_ID`=t2.`product_id` WHERE t2.`map_product_id`=%%s)
出院患者最高用药金额:SELECT MAX(drug_money) FROM (SELECT event_no,SUM(price*despensing_num) AS drug_money FROM  %(dbname_dp)s.`ipt_drug`  t1  WHERE t1.zone_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND drug_id IN(SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s) GROUP BY event_no) AS drugmoney
住院不适宜问题发生数:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析'  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性诊断:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='诊断' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性肾功能:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='肾功能' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性适应症:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='适应症' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性不良反应:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='不良反应' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性过敏:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='过敏' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性配伍:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='配伍' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性用法用量:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='用法用量' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性给药时机:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药时机' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性给药途径:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药途径' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性相互作用:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='相互作用' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性重复用药:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='重复用药' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性特殊人群:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='特殊人群' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
门诊适宜性诊断:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='诊断' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性适应症:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='适应症' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性不良反应:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='不良反应' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性肾功能:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='肾功能' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性过敏:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='过敏' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性用法用量:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='用法用量' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性配伍:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='配伍' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性给药时机:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药时机' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性相互作用:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='相互作用' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性给药途径:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药途径' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性重复用药:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='重复用药' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性特殊人群:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='特殊人群' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊不适宜问题发生数:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析'  AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
急诊不适宜问题发生数:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析'  AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性诊断:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='诊断' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性适应症:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='适应症' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性不良反应:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='不良反应' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性肾功能:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='肾功能' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性过敏:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='过敏' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性用法用量:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='用法用量' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性配伍:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='配伍' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性给药时机:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药时机' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性相互作用:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='相互作用' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性给药途径:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药途径' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性重复用药:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='重复用药' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性特殊人群:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='特殊人群' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')



#药品维度下标准产品的属性
[drug_productInfor]
规格:SELECT chineseSpecification FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
剂型:SELECT formulation FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
生产厂家:SELECT chineseManufactureName FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
DDD值:SELECT ddd FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
DDD单位:SELECT dddUnit FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
产品编号:select id from %(dbname_knowledge)s.`tb_product` WHERE id=%%s


#手术维度+机构下的指标及对应的SQL
[operation_zone]
出院患者预防使用抗菌药物手术例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND t1.Zone_ID = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.key_time between %%s and %%s  AND Operation_code regexp %%s
总手术例次: SELECT COUNT(DISTINCT(operation_no)) FROM %(dbname_dp)s.`ipt_operation` WHERE zone_id=%%s AND key_time BETWEEN %%s AND %%s  AND Operation_code regexp %%s
I类切口手术预防使用抗菌药物例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND Operation_code regexp %%s
术前24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s  AND ((TIME_TO_SEC(TIMEDIFF(operation_start_time,Invalid_Time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(operation_start_time,valid_time))>0*60*60)) and t2.key_time between %%s and %%s AND Operation_code regexp %%s
术后24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s  AND ((TIME_TO_SEC(TIMEDIFF(valid_time,operation_end_time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>0*60*60)) and t2.key_time between %%s and %%s AND Operation_code regexp %%s
术后使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1   AND t1.`Operation_Cut_Type` = 'Ⅰ' AND t2.zone_id=%%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>=0*60*60)) AND Operation_code regexp %%s
I类切口手术预防使用抗菌药物时间≤24小时:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No  WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s AND t1.Key_Time between %%s and %%s AND t2.Drug_Using_Aim = '预防' AND Operation_code regexp %%s
I类切口预防用抗菌药物时间>24h且≤48h例数:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 48 * 60 * 60)) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防' AND Operation_code regexp %%s
I类切口预防用抗菌药物时间>48h且≤72h例数:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >48 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防' AND Operation_code regexp %%s
I类切口预防用抗菌药物>72h例数:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >72 * 60 * 60 )) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防' AND Operation_code regexp %%s

#警示维度+机构下的指标及对应的SQL
[message_zone]:
住院三级警示信息人次数:SELECT COUNT(distinct key_time,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=3  and key_date between %%s and %%s  AND  t1.analysis_result_type=%%s
住院四级警示信息人次数:SELECT COUNT(distinct key_time,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=4  and key_date between %%s and %%s  AND  t1.analysis_result_type=%%s
住院五级警示信息人次数:SELECT COUNT(distinct key_time,event_no) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=5  and key_date between %%s and %%s  AND  t1.analysis_result_type=%%s
门诊三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and t1.key_date between %%s and %%s AND  t1.analysis_result_type=%%s
门诊四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and t1.key_date between %%s and %%s AND  t1.analysis_result_type=%%s
门诊五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and t1.key_date between %%s and %%s AND  t1.analysis_result_type=%%s
门诊所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s  and t1.key_date between %%s and %%s AND  t1.analysis_result_type=%%s
住院三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and t1.key_date between %%s and %%s and t1.analysis_result_type=%%s
住院四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and t1.key_date between %%s and %%s and  t1.analysis_result_type=%%s
住院五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and t1.key_date between %%s and %%s and t1.analysis_result_type=%%s
住院所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.key_date between %%s and %%s and  t1.analysis_result_type=%%s
#门诊三级警示信息发生次数占比:
#门诊四级警示信息发生次数占比:
#门诊五级警示信息发生次数占比:
#住院三级警示信息发生次数占比:
#住院四级警示信息发生次数占比:
#住院五级警示信息发生次数占比:
三级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and key_date between %%s and %%s and  t1.analysis_result_type=%%s
四级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and key_date between %%s and %%s and  t1.analysis_result_type=%%s
五级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and key_date between %%s and %%s and  t1.analysis_result_type=%%s
#三级警示信息发生处方占比:
#四级警示信息发生处方占比:
#五级警示信息发生处方占比:

[定制报表]
药品金额超过N元的药品:SELECT zone_id,recipe_id,drug_name,key_time,price,Despensing_num, price*Despensing_num AS prices FROM `opt_recipe_drug` WHERE zone_id=24 AND key_time='2014-08-01' GROUP BY recipe_id,drug_name HAVING price*Despensing_num>9000
药品品种数超过N种的处方数量:select count(DISTINCT(recipe_id)) from(SELECT	t1.recipe_id,count(distinct(t3.drug_name)) as num FROM	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE	t1.Zone_ID = 328 AND t1.key_time BETWEEN '2014-08-01' AND '2014-08-01' GROUP BY t1.recipe_id having num>0) as rlt
药品品种数超过N种的处方号及品种数:SELECT t1.recipe_id,count(distinct(t3.drug_name)) as num FROM	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE	t1.Zone_ID = 328 AND t1.key_time BETWEEN '2014-08-01' AND '2014-08-01' GROUP BY t1.recipe_id having num>0
日均金额:处方包含指定药品的金额总和/包含指定药品的处方数
处方占比:超过日均金额的处方数/总处方数
处方包含指定药品的金额总和:select sum(prices) from (SELECT	zone_id,recipe_id,drug_name,key_time,price * Despensing_num AS prices FROM	353_dp.`opt_recipe_drug` WHERE	zone_id = 328 AND key_time = '2014-08-01' GROUP BY	recipe_id,	drug_name having Drug_Name='0.9%氯化钠注射液') as rlt
包含指定药品的处方数:select count(recipe_id) FROM %(dbname_dp)s.opt_recipe  where recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe_drug where Drug_Name='0.9%氯化钠注射液') and zone_id=328 and key_time='2014-08-01'
