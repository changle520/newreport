#连接数据库的配置
[DEFAULT]
dbname_dp=ipharmacare_dp354
dbname_sys=ipharmacare_syscenter354
dbname_knowledge=ipharmacare_knowledge354

[mysql]
host:10.1.1.89
port:3306
username:root
passwd:root
dbname_report:ipharmacare_bi_report_new1
charset:utf8

#获取自定义报表中数据库里面的相关内容
[reportsql]
allReportNames:SELECT report_name FROM `report`
reportID:SELECT report_id ,data_dimension_value FROM report WHERE report_name=%%s AND is_deleted=0
reportItemid:SELECT item_id FROM `report_item_relation` WHERE report_id=%%s
allItems:SELECT item_id,item_name FROM `report_item`
esValue:SELECT * FROM {}
dimension_name:SELECT dimension_name FROM `report_data_dimension` WHERE dimension_value IN (SELECT data_dimension_value FROM `report` WHERE report_name=%%s)
business_dimension:SELECT  dimension_name FROM  `report_business_dimension` WHERE dimension_value IN  (SELECT business_dimension_value FROM  `report`   WHERE report_name =%%s)
hospital:SELECT zone_id,dept_id,doc_id,doc_group,product_id,analysis_type,operation_code FROM {}
docname:SELECT username FROM %(dbname_sys)s.`auth_user` WHERE realname = %%s
deptid:SELECT code from %(dbname_sys)s.`medical_dept` where dept_name=%%s
reportDate:SELECT start_date,end_date FROM `report_data_record` WHERE record_id=%%s
esValue_test:SELECT statistic_value FROM %%s where doc_name=%%s
operation_code:SELECT icd9_code FROM `report_operations` WHERE operation_name=%%s
recordid:select record_id from report_data_record where report_id=%%s
columnname:select column_name from information_schema.Columns where table_name='{}'
zoneid:select zone_id from %(dbname_sys)s.medical_org where zone_name=%%s


#缺省维度+机构 常规指标及对应的SQL
[zone]
门诊患者就诊总人次:SELECT COUNT(DISTINCT Patient_Id,key_time) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source='门诊' and key_time between %%s and %%s
门诊患者静脉使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊'and key_time between %%s and %%s)
门诊静脉输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊'and key_time between %%s and %%s)
门诊患者就诊使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊'and key_time between %%s and %%s)
门诊患者就诊使用质子泵抑制剂处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊'and key_time between %%s and %%s)
门诊使用中药注射剂输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='中药注射剂输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊'and key_time between %%s and %%s)
急诊患者就诊总人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.`opt_recipe` WHERE zone_id=%%s and recipe_source='急诊'and key_time between %%s and %%s
#急诊患者就诊总人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.`opt_recipe` WHERE zone_id=%%s and recipe_source='急诊'and key_time between %%s and %%s
急诊患者静脉使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and key_time between %%s and %%s)
急诊患者就诊使用抗菌药物处方人次 :SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and key_time between %%s and %%s)
急诊静脉输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and key_time between %%s and %%s)
急诊患者就诊使用质子泵抑制剂处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and key_time between %%s and %%s)
门急诊患者就诊使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source in ("急诊","门诊") and key_time between %%s and %%s)
门急诊患者静脉使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source in ("急诊","门诊") and key_time between %%s and %%s)
门急诊就诊处方人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source in ('急诊','门诊') and key_time between %%s and %%s
出院患者总人次:SELECT COUNT(patient_id) FROM %(dbname_dp)s.`ipt_inpatient` WHERE zone_id=%%s and key_time between %%s and %%s
出院患者使用抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者中抗菌药物治疗使用人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_using_aim='治疗')
出院患者中使用静脉输液人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者预防使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_using_aim='预防')
出院患者使用碳青霉烯类抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007001004%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)  AND Antimicrobial=1
出院患者使用替加环素人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007004007%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用抗真菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug`  WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE t2.drug_code LIKE '001003001005%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用特殊级抗菌药物人次:SELECT COUNT(DISTINCT(t1.patient_id)) FROM %(dbname_dp)s.`ipt_inpatient` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No`=t2.`Event_No`  WHERE t1.`Zone_ID`=%%s  AND  t1.key_time BETWEEN %%s AND %%s  AND  t2.Antimicrobial_Level = 3 AND t2.Antimicrobial=1
住院三级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=3  and key_date between %%s and %%s
住院四级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=4  and key_date between %%s and %%s
住院五级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=5  and key_date between %%s and %%s

门诊患者就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s  AND %%s
门诊患者就诊用药总品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s  AND %%s
门诊患者就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊'  AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
急诊患者就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '急诊' AND t1.key_time BETWEEN %%s  AND %%s
急诊患者就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '急诊'  AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
出院患者使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.key_time BETWEEN %%s AND %%s
出院患者使用质子泵抑制剂总品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5  ON t1.event_no=t5.event_no WHERE t1.Zone_ID = %%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t4.key_time BETWEEN %%s AND %%s
出院患者住院总天数:select sum(datediff(discharge_date,in_dpet_time)) FROM %(dbname_dp)s.`ipt_inpatient` where zone_id=%%s and key_time  between %%s and %%s
出院患者I类切口手术例次:SELECT COUNT(*) FROM %(dbname_dp)s.`ipt_operation` WHERE  Zone_ID = %%s  AND Operation_Cut_Type = 'Ⅰ' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
I类切口手术预防使用抗菌药物例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s
出院患者预防使用抗菌药物手术例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND t1.Zone_ID = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
I类切口手术前0.5-2.0小时内给药例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND t1.Zone_ID = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 2 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 2 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))
总手术例次:select count(distinct(operation_no)) FROM %(dbname_dp)s.`ipt_operation` where zone_id=%%s and key_time between %%s and %%s
门诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source='门诊'and key_time between %%s and %%s
≥14岁患者抗菌药物门诊处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.opt_alertrecipe t1 WHERE t1.age_as_num >= 140000 and t1.recipe_source='门诊'  AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_alertmessage t2 WHERE analysis_type = '自定义分析'  AND analysis_result_type = '抗菌药物' AND t2.zone_id =%%s and t2.key_date between %%s and %%s)
＜14岁患者抗菌药物门诊处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.opt_alertrecipe t1 WHERE t1.age_as_num < 140000  AND t1.recipe_source='门诊' and t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_alertmessage t2 WHERE analysis_type = '自定义分析'  AND analysis_result_type = '抗菌药物' AND t2.zone_id =%%s and t2.key_date between %%s and %%s)
门诊静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '输液药物'  AND zone_id = %%s   AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊')  AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数（≥14岁）:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source = '门诊')   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_alertrecipe`  WHERE age_as_num >= 140000) AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数（＜14岁）:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source = '门诊')   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_alertrecipe`  WHERE age_as_num < 140000) AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊') AND key_date between %%s and %%s
门诊中药注射剂输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药注射剂输液'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id  FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊') AND key_date between %%s and %%s
门诊抗菌药物处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊') AND key_date between %%s and %%s
三级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and key_date between %%s and %%s
四级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and key_date between %%s and %%s
五级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and key_date between %%s and %%s
急诊静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '输液药物'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s. `opt_recipe`   WHERE recipe_source = '急诊') and  key_date between %%s and %%s
急诊抗菌药物静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物输液'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊') and  key_date between %%s and %%s
急诊抗菌药物处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊') and  key_date between %%s and %%s
门急诊静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '输液药物'   AND zone_id =%%s  AND  key_date between %%s and %%s
门急诊抗菌药物静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id =%%s  AND  key_date between %%s and %%s
门诊药品总品规数:SELECT COUNT(DISTINCT drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID = %%s and Key_Time between %%s and %%s and recipe_id in (select recipe_id FROM %(dbname_dp)s.`opt_recipe` where recipe_source='门诊')
门诊静脉输液药品品规数:SELECT  COUNT(DISTINCT(drug_id)) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN  (SELECT recipe_id  FROM  %(dbname_dp)s.`opt_alertmessage`   WHERE analysis_type = '自定义分析'  AND analysis_result_type = '输液药物' and zone_id=%%s)   AND recipe_id IN   (SELECT recipe_id   FROM %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '门诊')  and key_time between %%s and %%s
住院药品总品规数:SELECT COUNT(DISTINCT drug_id) FROM %(dbname_dp)s.`ipt_drug` WHERE  Zone_ID = %%s AND Key_Time between %%s and %%s
门诊三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and t1.key_date between %%s and %%s
门诊四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and t1.key_date between %%s and %%s
门诊五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and t1.key_date between %%s and %%s
门诊所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.key_date between %%s and %%s
住院三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and t1.key_date between %%s and %%s
住院四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and t1.key_date between %%s and %%s
住院五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and t1.key_date between %%s and %%s
住院所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.key_date between %%s and %%s
门诊患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID=%%s  AND Antimicrobial in(1,2) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊') and  key_time between %%s and %%s
出院患者中联合使用抗菌药物人次:SELECT COUNT(DISTINCT (event_no))FROM  %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物联用'   AND zone_id = %%s  AND event_no IN   (SELECT event_no FROM  %(dbname_dp)s.`ipt_inpatient`  WHERE key_time BETWEEN %%s AND %%s)
门诊患者单次就诊用药品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s  AND %%s
门诊患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '门诊' AND t1.key_time BETWEEN %%s  AND %%s
门诊患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊'  AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
急诊患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '急诊' AND t1.key_time BETWEEN %%s  AND %%s
急诊患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '急诊'  AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
住院患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.event_no,t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t1.key_time BETWEEN %%s AND %%s
住院患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.event_no,t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5  ON t1.event_no=t5.event_no WHERE t1.Zone_ID = %%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
门诊患者就诊使用中药饮片的处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='中药饮片'  AND recipe_id IN(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source ="门诊"  AND zone_id=%%s) AND key_date BETWEEN %%s AND %%s
急诊患者就诊使用中药饮片的处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='中药饮片'  AND recipe_id IN(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source ="急诊"  AND zone_id=%%s) AND key_date BETWEEN %%s AND %%s

急诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source in('急诊')and key_time between %%s and %%s
门急诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source in('门诊','急诊')and key_time between %%s and %%s
急诊草药方处方数量:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '急诊')   AND key_date BETWEEN %%s AND %%s
门急诊草药方处方数量:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source in ('门诊','急诊'))   AND key_date BETWEEN %%s AND %%s
门诊草药方处方总数:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '门诊')   AND key_date BETWEEN %%s AND %%s
门诊中药饮片总帖数:SELECT SUM(herb_packet_count) FROM %(dbname_dp)s.`opt_recipe` WHERE Recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 ))  AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
门诊中药饮片总味数:SELECT COUNT(drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id` = t2.`product_id` WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` = 0) AND recipe_id IN  (SELECT  recipe_id  FROM  %(dbname_dp)s.opt_recipe  WHERE recipe_source = '门诊')  AND zone_id = %%s AND key_time BETWEEN %%s AND %%s
最高处方金额:SELECT MAX(Recipe_Fee_Total) FROM %(dbname_dp)s.`opt_recipe` WHERE Zone_ID =%%s AND Key_Time between %%s and %%s
出院患者最高用药金额:select max(drug_money) from (select event_no,sum(price*despensing_num) as drug_money from  %(dbname_dp)s.`ipt_drug` where zone_id=%%s and Key_Time between %%s and %%s group by event_no) as drugmoney
术后使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1   AND t1.`Operation_Cut_Type` = 'Ⅰ' AND t2.zone_id=%%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>=0*60*60))
I类切口手术预防使用抗菌药物时间≤24小时:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No  WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s AND t1.Key_Time between %%s and %%s AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞24h且≤48h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 48 * 60 * 60)) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞48h且≤72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >48 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >72 * 60 * 60 )) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防'
术前24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` = 'Ⅰ'  AND t2.zone_id = %%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(operation_start_time,Invalid_Time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(operation_start_time,valid_time))>0*60*60))
术后24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` = 'Ⅰ'  AND t2.zone_id = %%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(valid_time,operation_end_time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>0*60*60))
收费前药师审核处方数:SELECT COUNT(Recipe_id) FROM %(dbname_dp)s.`opt_recipe` WHERE ((TIME_TO_SEC(TIMEDIFF(fee_taken_time,check_time))>0*60*60)) AND zone_id=%%s AND key_time BETWEEN %%s AND %%s

门诊总收入:SELECT sum(Fee_Total) FROM %(dbname_dp)s.`opt_fee` where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s and fee_from_no in (select from_no_in FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
急诊总收入:SELECT sum(Fee_Total) FROM %(dbname_dp)s.`opt_fee` where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s and fee_from_no in (select from_no_in FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
住院总收入:SELECT sum(Fee_Total) FROM %(dbname_dp)s.ipt_inpatient where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s

[drug_message]
门诊患者使用质子泵抑制剂费用:SELECT SUM(price * Despensing_Num) FROM	`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '质子泵抑制剂' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM opt_recipe WHERE	recipe_source ='门诊') AND key_time BETWEEN %%s AND %%s
门诊静脉输液药物费用:SELECT SUM(price * Despensing_Num) FROM	`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '输液药物' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM opt_recipe WHERE	recipe_source ='门诊') AND key_time BETWEEN %%s AND %%s
门诊患者使用药物总费用:select sum(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` where zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊') and key_time between %%s and %%s
急诊患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM	`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '输液药物' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM opt_recipe WHERE	recipe_source ='急诊') AND key_time BETWEEN %%s AND %%s
急诊患者使用质子泵抑制剂费用:SELECT SUM(price * Despensing_Num) FROM	`opt_recipe_drug` WHERE	id IN (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name` FROM opt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE(a.item_no_set_str, ',', '')) + 1) where a.analysis_type = '自定义分析' and a.analysis_result_type = '质子泵抑制剂' ORDER BY	a.id)AND zone_id = %%s AND recipe_id IN (	SELECT recipe_id FROM opt_recipe WHERE	recipe_source ='急诊') AND key_time BETWEEN %%s AND %%s
出院患者使用抗菌药物费用:SELECT	SUM(price * Despensing_Num) FROM `ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '抗菌药物'		ORDER BY	a.id) AND zone_id =%ss AND key_time BETWEEN %%s AND %%s;
出院患者使用质子泵抑制剂总费用:SELECT	SUM(price * Despensing_Num) FROM `ipt_drug` WHERE	Order_ID IN (SELECT	SUBSTRING_INDEX(SUBSTRING_INDEX(a.item_no_set_str,',',b.help_topic_id + 1),',' ,- 1) AS `name`	FROM	ipt_alertmessage a LEFT JOIN mysql.help_topic b ON b.help_topic_id < (LENGTH(a.item_no_set_str) - LENGTH(REPLACE (a.item_no_set_str, ',', '')) + 1)	WHERE	a.analysis_type = '自定义分析'	AND a.analysis_result_type = '质子泵抑制剂'	ORDER BY a.id) AND zone_id =%ss AND key_time BETWEEN %%s AND %%s;
门诊患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '门诊' ) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
急诊患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE  t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '急诊' ) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
急诊患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '急诊' ) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
住院患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE t1.`is_ignore` =0 ) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
住院患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE  drug_code LIKE '001002001%%' and t1.`is_ignore` =0 ) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s

[zone_ddds]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
self_values_ddd:select product_id,VALUE,unit from %(dbname_knowledge)s.tb_product_extend where owner=0 and type='DDD'
self_values_trans:select product_id,VALUE,unit from %(dbname_knowledge)s.tb_product_extend where owner=0 and type='TRANS'
product_ddd:select product_id,VALUE,unit from %(dbname_knowledge)s.tb_product_extend where owner=-1 and type='DDD'
product_trans:select product_id,VALUE,unit from %(dbname_knowledge)s.tb_product_extend where owner=-1 and type='TRANS'
门诊药品使用量:SELECT  t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2     ON t1.recipe_id = t2.recipe_id   INNER JOIN %(dbname_knowledge)s.`base_product` t3     ON t1.drug_id = t3.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t4     ON t3.map_product_id = t4.id WHERE t1.zone_id =%%s  AND t1.Key_Time BETWEEN %%s  AND %%s  AND t1.Antimicrobial = 1   AND t2.recipe_source = '门诊'
急诊患者抗菌药物使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id =%%s  AND t1.Key_Time between %%s and %%s  AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'
急诊碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2   ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.id =t5.product_id WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'  AND t5.drug_code LIKE '001003001007001004002%%'
急诊药品使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='急诊'
出院患者抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1  AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者特殊使用级抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit   FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 and t1.`Antimicrobial_Level`=3 AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者质子泵抑制剂药物使用量（累计DDD数）:SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t4  ON t3.id = t4.product_id  WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 AND t1.key_time BETWEEN %%s AND %%s   AND t4.analysis_type = '自定义分析'   AND t4.analysis_result_type = '质子泵抑制剂'   AND t1.Order_Type != '出院带药'
住院患者碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2   ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4    ON t3.id = t4.product_id WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 AND key_time BETWEEN %%s AND %%s  AND t4.drug_code LIKE '001003001007001004%%'
住院患者替加环素使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2     ON t1.drug_id = t2.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4   ON t3.id = t4.product_id  WHERE t1.zone_id = %%s AND key_time BETWEEN %%s AND %%s AND  t4.drug_code LIKE "001003001007004007%%"
住院患者抗真菌药物使用量（累计DDD数):SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id  WHERE t1.zone_id = %%s AND key_time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1   AND t4.drug_code LIKE "001003001005%%"
住院药品使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 AND t1.Key_Time BETWEEN %%s AND %%s
急诊消耗总克数:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1  AND t3.map_product_id=%%s and t2.recipe_source='急诊'
门诊消耗总克数:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1  AND t3.map_product_id=%%s and t2.recipe_source='门诊'
住院消耗总克数:SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1 AND t2.map_product_id=%%s

#缺省维度+机构 全院使用量指标及对应的SQL
[hospital_ddds]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
self_values_ddd:select product_id,VALUE,unit from tb_product_extend where owner=0 and type='DDD'
self_values_trans:select product_id,VALUE,unit from tb_product_extend where owner=0 and type='TRANS'
product_ddd:select product_id,VALUE,unit from tb_product_extend where owner=-1 and type='DDD'
product_trans:select product_id,VALUE,unit from tb_product_extend where owner=-1 and type='TRANS'
全院抗菌药物使用量:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 UNION ALL SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1)  rlt
全院特殊级抗菌药物使用量:SELECT * FROM (SELECT SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t1.`Antimicrobial_Level`=3 UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t1.`Antimicrobial_Level`=3)  rlt
全院注射剂型抗菌药物使用量（累计DDD数）:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit  FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t4.formulation='注射剂' UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t3.formulation='注射剂')  rlt
全院口服型抗菌药物使用量（累计DDD数）:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit  FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t4.formulation='肠胃道给药' UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t3.formulation='肠胃道给药')  rlt
消耗总克数:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t3.map_product_id=%%s UNION ALL SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1 AND t2.map_product_id=%%s)  rlt
全院患者使用数量:select sum(num) from (SELECT SUM(Despensing_Num) as num FROM %(dbname_dp)s.`ipt_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s) union SELECT SUM(Despensing_Num) as num FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s)) as rlt
全院患者使用频次:SELECT SUM(drugCount) from (SELECT COUNT(*) AS drugCount FROM  %(dbname_dp)s.`opt_recipe_drug` t WHERE t.Zone_ID = %%s  AND t.Key_Time BETWEEN %%s AND %%s AND t.Drug_ID IN (SELECT  b.product_id  FROM %(dbname_knowledge)s.`base_product` b WHERE b.map_product_id=%%s) UNION ALL SELECT COUNT(*) AS drugCount FROM  %(dbname_dp)s.`ipt_drug` t WHERE t.Zone_ID = %%s  AND t.Key_Time BETWEEN %%s AND %%s AND t.Drug_ID IN (SELECT  b.product_id  FROM %(dbname_knowledge)s.`base_product` b WHERE b.map_product_id=%%s)) AS result

#缺省+科室 计算使用量及消耗总克数
[dept_ddds]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
门诊药品使用量:SELECT  t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2     ON t1.recipe_id = t2.recipe_id   INNER JOIN %(dbname_knowledge)s.`base_product` t3     ON t1.drug_id = t3.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t4     ON t3.map_product_id = t4.id WHERE t1.zone_id =%%s AND t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s  AND %%s  AND t1.Antimicrobial = 1   AND t2.recipe_source = '门诊'
急诊患者抗菌药物使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id =%%s AND t2.dept_id=%%s AND t1.Key_Time between %%s and %%s  AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'
急诊碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2   ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.id =t5.product_id WHERE t1.zone_id = %%s AND t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'  AND t5.drug_code LIKE '001003001007001004002%%'
急诊药品使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.dept_id=%%s AND t1.Antimicrobial = 1 AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='急诊'
出院患者抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.`Event_No`=t4.event_no WHERE t1.zone_id = %%s  AND t4.out_dept_code = %%s  AND t1.Antimicrobial = 1  AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者特殊使用级抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit   FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.`Event_No`=t4.event_no WHERE t1.zone_id = %%s AND t4.out_dept_code = %%s AND t1.Antimicrobial = 1 and t1.`Antimicrobial_Level`=3 AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者质子泵抑制剂药物使用量（累计DDD数）:SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.`Event_No`=t4.event_no WHERE t1.zone_id = %%s AND t4.out_dept_code = %%s AND t1.Antimicrobial = 1 AND t1.key_time BETWEEN %%s AND %%s   AND t4.analysis_type = '自定义分析'   AND t4.analysis_result_type = '质子泵抑制剂'   AND t1.Order_Type != '出院带药'
住院患者碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2   ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4    ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t5  ON t1.`Event_No`=t5.event_no WHERE t1.zone_id = %%s AND t5.out_dept_code = %%s AND t1.Antimicrobial = 1 AND key_time BETWEEN %%s AND %%s  AND t4.drug_code LIKE '001003001007001004%%'
住院患者替加环素使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2     ON t1.drug_id = t2.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4   ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t5  ON t1.`Event_No`=t5.event_no WHERE t1.zone_id = %%s AND t5.out_dept_code = %%s AND key_time BETWEEN %%s AND %%s AND  t4.drug_code LIKE "001003001007004007%%"
住院患者抗真菌药物使用量（累计DDD数):SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t5  ON t1.`Event_No`=t5.event_no WHERE t1.zone_id = %%s AND t5.out_dept_code = %%s AND key_time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1   AND t4.drug_code LIKE "001003001005%%"
住院药品使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.`Event_No`=t4.event_no  WHERE t1.zone_id = %%s AND t4.out_dept_code = %%s AND t1.Antimicrobial = 1 AND t1.Key_Time BETWEEN %%s AND %%s
急诊消耗总克数:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1  AND t3.map_product_id=%%s and t2.recipe_source='急诊'
门诊消耗总克数:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1  AND t3.map_product_id=%%s and t2.recipe_source='门诊'
住院消耗总克数:SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t4 ON t1.event_no = t4.event_no WHERE t1.zone_id = %%s AND t4.out_dept_code = %%s AND t1.Key_Time BE TWEEN %%s AND %%s  AND t1.Antimicrobial = 1 AND t2.map_product_id=%%s

#缺省维度+科室 全院使用量指标及对应的SQL
[hospitalDept_ddds]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
全院抗菌药物使用量:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 UNION ALL SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t5.out_dept_code = %%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1)  rlt
全院特殊级抗菌药物使用量:SELECT * FROM (SELECT SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t1.`Antimicrobial_Level`=3 UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t5.out_dept_code = %%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t1.`Antimicrobial_Level`=3)  rlt
全院注射剂型抗菌药物使用量（累计DDD数）:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit  FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t4.formulation='注射剂' UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t5.out_dept_code = %%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t3.formulation='注射剂')  rlt
全院口服型抗菌药物使用量（累计DDD数）:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit  FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t4.formulation='肠胃道给药' UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t5.out_dept_code = %%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t3.formulation='肠胃道给药')  rlt
消耗总克数:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t3.map_product_id=%%s UNION ALL SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t5.out_dept_code = %%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1 AND t2.map_product_id=%%s)  rlt

#缺省+医生 计算使用量及消耗总克数
[doc_ddds]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
门诊药品使用量:SELECT  t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2     ON t1.recipe_id = t2.recipe_id   INNER JOIN %(dbname_knowledge)s.`base_product` t3     ON t1.drug_id = t3.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t4     ON t3.map_product_id = t4.id WHERE t1.zone_id =%%s AND t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s  AND %%s  AND t1.Antimicrobial = 1   AND t2.recipe_source = '门诊'
急诊患者抗菌药物使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id =%%s AND t2.recipe_doc_id=%%s AND t1.Key_Time between %%s and %%s  AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'
急诊碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2   ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.id =t5.product_id WHERE t1.zone_id = %%s AND t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'  AND t5.drug_code LIKE '001003001007001004002%%'
急诊药品使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.recipe_doc_id=%%s AND t1.Antimicrobial = 1 AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='急诊'
出院患者抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.`Event_No`=t4.event_no WHERE t1.zone_id = %%s  AND t1.Order_Doc_ID=%%s  AND t1.Antimicrobial = 1  AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者特殊使用级抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit   FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.`Event_No`=t4.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Antimicrobial = 1 and t1.`Antimicrobial_Level`=3 AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Order_Type != '出院带药'
出院患者质子泵抑制剂药物使用量（累计DDD数）:SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.`Event_No`=t4.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Antimicrobial = 1 AND t1.key_time BETWEEN %%s AND %%s   AND t4.analysis_type = '自定义分析'   AND t4.analysis_result_type = '质子泵抑制剂'   AND t1.Order_Type != '出院带药'
住院患者碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2   ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4    ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t5  ON t1.`Event_No`=t5.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Antimicrobial = 1 AND key_time BETWEEN %%s AND %%s  AND t4.drug_code LIKE '001003001007001004%%'
住院患者替加环素使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2     ON t1.drug_id = t2.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4   ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t5  ON t1.`Event_No`=t5.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND key_time BETWEEN %%s AND %%s AND  t4.drug_code LIKE "001003001007004007%%"
住院患者抗真菌药物使用量（累计DDD数):SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id   INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t5  ON t1.`Event_No`=t5.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND key_time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1   AND t4.drug_code LIKE "001003001005%%"
住院药品使用量（累计DDD数）:SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.`Event_No`=t4.event_no  WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Antimicrobial = 1 AND t1.Key_Time BETWEEN %%s AND %%s
急诊消耗总克数:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1  AND t3.map_product_id=%%s and t2.recipe_source='急诊'
门诊消耗总克数:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1  AND t3.map_product_id=%%s and t2.recipe_source='门诊'
住院消耗总克数:SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t4 ON t1.event_no = t4.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Key_Time BE TWEEN %%s AND %%s  AND t1.Antimicrobial = 1 AND t2.map_product_id=%%s

#缺省维度+医生 全院使用量指标及对应的SQL
[hospitalDoc_ddds]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
全院抗菌药物使用量:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 UNION ALL SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1)  rlt
全院特殊级抗菌药物使用量:SELECT * FROM (SELECT SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t1.`Antimicrobial_Level`=3 UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t1.`Antimicrobial_Level`=3)  rlt
全院注射剂型抗菌药物使用量（累计DDD数）:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit  FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t4.formulation='注射剂' UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t3.formulation='注射剂')  rlt
全院口服型抗菌药物使用量（累计DDD数）:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit  FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t4.formulation='肠胃道给药' UNION ALL SELECT t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Key_Time BETWEEN %%s AND %%s   AND t1.Antimicrobial = 1 AND t3.formulation='肠胃道给药')  rlt
消耗总克数:SELECT * FROM (SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit   FROM  %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t3.map_product_id=%%s UNION ALL SELECT  t2.`product_id`,t2.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t3.enSpecUnit,t3.specquantity , t3.ddd,t3.dddunit  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_dp)s.ipt_inpatient t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s AND t1.Order_Doc_ID=%%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t1.Antimicrobial = 1 AND t2.map_product_id=%%s)  rlt

#计算指标及对应的计算公式（两个指标相除）
[item_calc]
门诊就诊使用抗菌药物的百分率:门诊患者就诊使用抗菌药物处方人次/门诊患者就诊总人次
门诊静脉输液使用百分率:门诊静脉输液处方人次/门诊患者就诊总人次
门诊患者抗菌药物静脉使用人次占比:门诊患者静脉使用抗菌药物处方人次/门诊患者就诊使用抗菌药物处方人次
门诊患者质子泵抑制剂处方人次比例:门诊患者就诊使用质子泵抑制剂处方人次/门诊患者就诊使用药物处方人次（不含中药饮片）
门诊使用中药注射剂输液处方人次比例:门诊使用中药注射剂输液处方人次/门诊患者就诊总人次
急诊就诊使用抗菌药物的百分率:急诊患者就诊使用抗菌药物处方人次/急诊患者就诊总人次
急诊静脉输液使用百分率:急诊患者就诊使用抗菌药物处方人次/急诊患者就诊总人次
急诊患者抗菌药物静脉使用人次占比:急诊患者静脉使用抗菌药物处方人次/急诊患者就诊使用抗菌药物处方人次
急诊患者质子泵抑制剂处方人次比例:急诊患者就诊使用质子泵抑制剂处方人次/急诊患者就诊使用药物处方人次（不含中药饮片）
门急诊患者抗菌药物静脉使用人次占比:门急诊患者静脉使用抗菌药物处方人次/门急诊患者就诊使用抗菌药物处方人次
住院患者静脉输液使用百分率:出院患者中使用静脉输液人次/出院患者总人次
住院患者联合使用抗菌药物占比:出院患者中联合使用抗菌药物人次/出院患者使用抗菌药物人次

门诊抗菌药物费用占比:门诊患者使用抗菌药物费用/门诊患者使用药物总费用（排除中药饮片）
门诊静脉输液药物费用占比:门诊静脉输液药物费用/门诊患者使用药物总费用
急诊抗菌药物费用占比:急诊患者使用抗菌药物费用/急诊患者使用药物总费用(排除中药饮片）
住院患者抗菌药物费用占比:出院患者使用抗菌药物费用/出院患者使用药物总费用(排除中药饮片）
清洁手术预防使用抗菌药物比例:I类切口手术预防使用抗菌药物例次/出院患者I类切口手术例次
原则上不需要预防使用抗菌药物的清洁手术预防使用抗菌药物比例:原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次/原则上不需要预防使用抗菌药物I类切口手术例次
清洁手术预防使用抗菌药物品种选择合理率:I类切口手术预防使用抗菌药物品种选择合理例次/I类切口手术预防使用抗菌药物例次
抗菌药物处方在门诊处方的比例（≥14岁患者）:≥14岁患者抗菌药物门诊处方数/门诊处方总数
抗菌药物处方在门诊处方的比例（＜14岁患者）:＜14岁患者抗菌药物门诊处方数/门诊处方总数
门诊患者抗菌药物处方占比:门诊抗菌药物处方数/门诊处方总数（排除中药饮片）

急诊抗菌药物处方数占比:急诊抗菌药物处方数/急诊处方总数（排除中药饮片）
门诊质子泵抑制剂费用占比:门诊患者使用质子泵抑制剂费用/门诊患者使用药物总费用（排除中药饮片）
急诊质子泵抑制剂费用占比:急诊患者使用质子泵抑制剂费用/急诊患者使用药物总费用(排除中药饮片）
住院患者人均使用质子泵抑制剂百分率:出院患者使用质子泵抑制剂的出院总人数/出院患者总人次
住院质子泵抑制剂费用占比:出院患者使用质子泵抑制剂总费用/出院患者使用药物总费用(排除中药饮片）
住院质子泵抑制剂预防用药百分率:出院患者预防使用质子泵抑制剂的出院总人数/出院患者使用质子泵抑制剂的出院总人数
急诊患者碳青霉烯类抗菌药物使用量占比:急诊碳青霉烯类抗菌药物使用量（累计DDD数）/急诊患者抗菌药物使用量
住院患者特殊使用级抗菌药物使用量占比:出院患者特殊使用级抗菌药物使用量（累计DDD数）/出院患者抗菌药物使用量（累计DDD数）
门诊静脉输液处方占比:门诊静脉输液处方数/门诊处方总数（排除中药饮片）
门诊抗菌药物静脉输液处方占比（≥14岁）:门诊抗菌药物静脉输液处方数（≥14岁）/门诊处方总数（排除中药饮片）
门诊抗菌药物静脉输液处方占比（＜14岁）:门诊抗菌药物静脉输液处方数（＜14岁）/门诊处方总数（排除中药饮片）
门诊抗菌药物静脉输液处方占比:门诊抗菌药物静脉输液处方数/门诊处方总数（排除中药饮片）
门诊中药注射剂输液处方占比:门诊中药注射剂输液处方数/门诊处方总数
急诊静脉输液处方占比:急诊静脉输液处方数/急诊处方总数（排除中药饮片）
急诊抗菌药物静脉输液处方占比:急诊抗菌药物静脉输液处方数/急诊处方总数（排除中药饮片）
门急诊静脉输液处方占比:门急诊静脉输液处方数/门急诊处方总数（排除中药饮片）
门急诊抗菌药物静脉输液处方占比:门急诊抗菌药物静脉输液处方数/门急诊处方总数（排除中药饮片）
门诊静脉输液药品品规占比:门诊静脉输液药品品规数/门诊药品总品规数
门诊病人均次药品费:门诊患者使用药物总费用（排除中药饮片）/门诊患者就诊总人次
门诊患者人均用药品种数:门诊患者单次就诊用药品种数/门诊患者就诊总人次
门诊患者处方人均使用抗菌药物品种数:门诊患者单次就诊使用抗菌药物累计品种数/门诊患者就诊使用抗菌药物处方人次
门诊患者处方人均使用质子泵抑制剂品种数:门诊患者单次就诊使用质子泵抑制剂品种数/门诊患者就诊使用质子泵抑制剂处方人次
急诊病人均次药品费:急诊患者使用药物总费用(排除中药饮片）/急诊患者就诊总人次
急诊患者处方人均使用抗菌药物品种数:急诊患者单次就诊使用抗菌药物累计品种数/急诊患者就诊使用抗菌药物处方人次
急诊患者处方人均使用质子泵抑制剂品种数:急诊患者单次就诊使用质子泵抑制剂品种数/急诊患者就诊使用质子泵抑制剂处方人次
出院病人均次药品费:出院患者使用药物总费用(排除中药饮片）/出院患者总人次
住院患者人均使用质子泵抑制剂品种数:住院患者单次就诊使用质子泵抑制剂品种数/出院患者使用质子泵抑制剂的出院总人数
住院患者人均使用质子泵抑制剂费用:出院患者使用质子泵抑制剂总费用/出院患者使用质子泵抑制剂的出院总人数
住院患者人均使用抗菌药物品种数:住院患者单次就诊使用抗菌药物累计品种数/出院患者使用抗菌药物人次
住院患者人均使用抗菌药物费用:出院患者使用抗菌药物费用/出院患者使用抗菌药物人次

住院患者碳青霉烯类抗菌药物使用率:出院患者使用碳青霉烯类抗菌药物人次/出院患者总人次
住院患者替加环素使用率:出院患者使用替加环素人次/出院患者总人次
住院患者使用抗真菌药物使用率:出院患者使用抗真菌药物人次/出院患者总人次
住院患者抗菌药物使用率:出院患者使用抗菌药物人次/出院患者总人次
住院患者特殊级抗菌药物使用率:出院患者使用特殊级抗菌药物人次/出院患者使用抗菌药物人次
国家基药目录品种使用金额比例:国家基药目录品种使用金额/医疗药品总收入（排除中药饮片）
抗菌药物占药品使用金额比例:全院抗菌药物使用金额/医疗药品总收入（排除中药饮片）
抗菌药物处方在门诊处方的比例（≥14岁患者):≥14岁患者抗菌药物门诊处方数/门诊处方总数
抗菌药物处方在门诊处方的比例（＜14岁患者）:＜14岁患者抗菌药物门诊处方数/门诊处方总数
住院治疗使用抗菌药物患者使用前病原学检查检查率:出院患者中抗菌药物治疗使用前病原学检查送检人次/出院患者中抗菌药物治疗使用人次
住院使用抗菌药物患者病原学检查百分率:使用抗菌药物出院患者中病原学检查送检人次/出院患者使用抗菌药物人次
I类切口预防用抗菌药物时间＞72h百分率:I类切口预防用抗菌药物时间＞72h/I类切口手术例数
门诊中药饮片帖均味数:门诊中药饮片总味数/门诊中药饮片总帖数
门诊中药饮片帖均费用:门诊患者使用中药饮片总费用/门诊中药饮片总帖数
门诊人均输液量:门诊输液药物输液总量/门诊静脉输液处方人次
住院平均床日输液量:住院输液药物输液总量/出院患者总人次*(出院患者住院总天数/出院患者总人次)
I类切口预防用抗菌药物时间＞24h且≤48h占比:I类切口预防用抗菌药物时间＞24h且≤48h例数/出院患者I类切口手术例次
I类切口预防用抗菌药物时间＞48h且≤72h占比:I类切口预防用抗菌药物时间＞48h且≤72h例数/出院患者I类切口手术例次

#计算指标及对应的公式（计算之后的结果乘100）
[item_calc100]
住院患者抗菌药物使用强度:出院患者抗菌药物使用量（累计DDD数）/出院患者住院总天数
住院患者质子泵抑制剂使用强度:出院患者质子泵抑制剂药物使用量（累计DDD数）/出院患者住院总天数
住院患者碳青霉烯类抗菌药物使用强度:住院患者碳青霉烯类抗菌药物使用量（累计DDD数）/出院患者住院总天数
住院患者替加环素使用强度:住院患者替加环素使用量（累计DDD数）/出院患者住院总天数
住院患者抗真菌药使用强度:住院患者抗真菌药物使用量（累计DDD数)/出院患者住院总天数
住院患者特殊使用级抗菌药物使用强度:出院患者特殊使用级抗菌药物使用量（累计DDD数）/出院患者住院总天数
门诊三级警示信息发生次数占比(%):门诊三级警示信息发生次数/门诊所有警示等级发生次数
门诊四级警示信息发生次数占比(%):门诊四级警示信息发生次数/门诊所有警示等级发生次数
门诊五级警示信息发生次数占比(%):门诊五级警示信息发生次数/门诊所有警示等级发生次数
住院三级警示信息发生次数占比(%):住院三级警示信息发生次数/住院所有警示等级发生次数
住院四级警示信息发生次数占比(%):住院四级警示信息发生次数/住院所有警示等级发生次数
住院五级警示信息发生次数占比(%):住院五级警示信息发生次数/住院所有警示等级发生次数
住院三级警示信息人次占比(%):住院三级警示信息人次数/出院患者总人次
住院四级警示信息人次占比(%):住院四级警示信息人次数/出院患者总人次
住院五级警示信息人次占比(%):住院五级警示信息人次数/出院患者总人次
三级警示信息发生处方占比(%):三级警示信息发生处方数/门诊处方总数
四级警示信息发生处方占比(%):四级警示信息发生处方数/门诊处方总数
五级警示信息发生处方占比(%):五级警示信息发生处方数/门诊处方总数

门诊适宜性过敏占比:门诊适宜性过敏/门诊不适宜问题发生数
门诊适宜性配伍占比:门诊适宜性配伍/门诊不适宜问题发生数
门诊适宜性用法用量占比:门诊适宜性用法用量/门诊不适宜问题发生数
门诊适宜性特殊人群占比:门诊适宜性特殊人群/门诊不适宜问题发生数
门诊适宜性相互作用占比:门诊适宜性相互作用/门诊不适宜问题发生数
门诊适宜性给药途径占比:门诊适宜性给药途径/门诊不适宜问题发生数
门诊适宜性重复用药占比:门诊适宜性重复用药/门诊不适宜问题发生数
门诊适宜性给药时机占比:门诊适宜性给药时机/门诊不适宜问题发生数
住院适宜性不良反应占比:住院适宜性给药时机/住院不适宜问题发生数
住院适宜性肾功能占比:住院适宜性肾功能/住院不适宜问题发生数
住院适宜性适应症占比:住院适宜性适应症/住院不适宜问题发生数
住院适宜性诊断占比:住院适宜性诊断/住院不适宜问题发生数
门诊适宜性诊断占比:门诊适宜性诊断/门诊不适宜问题发生数
门诊适宜性适应症占比:门诊适宜性适应症/门诊不适宜问题发生数
门诊适宜性肾功能占比:门诊适宜性肾功能/门诊不适宜问题发生数
门诊适宜性不良反应占比:门诊适宜性不良反应/门诊不适宜问题发生数
住院适宜性配伍占比:住院适宜性配伍/住院不适宜问题发生数
住院适宜性相互作用占比:住院适宜性相互作用/住院不适宜问题发生数
住院适宜性给药途径占比:住院适宜性给药途径/住院不适宜问题发生数
住院适宜性给药时机占比:住院适宜性给药时机/住院不适宜问题发生数
住院适宜性用法用量占比:住院适宜性用法用量/住院不适宜问题发生数
住院适宜性过敏占比:住院适宜性过敏/住院不适宜问题发生数
住院适宜性重复用药占比:住院适宜性重复用药/住院不适宜问题发生数
住院适宜性特殊人群占比:住院适宜性特殊人群/住院不适宜问题发生数

急诊适宜性过敏占比:急诊适宜性过敏/急诊不适宜问题发生数
急诊适宜性配伍占比:急诊适宜性配伍/急诊不适宜问题发生数
急诊适宜性用法用量占比:急诊适宜性用法用量/急诊不适宜问题发生数
急诊适宜性特殊人群占比:急诊适宜性特殊人群/急诊不适宜问题发生数
急诊适宜性相互作用占比:急诊适宜性相互作用/急诊不适宜问题发生数
急诊适宜性给药途径占比:急诊适宜性给药途径/急诊不适宜问题发生数
急诊适宜性重复用药占比:急诊适宜性重复用药/急诊不适宜问题发生数
急诊适宜性给药时机占比:急诊适宜性给药时机/急诊不适宜问题发生数
急诊适宜性诊断占比:急诊适宜性诊断/急诊不适宜问题发生数
急诊适宜性适应症占比:急诊适宜性适应症/急诊不适宜问题发生数
急诊适宜性肾功能占比:急诊适宜性肾功能/急诊不适宜问题发生数
急诊适宜性不良反应占比:急诊适宜性不良反应/急诊不适宜问题发生数

#计算指标及对应的公式（两个指标相减）
[item_calc_minus]
门诊患者就诊使用药物处方人次（不含中药饮片）:门诊患者就诊总人次-门诊患者就诊使用中药饮片的处方人次
急诊患者就诊使用药物处方人次（不含中药饮片）:急诊患者就诊总人次-急诊患者就诊使用中药饮片的处方人次
门诊患者使用药物总费用（排除中药饮片）:门诊患者使用药物总费用-门诊患者使用中药饮片总费用
急诊患者使用药物总费用(排除中药饮片）:急诊患者使用药物总费用-急诊患者使用中药饮片总费用
出院患者使用药物总费用(排除中药饮片）:住院患者使用药物总费用-住院患者使用中药饮片总费用
医疗药品总收入（排除中药饮片）:医疗药品总收入-全院患者使用中药饮片费用
门诊处方总数（排除中药饮片）:门诊处方总数-门诊草药方处方总数
急诊处方总数（排除中药饮片）:急诊处方总数-急诊草药方处方数量
门急诊处方总数（排除中药饮片）:门急诊处方总数-门急诊草药方处方数量

#缺省维度+机构 需要获取配置项的指标
[ConfigurationItem_zone]
原则上不需要预防使用抗菌药物I类切口手术例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND t1.Zone_ID = %%s  AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND t1.`Operation_Name` REGEXP %%s
原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次:SELECT COUNT(Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND Drug_Using_Aim = '预防' AND Antimicrobial = 1 AND t1.Zone_ID = %%s  AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND t1.`Operation_Name` REGEXP %%s
使用抗菌药物出院患者中病原学检查送检人次:SELECT COUNT(DISTINCT t1.`Patient_Id`) FROM  %(dbname_dp)s.ipt_inpatient t1  INNER JOIN %(dbname_dp)s.ipt_drug t2  ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3  ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s  AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s  AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗'
出院患者中抗菌药物治疗使用前病原学检查送检人次:SELECT COUNT(DISTINCT t1.`Patient_Id`) FROM %(dbname_dp)s.ipt_inpatient t1 INNER JOIN %(dbname_dp)s.ipt_drug t2 ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3 ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s  AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗' AND TIMESTAMPDIFF(SECOND,Order_Time,Sample_Collect_Time)<0
I类切口手术预防使用抗菌药物品种选择合理例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE  t1.Zone_ID = %%s and t1.key_time between %%s and %%s AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN(SELECT event_no FROM %(dbname_dp)s.`ipt_drug` t3 WHERE t3.`Drug_ID` IN (SELECT t4.product_id FROM %(dbname_knowledge)s.`base_product` t4 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.map_product_id=t5.product_id WHERE drug_code regexp %%s))


#缺省维度+科室 需要获取配置项的指标
[ConfigurationItem_dept]
原则上不需要预防使用抗菌药物I类切口手术例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND t1.Zone_ID = %%s and t3.out_dept_code = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND t1.`Operation_Name` REGEXP %%s
原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次:SELECT COUNT(Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND Drug_Using_Aim = '预防' AND Antimicrobial = 1 AND t1.Zone_ID = %%s and t3.out_dept_code = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND t1.`Operation_Name` REGEXP %%s
使用抗菌药物出院患者中病原学检查送检人次:SELECT COUNT(DISTINCT t1.`Patient_Id`) FROM  %(dbname_dp)s.ipt_inpatient t1  INNER JOIN %(dbname_dp)s.ipt_drug t2  ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3  ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s AND t1.out_dept_code = %%s AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s  AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗'
出院患者中抗菌药物治疗使用前病原学检查送检人次:SELECT COUNT(DISTINCT t1.`Patient_Id`) FROM %(dbname_dp)s.ipt_inpatient t1 INNER JOIN %(dbname_dp)s.ipt_drug t2 ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3 ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s AND t1.out_dept_code = %%s AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗' AND TIMESTAMPDIFF(SECOND,Order_Time,Sample_Collect_Time)<0
I类切口手术预防使用抗菌药物品种选择合理例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE  t1.Zone_ID = %%s and t3.out_dept_code = %%s and t1.key_time between %%s and %%s AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN(SELECT event_no FROM %(dbname_dp)s.`ipt_drug` t3 WHERE t3.`Drug_ID` IN (SELECT t4.product_id FROM %(dbname_knowledge)s.`base_product` t4 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.map_product_id=t5.product_id WHERE drug_code regexp %%s))

#缺省维度+医生 需要获取配置项的指标
[ConfigurationItem_doc]
原则上不需要预防使用抗菌药物I类切口手术例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND t1.Zone_ID = %%s and t2.Order_Doc_ID=%%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND t1.`Operation_Name` REGEXP %%s
原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次:SELECT COUNT(Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND Drug_Using_Aim = '预防' AND Antimicrobial = 1 AND t1.Zone_ID = %%s and t2.Order_Doc_ID=%%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND t1.`Operation_Name` REGEXP %%s
使用抗菌药物出院患者中病原学检查送检人次:SELECT COUNT(DISTINCT t1.`Patient_Id`) FROM  %(dbname_dp)s.ipt_inpatient t1  INNER JOIN %(dbname_dp)s.ipt_drug t2  ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3  ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s AND t2.Order_Doc_ID=%%s AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s  AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗'
出院患者中抗菌药物治疗使用前病原学检查送检人次:SELECT COUNT(DISTINCT t1.`Patient_Id`) FROM %(dbname_dp)s.ipt_inpatient t1 INNER JOIN %(dbname_dp)s.ipt_drug t2 ON t1.Event_No = t2.Event_No INNER JOIN %(dbname_dp)s.`ipt_lab_report` t3 ON t2.Event_No = t3.`Event_No` WHERE t1.Zone_ID = %%s AND t2.Order_Doc_ID=%%s AND t1.Key_Time between %%s and %%s  AND t3.Exam_Item REGEXP %%s AND t2.Antimicrobial = 1 AND t2.Drug_Using_Aim = '治疗' AND TIMESTAMPDIFF(SECOND,Order_Time,Sample_Collect_Time)<0
I类切口手术预防使用抗菌药物品种选择合理例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3  ON t2.`Event_No`=t3.event_no WHERE  t1.Zone_ID = %%s and t2.Order_Doc_ID=%%s and t1.key_time between %%s and %%s AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN(SELECT event_no FROM %(dbname_dp)s.`ipt_drug` t3 WHERE t3.`Drug_ID` IN (SELECT t4.product_id FROM %(dbname_knowledge)s.`base_product` t4 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.map_product_id=t5.product_id WHERE drug_code regexp %%s))

#缺省维度+医生 常规指标及对应的SQL
[default_doc]
门诊患者就诊总人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source='门诊' and recipe_doc_id=%%s and key_time between %%s and %%s
门诊患者静脉使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊' and recipe_doc_id=%%s) and key_date between %%s and %%s
门诊静脉输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s  AND recipe_id in (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊' and recipe_doc_id=%%s) and key_date between %%s and %%s
门诊患者就诊使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊' and recipe_doc_id=%%s) and key_date between %%s and %%s
门诊患者就诊使用质子泵抑制剂处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s  AND recipe_id in (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊' and recipe_doc_id=%%s) and key_date between %%s and %%s
门诊使用中药注射剂输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='中药注射剂输液' AND zone_id=%%s  AND recipe_id in (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊' and recipe_doc_id=%%s) and key_date between %%s and %%s
急诊患者就诊总人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source='急诊' and recipe_doc_id=%%s and key_time between %%s and %%s
急诊患者静脉使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊' and recipe_doc_id=%%s) and key_date between %%s and %%s
急诊患者就诊使用抗菌药物处方人次 :SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and recipe_doc_id=%%s) and key_date between %%s and %%s
急诊静脉输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and recipe_doc_id=%%s) and key_date between %%s and %%s
急诊患者就诊使用质子泵抑制剂处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and recipe_doc_id=%%s) and key_date between %%s and %%s
门急诊患者就诊使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source in ("急诊","门诊") and recipe_doc_id=%%s) and key_date between %%s and %%s
门急诊患者静脉使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source in ("急诊","门诊") and recipe_doc_id=%%s) and key_date between %%s and %%s
门急诊就诊处方人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source in ('急诊','门诊') and recipe_doc_id=%%s and key_time between %%s and %%s
出院患者总人次:SELECT COUNT(patient_id) FROM %(dbname_dp)s.`ipt_inpatient` t1 WHERE zone_id=%%s and t1.event_no in(select t2.event_no from%(dbname_dp)s.ipt_drug  t2 where t2.Order_Doc_ID=%%s ) and  key_time between %%s and %%s
出院患者使用抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s and event_no in(select event_no from%(dbname_dp)s.ipt_drug   where Order_Doc_ID=%%s)AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者中抗菌药物治疗使用人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_using_aim='治疗' and Order_Doc_ID=%%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者中使用静脉输液人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s and event_no in(select event_no from%(dbname_dp)s.ipt_drug   where Order_Doc_ID=%%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s and event_no in(select event_no from%(dbname_dp)s.ipt_drug   where Order_Doc_ID=%%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者预防使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_using_aim='预防' and Order_Doc_ID=%%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用碳青霉烯类抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007001004%%') and  zone_id=%%s AND Order_Doc_ID=%%s  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)  AND Antimicrobial=1
出院患者使用替加环素人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007004%%') AND zone_id=%%s AND Order_Doc_ID=%%s  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用抗真菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug`  WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE t2.drug_code LIKE '001003001%%') AND zone_id=%%s AND Order_Doc_ID=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用特殊级抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE Antimicrobial_Level=3 and Order_Doc_ID=%%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
住院三级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=3 and event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and key_date between %%s and %%s
住院四级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=4  and event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and key_date between %%s and %%s
住院五级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=5  and event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and key_date between %%s and %%s
门诊患者使用质子泵抑制剂费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN (SELECT Recipe_id FROM %(dbname_dp)s.`opt_alertmessage` WHERE  analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂')  AND zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊' and  Recipe_Doc_Id=%%s) and key_time between %%s and %%s
门诊静脉输液药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN (SELECT Recipe_id FROM %(dbname_dp)s.`opt_alertmessage` WHERE  analysis_type='自定义分析' AND analysis_result_type='输液药物') AND drug_id IN(SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t1.is_ignore =0) AND zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊' and  Recipe_Doc_Id=%%s) and key_time between %%s and %%s
门诊患者使用药物总费用:select sum(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` where zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊' and  Recipe_Doc_Id=%%s) and key_time between %%s and %%s
急诊患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID=%%s  AND Antimicrobial= 1 AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='急诊' and  Recipe_Doc_Id=%%s) AND key_time between %%s and %%s
急诊患者使用质子泵抑制剂费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN (SELECT Recipe_id FROM %(dbname_dp)s.`opt_alertmessage` WHERE  analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂') AND zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='急诊' and  Recipe_Doc_Id=%%s) and key_time between %%s and %%s
出院患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE Zone_ID=%%s  AND Antimicrobial= 1 AND Order_Doc_ID=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
出院患者使用质子泵抑制剂总费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE Zone_ID=%%s AND Order_Doc_ID=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s) AND drug_id  IN(SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t1.is_ignore =0) AND event_no IN (SELECT event_no  FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂')
门诊患者就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '门诊' and t4.Recipe_Doc_Id=%%s AND t1.key_time BETWEEN %%s  AND %%s
门诊患者就诊用药总品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' and t4.Recipe_Doc_Id=%%s AND t1.key_time BETWEEN %%s  AND %%s
门诊患者就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' and t4.Recipe_Doc_Id=%%s  AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
急诊患者就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '急诊' and t4.Recipe_Doc_Id=%%s AND t1.key_time BETWEEN %%s  AND %%s
急诊患者就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '急诊' and t4.Recipe_Doc_Id=%%s  AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
出院患者使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1 and t1.Order_Doc_ID=%%s  AND t4.key_time BETWEEN %%s AND %%s
出院患者使用质子泵抑制剂总品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5  ON t1.event_no=t5.event_no WHERE t1.Zone_ID = %%s  and t1.Order_Doc_ID=%%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t4.key_time BETWEEN %%s AND %%s
出院患者住院总天数:select sum(datediff(discharge_date,in_dpet_time)) FROM %(dbname_dp)s.`ipt_inpatient` where zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and key_time  between %%s and %%s
出院患者I类切口手术例次:SELECT COUNT(*) FROM %(dbname_dp)s.`ipt_operation` WHERE  Zone_ID = %%s  AND Operation_Cut_Type = 'Ⅰ' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
I类切口手术预防使用抗菌药物例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t2.Order_Doc_ID=%%s and t1.key_time between %%s and %%s
原则上不需要预防使用抗菌药物I类切口手术例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE Operation_Cut_Type = 'Ⅰ' AND t1.Zone_ID = %%s AND t1.`Operation_Name` REGEXP '甲|乳|疝|关节镜检查|颈动脉内膜剥脱|颅骨肿物切除|白内障' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t2.Order_Doc_ID=%%s and t1.key_time between %%s and %%s
原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE Operation_Cut_Type = 'Ⅰ' AND Drug_Using_Aim = '预防' AND Antimicrobial = 1 AND t1.Zone_ID = %%s AND  t1.`Operation_Name` REGEXP '甲|乳|疝|关节镜检查|颈动脉内膜剥脱|颅骨肿物切除|白内障' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t2.Order_Doc_ID=%%s and t1.key_time between %%s and %%s
I类切口手术预防使用抗菌药物品种选择合理例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN(SELECT event_no FROM %(dbname_dp)s.`ipt_drug` t3 WHERE t3.`Drug_ID` IN (SELECT t4.product_id FROM %(dbname_knowledge)s.`base_product` t4 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.map_product_id=t5.product_id WHERE drug_code LIKE "001003001007001002001%%")) AND t2.Order_Doc_ID=%%s and t1.key_time between %%s and %%s
出院患者预防使用抗菌药物手术例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND t1.Zone_ID = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t2.Order_Doc_ID=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE key_time between %%s and %%s)
I类切口手术前0.5-2.0小时内给药例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND t1.Zone_ID = %%s  AND t2.Order_Doc_ID=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 2 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 2 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))
总手术例次:select count(distinct(operation_no)) FROM %(dbname_dp)s.`ipt_operation` where zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE Order_Doc_ID=%%s) and key_time between %%s and %%s
门诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source='门诊' AND Recipe_Doc_Id=%%s and key_time between %%s and %%s
≥14岁患者抗菌药物门诊处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.opt_alertrecipe t1 WHERE t1.age_as_num >= 140000 and t1.recipe_source='门诊' AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_alertmessage t2 WHERE analysis_type = '自定义分析'  AND analysis_result_type = '抗菌药物'  AND t2.zone_id =%%s) and recipe_id in(select recipe_id FROM %(dbname_dp)s.opt_recipe where Recipe_Doc_Id=%%s) and t1.key_date between %%s and %%s
＜14岁患者抗菌药物门诊处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.opt_alertrecipe t1 WHERE t1.age_as_num < 140000 and t1.recipe_source='门诊'  AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_alertmessage t2 WHERE analysis_type = '自定义分析'  AND analysis_result_type = '抗菌药物' AND t2.zone_id =%%s) and recipe_id in(select recipe_id FROM %(dbname_dp)s.opt_recipe where Recipe_Doc_Id=%%s) and t1.key_date between %%s and %%s
门诊静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '输液药物'  AND zone_id = %%s   AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊' and recipe_doc_id=%%s)  AND key_time between %%s and %%s
门诊抗菌药物静脉输液处方数（≥14岁）:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source = '门诊' and recipe_doc_id=%%s)   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_alertrecipe`  WHERE age_as_num >= 14) AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数（＜14岁）:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source = '门诊' and recipe_doc_id=%%s)   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_alertrecipe`  WHERE age_as_num < 14) AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊' and recipe_doc_id=%%s) AND key_date between %%s and %%s
门诊中药注射剂输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药注射剂输液'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊' and recipe_doc_id=%%s) AND key_date between %%s and %%s
门诊抗菌药物处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊' and recipe_doc_id=%%s) AND key_date between %%s and %%s
三级警示信息发生处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2  WHERE t2.check_status IN (0, 1)) AND t1.zone_id = %%s  AND t1.severity = 3   AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE Recipe_Doc_Id=%%s) AND key_date BETWEEN %%s  AND %%s
四级警示信息发生处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2  WHERE t2.check_status IN (0, 1)) AND t1.zone_id = %%s  AND t1.severity = 4   AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE Recipe_Doc_Id=%%s) AND key_date BETWEEN %%s  AND %%s
五级警示信息发生处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2  WHERE t2.check_status IN (0, 1)) AND t1.zone_id = %%s  AND t1.severity = 5   AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE Recipe_Doc_Id=%%s) AND key_date BETWEEN %%s  AND %%s
急诊静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '输液药物'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊' and recipe_doc_id=%%s) and  key_date between %%s and %%s
急诊抗菌药物静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物输液'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊' and recipe_doc_id=%%s) and  key_date between %%s and %%s
急诊抗菌药物处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊' and recipe_doc_id=%%s) and  key_date between %%s and %%s
门急诊静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '输液药物'   AND zone_id =%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_doc_id=%%s) AND  key_date between %%s and %%s
门急诊抗菌药物静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id =%%s  AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE  recipe_doc_id=%%s) AND  key_date between %%s and %%s
门诊药品总品规数:SELECT COUNT(DISTINCT(drug_id)) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID = %%s and recipe_id in (select recipe_id FROM %(dbname_dp)s.`opt_recipe` where recipe_source='门诊' and recipe_doc_id=%%s) and Key_Time between %%s and %%s
门诊静脉输液药品品规数:SELECT  COUNT(DISTINCT (drug_id))FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN   (SELECT recipe_id  FROM  %(dbname_dp)s.`opt_alertmessage`   WHERE analysis_type = '自定义分析'  AND analysis_result_type = '输液药物') and zone_id=%%s  AND recipe_id IN  (SELECT recipe_id   FROM %(dbname_dp)s. `opt_recipe`   WHERE recipe_source = '门诊' and  recipe_doc_id=%%s)  and key_time between %%s and %%s
住院药品总品规数:SELECT COUNT(DISTINCT drug_id,event_no) FROM %(dbname_dp)s.`ipt_drug` WHERE  Zone_ID = %%s  AND Order_Doc_ID=%%s AND Key_Time between %%s and %%s
门诊三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_doc_id=%%s) and t1.key_date between %%s and %%s
门诊四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_doc_id=%%s) and t1.key_date between %%s and %%s
门诊五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_doc_id=%%s) and t1.key_date between %%s and %%s
门诊所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s  AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_doc_id=%%s)  and t1.key_date between %%s and %%s
住院三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and t1.key_date between %%s and %%s
住院四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and t1.key_date between %%s and %%s
住院五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and t1.key_date between %%s and %%s
住院所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and t1.key_date between %%s and %%s
门诊患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID=%%s  AND Antimicrobial= 1 and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊' and recipe_doc_id=%%s) and  key_time between %%s and %%s
出院患者中联合使用抗菌药物人次:SELECT COUNT(DISTINCT (event_no))FROM  %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物联用'   AND zone_id = %%s and event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) AND event_no IN   (SELECT event_no FROM  %(dbname_dp)s.`ipt_inpatient`  WHERE key_time BETWEEN %%s AND %%s)
门诊患者就诊用药总品种数:select count(distinct(drug_name)) FROM %(dbname_dp)s.`opt_recipe_drug` where zone_id=%%s and drug_id not in (select product_name from %(dbname_sys)s.base_product where is_ignore=1) AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_doc_id=%%s) AND Key_Time between %%s and %%s
门诊药品使用量:SELECT SUM( t1.Count_Unit * t1.Despensing_Num * t4.trans_Specification / t4.ddd) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 and t2.recipe_doc_id=%%s AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='门诊'
急诊患者抗菌药物使用量:SELECT SUM( t1.Count_Unit * t1.Despensing_Num * t4.trans_Specification / t4.ddd) FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id =%%s AND t1.Antimicrobial = 1 and t2.recipe_doc_id=%%s AND t1.Key_Time between %%s and %%s  AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'
急诊碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT SUM( t1.Count_Unit * t1.Despensing_Num * t4.trans_Specification / t4.ddd) FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2   ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.id =t5.product_id WHERE t1.zone_id = %%s and t2.recipe_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'  AND t5.drug_code LIKE '001003001007001004002%%'
急诊药品使用量:SELECT SUM(t1.Count_Unit * t1.Despensing_Num * t4.trans_Specification / t4.ddd)  FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 and t2.recipe_doc_id=%%s  AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='急诊'
门诊患者单次就诊用药品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' and t4.Recipe_Doc_Id=%%s AND t1.key_time BETWEEN %%s  AND %%s
门诊患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '门诊' and t4.Recipe_Doc_Id=%%s AND t1.key_time BETWEEN %%s  AND %%s
门诊患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' and t4.Recipe_Doc_Id=%%s  AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
急诊患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '急诊' and t4.Recipe_Doc_Id=%%s AND t1.key_time BETWEEN %%s  AND %%s
急诊患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '急诊' and t4.Recipe_Doc_Id=%%s  AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
住院患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.event_no,t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1 and t1.Order_Doc_ID=%%s  AND t4.key_time BETWEEN %%s AND %%s
住院患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.event_no,t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5  ON t1.event_no=t5.event_no WHERE t1.Zone_ID = %%s  and t1.Order_Doc_ID=%%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t4.key_time BETWEEN %%s AND %%s
门诊患者就诊使用中药饮片的处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='中药饮片'  AND recipe_id IN(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source ="门诊"  AND zone_id=%%s AND Recipe_Doc_Id = %%s) AND key_date BETWEEN %%s AND %%s
急诊患者就诊使用中药饮片的处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='中药饮片'  AND recipe_id IN(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source ="急诊"  AND zone_id=%%s AND Recipe_Doc_Id = %%s) AND key_date BETWEEN %%s AND %%s
门诊患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '门诊' AND Recipe_Doc_Id = %%s) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
急诊患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE  t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '急诊' AND Recipe_Doc_Id = %%s) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
急诊患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '急诊' AND Recipe_Doc_Id = %%s) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
住院患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE t1.`is_ignore` =0 ) AND zone_id =%%s AND Order_Doc_ID = %%s AND key_time BETWEEN %%s  AND %%s
住院患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE  drug_code LIKE '001002001%%' and t1.`is_ignore` =0 ) AND zone_id =%%s AND Order_Doc_ID = %%s AND key_time BETWEEN %%s  AND %%s
急诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source in('急诊') AND Recipe_Doc_Id = %%s and key_time between %%s and %%s
门急诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source in('门诊','急诊') AND Recipe_Doc_Id = %%s and key_time between %%s and %%s
急诊草药方处方数量:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '急诊' AND Recipe_Doc_Id = %%s)   AND key_date BETWEEN %%s AND %%s
门急诊草药方处方数量:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source IN ('门诊','急诊') AND Recipe_Doc_Id = %%s)   AND key_date BETWEEN %%s AND %%s
门诊草药方处方总数:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '门诊' AND Recipe_Doc_Id = %%s)   AND key_date BETWEEN %%s AND %%s

门诊中药饮片总帖数:SELECT SUM(herb_packet_count) FROM %(dbname_dp)s.`opt_recipe` WHERE Recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 ))  AND zone_id =%%s and recipe_doc_id=%%s AND key_time BETWEEN %%s  AND %%s
门诊中药饮片总味数:SELECT COUNT(drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id` = t2.`product_id` WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` = 0) AND recipe_id IN  (SELECT  recipe_id  FROM  %(dbname_dp)s.opt_recipe  WHERE recipe_source = '门诊')  AND zone_id = %%s and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_doc_id=%%s) AND key_time BETWEEN %%s AND %%s
最高处方金额:SELECT MAX(Recipe_Fee_Total) FROM %(dbname_dp)s.`opt_recipe` WHERE Zone_ID =%%s and recipe_doc_id=%%s AND Key_Time between %%s and %%s
出院患者最高用药金额:select max(drug_money) from (select ,event_no,sum(price*despensing_num) as drug_money from  %(dbname_dp)s.`ipt_drug` where zone_id=%%s and Order_Doc_ID=%%s AND Key_Time between %%s and %%s) as drugmoney
术前24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s AND t2.order_doc_id=%%s AND t2.key_time between %%s and %%s  AND ((TIME_TO_SEC(TIMEDIFF(operation_start_time,Invalid_Time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(operation_start_time,valid_time))>0*60*60))
术后24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s AND t2.order_doc_id=%%s AND t2.key_time between %%s and %%s  AND ((TIME_TO_SEC(TIMEDIFF(valid_time,operation_end_time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>0*60*60))
术后使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1   AND t1.`Operation_Cut_Type` ='Ⅰ' AND t2.zone_id=%%s AND t2.order_doc_id=%%s  AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>=0*60*60))
I类切口手术预防使用抗菌药物时间≤24h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No  WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s  AND t2.order_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防
I类切口预防用抗菌药物时间＞24h且≤48h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 48 * 60 * 60)) AND t1.Zone_ID = %%s  AND t2.order_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞48h且≤72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >48 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.Zone_ID = %%s AND t2.order_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >72 * 60 * 60 )) AND t1.Zone_ID = %%s AND t2.order_doc_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防'

#缺省维度+科室 常规指标及对应的SQL
[default_dept]
门诊患者就诊总人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source='门诊' and dept_id=%%s and key_time between %%s and %%s
门诊静脉输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s  AND recipe_id in (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊' and dept_id=%%s) and key_date between %%s and %%s
门诊患者就诊使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊' and dept_id=%%s) and key_date between %%s and %%s
门诊患者就诊使用质子泵抑制剂处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s  AND recipe_id in (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊' and dept_id=%%s) and key_date between %%s and %%s
门诊使用中药注射剂输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='中药注射剂输液' AND zone_id=%%s  AND recipe_id in (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='门诊' and dept_id=%%s) and key_date between %%s and %%s
急诊患者就诊总人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source='急诊' and dept_id=%%s and key_time between %%s and %%s
急诊患者静脉使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊' and dept_id=%%s) and key_date between %%s and %%s
急诊患者就诊使用抗菌药物处方人次 :SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and dept_id=%%s) and key_date between %%s and %%s
急诊静脉输液处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and dept_id=%%s) and key_date between %%s and %%s
急诊患者就诊使用质子泵抑制剂处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.opt_alertmessage WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source='急诊'and dept_id=%%s) and key_date between %%s and %%s
门急诊患者就诊使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source in ("急诊","门诊") and dept_id=%%s) and key_date between %%s and %%s
门急诊患者静脉使用抗菌药物处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物输液' AND zone_id=%%s  AND recipe_id in(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source in ("急诊","门诊") and dept_id=%%s) and key_date between %%s and %%s
门急诊就诊处方人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.opt_recipe WHERE zone_id=%%s and recipe_source in ('急诊','门诊') and dept_id=%%s and key_time between %%s and %%s
出院患者总人次:SELECT COUNT(patient_id) FROM %(dbname_dp)s.`ipt_inpatient` t1 WHERE zone_id=%%s  and out_dept_code=%%s and  key_time between %%s and %%s
出院患者使用抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND  event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
出院患者中抗菌药物治疗使用人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_using_aim='治疗') AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
出院患者中使用静脉输液人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='输液药物' AND zone_id=%%s  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
出院患者使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
出院患者预防使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_using_aim='预防') AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
出院患者使用碳青霉烯类抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007001004%%') and  zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)  AND Antimicrobial=1
出院患者使用替加环素人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007004%%') AND zone_id=%%s  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
出院患者使用抗真菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug`  WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE t2.drug_code LIKE '001003001%%') AND zone_id=%%s  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
出院患者使用特殊级抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE Antimicrobial_Level=3) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
住院三级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=3 and event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s) and key_date between %%s and %%s
住院四级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=4  and event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s) and key_date between %%s and %%s
住院五级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=5  and event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s) and key_date between %%s and %%s
#门诊患者使用药物总费用（排除中药饮片）:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id NOT IN(SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE  drug_code LIKE '001002001%%')  and zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊' AND dept_id=%%s) and key_time between %%s and %%s
门诊患者使用质子泵抑制剂费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN (SELECT Recipe_id FROM %(dbname_dp)s.`opt_alertmessage` WHERE  analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂')  AND zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊' and  dept_id=%%s) and key_time between %%s and %%s
门诊静脉输液药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN (SELECT Recipe_id FROM %(dbname_dp)s.`opt_alertmessage` WHERE  analysis_type='自定义分析' AND analysis_result_type='输液药物') AND drug_id NOT IN(SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t1.is_ignore =0) AND zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊' and  dept_id=%%s) and key_time between %%s and %%s
门诊患者使用药物总费用:select sum(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` where zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊' and  dept_id=%%s) and key_time between %%s and %%s
急诊患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID=%%s  AND Antimicrobial= 1 AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='急诊' and  dept_id=%%s) AND key_time between %%s and %%s
急诊患者使用质子泵抑制剂费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN (SELECT Recipe_id FROM %(dbname_dp)s.`opt_alertmessage` WHERE  analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂') AND zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='急诊' and  dept_id=%%s) and key_time between %%s and %%s
出院患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE Zone_ID=%%s  AND Antimicrobial= 1  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
出院患者使用质子泵抑制剂总费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE Zone_ID=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)  AND event_no IN (SELECT event_no  FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂')
门诊患者就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '门诊' and t4.dept_id=%%s AND t1.key_time BETWEEN %%s  AND %%s
门诊患者就诊用药总品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' and t4.dept_id=%%s AND t1.key_time BETWEEN %%s  AND %%s
门诊患者就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' AND t4.dept_id=%%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
急诊患者就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '急诊' and t4.dept_id=%%s AND t1.key_time BETWEEN %%s  AND %%s
急诊患者就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '急诊' AND t4.dept_id=%%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
出院患者使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1 and t4.out_dept_code=%%s  AND t4.key_time BETWEEN %%s AND %%s
出院患者住院总天数:select sum(datediff(discharge_date,in_dpet_time)) FROM %(dbname_dp)s.`ipt_inpatient` where zone_id=%%s  and out_dept_code=%%s and key_time  between %%s and %%s
出院患者I类切口手术例次:SELECT COUNT(*) FROM %(dbname_dp)s.`ipt_operation` WHERE  Zone_ID = %%s  AND Operation_Cut_Type = 'Ⅰ' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
I类切口手术预防使用抗菌药物例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) inner join %(dbname_dp)s.`ipt_inpatient` t3 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t3.out_dept_code=%%s and t1.key_time between %%s and %%s
原则上不需要预防使用抗菌药物I类切口手术例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) inner join %(dbname_dp)s.`ipt_inpatient` t3 USING(Event_No) WHERE Operation_Cut_Type = 'Ⅰ' AND t1.Zone_ID = %%s AND t1.`Operation_Name` REGEXP '甲|乳|疝|关节镜检查|颈动脉内膜剥脱|颅骨肿物切除|白内障' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t3.out_dept_code=%%s and t1.key_time between %%s and %%s
原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) inner join %(dbname_dp)s.`ipt_inpatient` t3 USING(Event_No) WHERE Operation_Cut_Type = 'Ⅰ' AND Drug_Using_Aim = '预防' AND Antimicrobial = 1 AND t1.Zone_ID = %%s AND  t1.`Operation_Name` REGEXP '甲|乳|疝|关节镜检查|颈动脉内膜剥脱|颅骨肿物切除|白内障' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t3.out_dept_code=%%s and t1.key_time between %%s and %%s
I类切口手术预防使用抗菌药物品种选择合理例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) inner join %(dbname_dp)s.`ipt_inpatient` t3 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN(SELECT event_no FROM %(dbname_dp)s.`ipt_drug` t3 WHERE t3.`Drug_ID` IN (SELECT t4.product_id FROM %(dbname_knowledge)s.`base_product` t4 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.map_product_id=t5.product_id WHERE drug_code LIKE "001003001007001002001%%")) AND t3.out_dept_code=%%s and t1.key_time between %%s and %%s
出院患者预防使用抗菌药物手术例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND t1.Zone_ID = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s and key_time between %%s and %%s)
I类切口手术前0.5-2.0小时内给药例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No inner join %(dbname_dp)s.`ipt_inpatient` t3 ON t2.Event_No = t3.Event_No WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND t1.Zone_ID = %%s  AND t3.out_dept_code=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 2 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 2 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))
总手术例次:select count(distinct(operation_no)) FROM %(dbname_dp)s.`ipt_operation` where zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s) and key_time between %%s and %%s
门诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source='门诊' AND dept_id=%%s and key_time between %%s and %%s
≥14岁患者抗菌药物门诊处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.opt_alertrecipe t1 WHERE t1.age_as_num >= 140000 and t1.recipe_source = '门诊' AND t1.zone_id =%%s AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_alertmessage  WHERE analysis_type = '自定义分析'  AND analysis_result_type = '抗菌药物') and recipe_id in(select recipe_id FROM %(dbname_dp)s.opt_recipe where dept_id=%%s) and t1.key_date between %%s and %%s
＜14岁患者抗菌药物门诊处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.opt_alertrecipe t1 WHERE t1.age_as_num < 140000 and t1.recipe_source = '门诊' AND t1.zone_id =%%s AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_alertmessage  WHERE analysis_type = '自定义分析'  AND analysis_result_type = '抗菌药物') and recipe_id in(select recipe_id FROM %(dbname_dp)s.opt_recipe where dept_id=%%s) and t1.key_date between %%s and %%s
门诊静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '输液药物'  AND zone_id = %%s   AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊' and dept_id=%%s)  AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数（≥14岁）:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source = '门诊' and dept_id=%%s)   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_alertrecipe`  WHERE age >= 14) AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数（＜14岁）:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source = '门诊' and dept_id=%%s)   AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_alertrecipe`  WHERE age < 14) AND key_date between %%s and %%s
门诊抗菌药物静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊' and dept_id=%%s) AND key_date between %%s and %%s
门诊中药注射剂输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药注射剂输液'   AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊' and dept_id=%%s) AND key_date between %%s and %%s
门诊抗菌药物处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物'   AND zone_id = %%s  AND recipe_id IN  (SELECT recipe_id   FROM  %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '门诊' and dept_id=%%s) AND key_date between %%s and %%s
三级警示信息发生处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2  WHERE t2.check_status IN (0, 1)) AND t1.zone_id = %%s  AND t1.severity = 3   AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE dept_id=%%s) AND key_date BETWEEN %%s  AND %%s
四级警示信息发生处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2  WHERE t2.check_status IN (0, 1)) AND t1.zone_id = %%s  AND t1.severity = 4   AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE dept_id=%%s) AND key_date BETWEEN %%s  AND %%s
五级警示信息发生处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2  WHERE t2.check_status IN (0, 1)) AND t1.zone_id = %%s  AND t1.severity = 5   AND t1.recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE dept_id=%%s) AND key_date BETWEEN %%s  AND %%s
急诊静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '输液药物'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊' and dept_id=%%s) and  key_date between %%s and %%s
急诊抗菌药物静脉输液处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物输液'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊' and dept_id=%%s) and  key_date between %%s and %%s
急诊抗菌药物处方数:SELECT COUNT(DISTINCT (recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析' AND analysis_result_type = '抗菌药物'  AND zone_id = %%s  AND recipe_id IN  (SELECT  recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE recipe_source = '急诊' and dept_id=%%s) and  key_date between %%s and %%s
门急诊静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '输液药物'   AND zone_id =%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE dept_id=%%s) AND  key_date between %%s and %%s
门急诊抗菌药物静脉输液处方数:SELECT  COUNT(DISTINCT (recipe_id)) FROM  %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物输液'   AND zone_id =%%s  AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE  dept_id=%%s) AND  key_date between %%s and %%s
门诊药品总品规数:SELECT COUNT(DISTINCT(drug_id)) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID = %%s and recipe_id in (select recipe_id FROM %(dbname_dp)s.`opt_recipe` where recipe_source='门诊' and dept_id=%%s) and Key_Time between %%s and %%s
门诊静脉输液药品品规数:SELECT  COUNT(DISTINCT (drug_id))FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE recipe_id IN   (SELECT recipe_id  FROM  %(dbname_dp)s.`opt_alertmessage`   WHERE analysis_type = '自定义分析'  AND analysis_result_type = '输液药物') and zone_id=%%s  AND recipe_id IN  (SELECT recipe_id   FROM %(dbname_dp)s. `opt_recipe`  WHERE recipe_source = '门诊' and dept_id=%%s)  and key_time between %%s and %%s
住院药品总品规数:SELECT COUNT(DISTINCT drug_id,event_no) FROM %(dbname_dp)s.`ipt_drug` WHERE  Zone_ID = %%s  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s) AND Key_Time between %%s and %%s
门诊三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE dept_id=%%s) and t1.key_date between %%s and %%s
门诊四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE dept_id=%%s) and t1.key_date between %%s and %%s
门诊五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE dept_id=%%s) and t1.key_date between %%s and %%s
门诊所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s  AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe`   WHERE dept_id=%%s)  and t1.key_date between %%s and %%s
住院三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s) and t1.key_date between %%s and %%s
住院四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s) and t1.key_date between %%s and %%s
住院五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE out_dept_code=%%s) and t1.key_date between %%s and %%s
住院所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE  Order_Doc_ID=%%s) and t1.key_date between %%s and %%s
门诊患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID=%%s  AND Antimicrobial= 1 and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊' and dept_id=%%s) and  key_time between %%s and %%s
出院患者中联合使用抗菌药物人次:SELECT COUNT(DISTINCT (event_no))FROM  %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物联用'   AND zone_id = %%s  and  event_no IN (SELECT event_no FROM  %(dbname_dp)s.`ipt_inpatient`  WHERE out_dept_code=%%s and key_time BETWEEN %%s AND %%s)
门诊患者就诊用药总品种数:select count(distinct(drug_name)) FROM %(dbname_dp)s.`opt_recipe_drug` where zone_id=%%s and drug_id not in (select product_name from %(dbname_sys)s.base_product where is_ignore=1) AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE dept_id=%%s) AND Key_Time between %%s and %%s
门诊药品使用量:SELECT SUM( t1.Count_Unit * t1.Despensing_Num * t4.trans_Specification / t4.ddd) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 and t2.dept_id=%%s AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='门诊'
急诊患者抗菌药物使用量:SELECT SUM( t1.Count_Unit * t1.Despensing_Num * t4.trans_Specification* t4.specquantity / t4.ddd) FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id =%%s  and t2.dept_id=%%s AND t1.Key_Time between %%s and %%s  AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'
急诊碳青霉烯类抗菌药物使用量（累计DDD数）:SELECT SUM( t1.Count_Unit * t1.Despensing_Num * t4.trans_Specification* t4.specquantity / t4.ddd) FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2   ON t1.recipe_id =t2.recipe_id INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t5 ON t4.id =t5.product_id WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 and t2.dept_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND t1.Antimicrobial = 1 AND t2.recipe_source='急诊'  AND t5.drug_code LIKE '001003001007001004002%%'
急诊药品使用量:SELECT SUM(t1.Count_Unit * t1.Despensing_Num * t4.trans_Specification* t4.specquantity / t4.ddd)  FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s AND t1.Antimicrobial = 1 and t2.dept_id=%%s  AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='急诊'
门诊患者单次就诊用药品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' and t4.dept_id=%%s AND t1.key_time BETWEEN %%s  AND %%s
门诊患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '门诊' and t4.dept_id=%%s AND t1.key_time BETWEEN %%s  AND %%s
门诊患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '门诊' AND t4.dept_id=%%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
急诊患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1   AND t4.recipe_source = '急诊' and t4.dept_id=%%s AND t1.key_time BETWEEN %%s  AND %%s
急诊患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.recipe_id,t3.drug_name) FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id=t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id =t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4 ON t1.recipe_id=t4.recipe_id  INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t1.recipe_id=t5.recipe_id WHERE t1.Zone_ID = %%s  AND t4.recipe_source = '急诊' AND t4.dept_id=%%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t1.key_time BETWEEN %%s  AND %%s
住院患者单次就诊使用抗菌药物累计品种数:SELECT COUNT(DISTINCT t1.event_no,t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1 and t4.out_dept_code=%%s  AND t4.key_time BETWEEN %%s AND %%s
住院患者单次就诊使用质子泵抑制剂品种数:SELECT COUNT(DISTINCT t1.event_no,t3.drug_name) FROM  %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5  ON t1.event_no=t5.event_no WHERE t1.Zone_ID = %%s  and t4.out_dept_code=%%s AND t5.analysis_type = '自定义分析'  AND t5.analysis_result_type = '质子泵抑制剂' AND t4.key_time BETWEEN %%s AND %%s
急诊患者使用药物总费用(排除中药饮片）:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id NOT IN(SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001002001%%') AND zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='急诊' and dept_id=%%s)  and key_time between %%s and %%s
门诊患者就诊使用中药饮片的处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='中药饮片'  AND recipe_id IN(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source ="门诊"  AND zone_id=%%s AND Dept_Id = %%s) AND key_date BETWEEN %%s AND %%s
急诊患者就诊使用中药饮片的处方人次:SELECT COUNT(DISTINCT(patient_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='中药饮片'  AND recipe_id IN(SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe` WHERE recipe_source ="急诊"  AND zone_id=%%s AND Dept_Id = %%s) AND key_date BETWEEN %%s AND %%s
门诊患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '门诊' AND Dept_Id = %%s) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
急诊患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE  t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '急诊' AND Dept_Id = %%s) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
急诊患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 )  AND recipe_id IN  (SELECT  recipe_id FROM   %(dbname_dp)s.opt_recipe   WHERE recipe_source = '急诊' AND Dept_Id = %%s) AND zone_id =%%s AND key_time BETWEEN %%s  AND %%s
住院患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`ipt_drug` t INNER JOIN %(dbname_dp)s.`ipt_inpatient` t1 ON t.event_no = t1.event_no WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE t1.`is_ignore` =0 ) AND t.zone_id =%%s AND t1.out_dept_code=%%s AND t.key_time BETWEEN %%s  AND %%s
住院患者使用中药饮片总费用:SELECT SUM(price * Despensing_Num*Herb_Packet_Count) FROM  %(dbname_dp)s.`ipt_drug` t INNER JOIN %(dbname_dp)s.`ipt_inpatient` t1 ON t.event_no = t1.event_no WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE  drug_code LIKE '001002001%%' and t1.`is_ignore` =0 ) AND t.zone_id =%%s AND t1.out_dept_code=%%s AND t.key_time BETWEEN %%s  AND %%s
急诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source in('急诊') AND Dept_Id = %%s and key_time between %%s and %%s
门急诊处方总数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.opt_recipe where zone_id=%%s and recipe_source in('门诊','急诊') AND Dept_Id = %%s and key_time between %%s and %%s
急诊草药方处方数量:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '急诊' AND dept_id = %%s)   AND key_date BETWEEN %%s AND %%s
门急诊草药方处方数量:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source IN ('门诊','急诊') AND dept_id = %%s)   AND key_date BETWEEN %%s AND %%s
门诊草药方处方总数:SELECT COUNT(DISTINCT(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '中药饮片'   AND zone_id = %%s  AND recipe_id IN (SELECT  recipe_id  FROM  %(dbname_dp)s.`opt_recipe`  WHERE recipe_source = '门诊' AND dept_id = %%s)   AND key_date BETWEEN %%s AND %%s

门诊中药饮片总帖数:SELECT SUM(herb_packet_count) FROM %(dbname_dp)s.`opt_recipe` WHERE Recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` =0 ))  AND zone_id =%%s and dept_id=%%s AND key_time BETWEEN %%s  AND %%s
门诊中药饮片总味数:SELECT COUNT(drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id` = t2.`product_id` WHERE drug_code LIKE '001002001%%' AND t1.`is_ignore` = 0) AND recipe_id IN  (SELECT  recipe_id  FROM  %(dbname_dp)s.opt_recipe  WHERE recipe_source = '门诊')  AND zone_id = %%s and recipe_id in (select recipe_id from opt_recipe where dept_id=%%s) AND key_time BETWEEN %%s AND %%s
最高处方金额:SELECT MAX(Recipe_Fee_Total) FROM %(dbname_dp)s.`opt_recipe` WHERE Zone_ID =%%s and dept_id=%%s AND Key_Time between %%s and %%s
出院患者最高用药金额:select max(drug_money) from (select ,event_no,sum(price*despensing_num) as drug_money from  %(dbname_dp)s.`ipt_drug` where  zone_id=%%s and event_no in (select event_no FROM %(dbname_dp)s.ipt_inpatient where out_dept_code=%%s) and key_time between %%s and %%s  ) as drugmoney
术前24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No`  inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s AND t3.out_dept_code=%%s AND t2.key_time between %%s and %%s  AND ((TIME_TO_SEC(TIMEDIFF(operation_start_time,Invalid_Time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(operation_start_time,valid_time))>0*60*60))
术后24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s AND t3.out_dept_code=%%s AND t2.key_time between %%s and %%s  AND ((TIME_TO_SEC(TIMEDIFF(valid_time,operation_end_time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>0*60*60))
术后使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.`Antimicrobial` = 1   AND t1.`Operation_Cut_Type` ='Ⅰ' AND t2.zone_id=%%s AND t3.out_dept_code=%%s AND t2.key_time between %%s and %%s  AND ((TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>=0*60*60))
I类切口手术预防使用抗菌药物时间≤24h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s AND t3.out_dept_code=%%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防
I类切口预防用抗菌药物时间＞24h且≤48h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 48 * 60 * 60)) AND t1.Zone_ID = %%s AND t3.out_dept_code=%%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞48h且≤72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >48 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.Zone_ID = %%s AND t3.out_dept_code=%%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >72 * 60 * 60 )) AND t1.Zone_ID = %%s AND t3.out_dept_code=%%s  AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防'

#缺省维度+医疗组 常规指标及对应的SQL
[default_group]
出院患者总人次:SELECT COUNT(patient_id) FROM %(dbname_dp)s.`ipt_inpatient` WHERE zone_id=%%s and doc_group = %%s and  key_time between %%s and %%s
出院患者使用抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者住院总天数:select sum(datediff(discharge_date,in_dpet_time)) FROM %(dbname_dp)s.`ipt_inpatient` where zone_id=%%s and doc_group = %%s and key_time  between %%s and %%s
出院患者使用抗菌药物累计品种数:select count(distinct(t1.drug_name)) FROM %(dbname_dp)s.`ipt_drug` t1 where Zone_ID=%%s  AND Antimicrobial= 1 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE Zone_ID=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s) AND drug_id NOT IN(SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE drug_code LIKE '001002001%%')
出院患者使用抗菌药物费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE Zone_ID=%%s  AND Antimicrobial= 1 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者中联合使用抗菌药物人次:SELECT COUNT(DISTINCT (event_no))FROM  %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type = '自定义分析'   AND analysis_result_type = '抗菌药物联用'   AND zone_id = %%s  AND event_no IN   (SELECT event_no FROM  %(dbname_dp)s.`ipt_inpatient`  WHERE doc_group = %%s and key_time BETWEEN %%s AND %%s)
出院患者中抗菌药物治疗使用人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='抗菌药物' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_using_aim='治疗')
出院患者I类切口手术例次:SELECT COUNT(*) FROM %(dbname_dp)s.`ipt_operation` WHERE  Zone_ID = %%s  AND Operation_Cut_Type = 'Ⅰ' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
I类切口手术预防使用抗菌药物例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3 ON t2.event_no = t3.event_no WHERE  t1.Zone_ID = %%s AND doc_group = %%s AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s
原则上不需要预防使用抗菌药物I类切口手术例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3 ON t2.event_no = t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND t1.Zone_ID = %%s AND doc_group = %%s AND doc_group = %%s AND t1.`Operation_Name` REGEXP '甲|乳|疝|关节镜检查|颈动脉内膜剥脱|颅骨肿物切除|白内障' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s
原则上不需要预防使用抗菌药物I类切口手术预防使用抗菌药物例次:SELECT COUNT(distinct(Operation_No)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3 ON t2.event_no = t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND Drug_Using_Aim = '预防' AND Antimicrobial = 1 AND t1.Zone_ID = %%s AND doc_group = %%s AND  t1.`Operation_Name` REGEXP '甲|乳|疝|关节镜检查|颈动脉内膜剥脱|颅骨肿物切除|白内障' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s
I类切口手术预防使用抗菌药物品种选择合理例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) inner join %(dbname_dp)s.`ipt_inpatient` t3 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN(SELECT event_no FROM %(dbname_dp)s.`ipt_drug` t3 WHERE t3.`Drug_ID` IN (SELECT t4.product_id FROM %(dbname_knowledge)s.`base_product` t4 INNER JOIN %(dbname_knowledge)s.`tb_product_drug`  t5 ON t4.map_product_id=t5.product_id WHERE drug_code LIKE "001003001007001002001%%")) AND t3.doc_group=%%s and t1.key_time between %%s and %%s
出院患者预防使用抗菌药物手术例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND t1.Zone_ID = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
I类切口手术前0.5-2.0小时内给药例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No inner join %(dbname_dp)s.`ipt_inpatient` t3 ON t2.Event_No = t3.Event_No WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND t1.Zone_ID = %%s  AND t3.doc_group = %%s AND t1.Key_Time BETWEEN %%s AND %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR (TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) >=  - 2 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time)) <=  - 0.5 * 60 * 60) OR ( - 0.5 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 0.5 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))) OR ( - 2 * 60 * 60 >= TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) AND  - 2 * 60 * 60 <= TIME_TO_SEC(TIMEDIFF(inValid_Time,Operation_Start_Time))))
清洁手术预防使用抗菌药物比例:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3 ON t2.event_no = t3.event_no WHERE  t1.Zone_ID = %%s AND doc_group = %%s AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s		SELECT COUNT(*) FROM %(dbname_dp)s.`ipt_operation` WHERE  Zone_ID = %%s  AND Operation_Cut_Type = 'Ⅰ' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
原则上不需要预防使用抗菌药物的清洁手术预防使用抗菌药物比例:SELECT COUNT(Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3 ON t2.event_no = t3.event_no WHERE Operation_Cut_Type = 'Ⅰ' AND Drug_Using_Aim = '预防' AND Antimicrobial = 1 AND t1.Zone_ID = %%s AND doc_group = %%s AND  t1.`Operation_Name` REGEXP '甲|乳|疝|关节镜检查|颈动脉内膜剥脱|颅骨肿物切除|白内障' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s		SELECT COUNT(Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) INNER JOIN %(dbname_dp)s.`ipt_inpatient` t3 ON t2.patient_id = t3.patient_id WHERE Operation_Cut_Type = 'Ⅰ' AND t1.Zone_ID = %%s AND doc_group = %%s AND t1.`Operation_Name` REGEXP '甲|乳|疝|关节镜检查|颈动脉内膜剥脱|颅骨肿物切除|白内障' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s
住院患者单次就诊使用质子泵抑制剂品种数:select count(distinct t1.event_no,t1.drug_name) FROM %(dbname_dp)s.`ipt_drug` t1 where Zone_ID=%%s  AND event_no in (select event_no FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂')AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者使用质子泵抑制剂总费用:SELECT SUM(price * Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE Zone_ID=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s) AND drug_id NOT IN(SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE drug_code LIKE '001002001%%') AND event_no IN (SELECT event_no  FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂')
使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者质子泵抑制剂药物使用量（累计DDD数）:SELECT  SUM((t1.Count_Unit * t1.Despensing_Num * t3.trans_Specification) / t3.ddd ) FROM %(dbname_dp)s.`ipt_drug` t1   INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3   ON t2.map_product_id = t3.id  INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t4  ON t3.id = t4.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t5 ON t1.event_no = t5.event_no WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1   AND key_time BETWEEN %%s AND %%s   AND t4.analysis_type = '自定义分析'   AND t4.analysis_result_type = '质子泵抑制剂'   AND t1.Order_Type != '出院带药'
出院患者预防使用质子泵抑制剂的出院总人数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` WHERE analysis_type='自定义分析' AND analysis_result_type='质子泵抑制剂' AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s) AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_using_aim='预防')
住院患者单次就诊使用抗菌药物累计品种数:select count(distinct t1.event_no,t1.drug_name) FROM %(dbname_dp)s.`ipt_drug` t1 where Zone_ID=%%s  AND Antimicrobial= 1 AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者使用碳青霉烯类抗菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug`  t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007001004%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)  AND Antimicrobial=1
出院患者使用替加环素人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE drug_code LIKE '001003001007004%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者使用抗真菌药物人次:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_drug`  WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id`  WHERE t2.drug_code LIKE '001003001%%') AND zone_id=%%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_inpatient` WHERE doc_group = %%s AND key_time between %%s and %%s)
出院患者最高用药金额:select max(drug_money) from (select ,event_no,sum(price*despensing_num) as drug_money from  %(dbname_dp)s.`ipt_drug` where zone_id=%%s and event_no in (select event_no from ipt_inpatient where doc_group =%%s)  and key_time between %%s and %%s ) as drugmoney
术前24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No`  inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s AND t3.doc_group =%%s AND t2.key_time between %%s and %%s  AND ((TIME_TO_SEC(TIMEDIFF(operation_start_time,Invalid_Time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(operation_start_time,valid_time))>0*60*60))
术后24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s AND t3.doc_group =%%s AND t2.key_time between %%s and %%s  AND ((TIME_TO_SEC(TIMEDIFF(valid_time,operation_end_time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>0*60*60))
术后使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.`Antimicrobial` = 1   AND t1.`Operation_Cut_Type` ='Ⅰ' AND t2.zone_id=%%s AND t3.doc_group =%%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>=0*60*60))
I类切口手术预防使用抗菌药物时间≤24h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s AND t3.doc_group =%%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防
I类切口预防用抗菌药物时间＞24h且≤48h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 48 * 60 * 60)) AND t1.Zone_ID = %%s AND t3.doc_group =%%s  AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞48h且≤72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >48 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.Zone_ID = %%s AND t3.doc_group =%%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防'
I类切口预防用抗菌药物时间＞72h:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' inner join %(dbname_dp)s.ipt_inpatient t3 on t2.`Event_No` = t3.`Event_No` WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >72 * 60 * 60 )) AND t1.Zone_ID = %%s AND t3.doc_group =%%s AND t1.Key_Time BETWEEN %%s AND %%s  AND t2.Drug_Using_Aim = '预防'

#缺省维度+机构 全院指标及对应的SQL
[hospital]
全院患者抗菌药物累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3   ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t1.Antimicrobial = 1 AND t1.key_time BETWEEN %%s AND %%s  UNION ALL  SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND t1.Antimicrobial = 1  AND t1.key_time BETWEEN %%s AND %%s) rlt
全院患者药品累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s   AND t1.key_time BETWEEN %%s AND %%s  UNION ALL  SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s) rlt
全院患者使用西药药品累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s   AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001003%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001003%%') rlt
全院患者使用中成药总品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s   AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002002%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002002%%') rlt
全院患者使用中药饮片总品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s   AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002001%%' UNION  ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s  AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002001%%') rlt
全院患者使用抗菌药物累计品规数:SELECT COUNT(distinct(drug_id)) FROM  (SELECT  drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t1   WHERE Zone_ID = %%s AND key_time BETWEEN %%s AND %%s AND Antimicrobial = 1 UNION ALL SELECT  drug_id  FROM  %(dbname_dp)s.`ipt_drug`   WHERE Zone_ID = %%s AND key_time BETWEEN %%s AND %%s   AND Antimicrobial = 1) rlt
全院患者使用口服剂型抗菌药物品规数:SELECT COUNT(distinct(drug_id)) FROM  (SELECT  drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t1   WHERE Zone_ID = %%s AND key_time BETWEEN %%s AND %%s AND Antimicrobial = 1 AND Drug_Admin_Route_Name='消化道全身给药' UNION ALL SELECT  drug_id  FROM  %(dbname_dp)s.`ipt_drug`   WHERE Zone_ID = %%s AND key_time BETWEEN %%s AND %%s   AND Antimicrobial = 1 AND Drug_Admin_Route_Name='消化道全身给药') rlt
全院患者使用注射剂型抗菌药物品规数:SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5 ON t5.event_no=t1.`Event_No` WHERE t1.zone_id =%%s AND t1.key_time BETWEEN %%s AND %%s AND t5.analysis_type='自定义分析' AND t5.analysis_result_type='注射剂型抗菌药物'  UNION ALL SELECT  t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t5.recipe_id=t1.recipe_id WHERE t1.zone_id = %%s  AND t1.key_time BETWEEN %%s  AND %%s AND t5.analysis_type='自定义分析'   AND t5.analysis_result_type='注射剂型抗菌药物') rlt
全院使用头霉素类抗菌药物品规数:SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5 ON t5.event_no=t1.`Event_No` WHERE t1.zone_id =%%s AND t1.key_time BETWEEN %%s AND %%s AND t5.analysis_type='自定义分析' AND t5.analysis_result_type='注射剂型抗菌药物' AND t4.drug_code LIKE '001003001007001004004%%' UNION ALL SELECT  t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t5.recipe_id=t1.recipe_id WHERE t1.zone_id = %%s  AND t1.key_time BETWEEN %%s  AND %%s AND t5.analysis_type='自定义分析'   AND t5.analysis_result_type='注射剂型抗菌药物' AND t4.drug_code LIKE '001003001007001004004%%') rlt
全院患者使用三代及四代头孢菌素注射剂型品规数:SELECT count(DISTINCT(drug_id)) FROM (SELECT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5 ON t5.event_no=t1.`Event_No` WHERE t1.zone_id =%%s AND t1.key_time BETWEEN %%s AND %%s AND t5.analysis_type='自定义分析' AND t5.analysis_result_type='注射剂型抗菌药物' AND t4.drug_code LIKE '001003001006002003%%' OR t4.drug_code LIKE '001003001006002004%%'  UNION ALL SELECT  t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t5.recipe_id=t1.recipe_id WHERE t1.zone_id = %%s  AND t1.key_time BETWEEN %%s  AND %%s AND t5.analysis_type='自定义分析'   AND t5.analysis_result_type='注射剂型抗菌药物' AND t4.drug_code LIKE '001003001006002003%%' OR t4.drug_code LIKE '001003001006002004%%' ) rlt
全院患者使用三代及四代头孢菌素口服剂型品规数:SELECT count(DISTINCT(drug_id)) FROM (SELECT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5 ON t5.event_no=t1.`Event_No` WHERE t1.zone_id =%%s AND t1.key_time BETWEEN %%s AND %%s AND t5.analysis_type='自定义分析' AND t5.analysis_result_type='口服剂型抗菌药物' AND t4.drug_code LIKE '001003001006002003%%' OR t4.drug_code LIKE '001003001006002004%%'  UNION ALL SELECT  t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t5.recipe_id=t1.recipe_id WHERE t1.zone_id = %%s  AND t1.key_time BETWEEN %%s  AND %%s AND t5.analysis_type='自定义分析'   AND t5.analysis_result_type='口服剂型抗菌药物' AND t4.drug_code LIKE '001003001006002003%%' OR t4.drug_code LIKE '001003001006002004%%' ) rlt
全院碳青霉烯类注射剂型品规数:SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5 ON t5.event_no=t1.`Event_No` WHERE t1.zone_id =%%s AND t1.key_time BETWEEN %%s AND %%s AND t5.analysis_type='自定义分析' AND t5.analysis_result_type='注射剂型抗菌药物' AND t4.drug_code LIKE '001003001007001004%%' UNION ALL SELECT  t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t5.recipe_id=t1.recipe_id WHERE t1.zone_id = %%s  AND t1.key_time BETWEEN %%s  AND %%s AND t5.analysis_type='自定义分析'   AND t5.analysis_result_type='注射剂型抗菌药物' AND t4.drug_code LIKE '001003001007001004%%') rlt
全院氟喹诺酮类口服剂型品规数:SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5 ON t5.event_no=t1.`Event_No` WHERE t1.zone_id =%%s AND t1.key_time BETWEEN %%s AND %%s AND t5.analysis_type='自定义分析' AND t5.analysis_result_type='口服剂型抗菌药物' AND t4.drug_code LIKE '001003001007001002003%%' OR t4.drug_code LIKE '001003001007001002004%%' UNION ALL SELECT  t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t5.recipe_id=t1.recipe_id WHERE t1.zone_id = %%s  AND t1.key_time BETWEEN %%s  AND %%s AND t5.analysis_type='自定义分析'   AND t5.analysis_result_type='口服剂型抗菌药物' AND t4.drug_code LIKE '001003001007001002003%%' OR t4.drug_code LIKE '001003001007001002004%%') rlt
全院氟喹诺酮类注射剂型品规数:SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT t1.drug_id FROM %(dbname_dp)s.`ipt_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t3  ON t2.map_product_id = t3.id  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`ipt_alertmessage` t5 ON t5.event_no=t1.`Event_No` WHERE t1.zone_id =%%s AND t1.key_time BETWEEN %%s AND %%s AND t5.analysis_type='自定义分析' AND t5.analysis_result_type='注射剂型抗菌药物' AND t4.drug_code LIKE '001003001007001002003%%' OR t4.drug_code LIKE '001003001007001002004%%' UNION ALL SELECT  t1.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product` t3 ON t2.map_product_id = t3.id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t4  ON t3.id = t4.product_id INNER JOIN %(dbname_dp)s.`opt_alertmessage` t5 ON t5.recipe_id=t1.recipe_id WHERE t1.zone_id = %%s  AND t1.key_time BETWEEN %%s  AND %%s AND t5.analysis_type='自定义分析'   AND t5.analysis_result_type='注射剂型抗菌药物' AND t4.drug_code LIKE '001003001007001002003%%' OR t4.drug_code LIKE '001003001007001002004%%') rlt
#SELECT COUNT(distinct(drug_id)) FROM (SELECT drug_id FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or t2.drug_code LIKE '001003001007001002004%%')  AND Drug_Admin_Route_Name='非消化道全身给药' and Zone_ID = %%s AND key_time BETWEEN %%s AND %%s UNION ALL SELECT drug_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or drug_code LIKE '001003001007001002004%%' and  Zone_ID = %%s AND key_time BETWEEN %%s AND %%s)  AND Drug_Admin_Route_Name='非消化道全身给药') rlt
全院患者使用药品总品规数:SELECT COUNT(DISTINCT(drug_id)) FROM  (SELECT  drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t1   WHERE Zone_ID = %%s AND key_time BETWEEN %%s AND %%s  UNION ALL  SELECT  drug_id  FROM  %(dbname_dp)s.`ipt_drug`   WHERE Zone_ID =%%s AND key_time BETWEEN %%s AND %%s  ) rlt
全院患者使用西药药品总品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT drug_id FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN  (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001003%%') AND Zone_ID =%%s AND key_time BETWEEN %%s AND %%s   UNION ALL SELECT drug_id FROM %(dbname_dp)s.`opt_recipe_drug`  WHERE drug_id IN  (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001003%%') AND Zone_ID =%%s AND key_time BETWEEN %%s AND %%s ) rlt
全院患者使用中成药总品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT drug_id FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN  (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001002002%%') AND Zone_ID =%%s AND key_time BETWEEN %%s AND %%s   UNION ALL SELECT drug_id FROM %(dbname_dp)s.`opt_recipe_drug`  WHERE drug_id IN  (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001002002%%') AND Zone_ID =%%s AND key_time BETWEEN %%s AND %%s ) rlt
医疗药品总收入:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`opt_recipe_drug` t1 WHERE t1.zone_id=%%s AND key_time BETWEEN %%s AND %%s AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`ipt_drug` t1 WHERE t1.zone_id=%%s  AND key_time BETWEEN %%s AND %%s AND t1.drug_id  IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t2.is_ignore =0)) AS rlt
国家基药目录品种使用金额:select sum(Total_Money) from (SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.opt_recipe_drug WHERE Zone_Id = %%s AND Key_Time between %%s and %%s AND base_drug IN (1) UNION ALL SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.ipt_drug WHERE Zone_Id = %%s AND Key_Time between %%s and %%s AND base_drug IN (1)) rlt
全院抗菌药物使用金额:SELECT SUM(price) from (SELECT SUM(price * Despensing_Num) as price FROM %(dbname_dp)s.`ipt_drug` WHERE  Zone_ID=%%s AND  key_time BETWEEN %%s AND %%s  AND Antimicrobial= 1 UNION ALL SELECT SUM(price * Despensing_Num) as price FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  Zone_ID=%%s AND  key_time BETWEEN %%s AND %%s  AND Antimicrobial= 1) rlt
全院患者使用中药饮片费用:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`opt_recipe_drug` t1 WHERE t1.zone_id=%%s AND key_time BETWEEN %%s AND %%s AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t3.drug_code LIKE '001002001%%' and t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`ipt_drug` t1 WHERE t1.zone_id=%%s  AND key_time BETWEEN %%s AND %%s AND t1.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t3.drug_code LIKE '001002001%%' and t2.is_ignore =0)) AS rlt
全院患者使用数量:select sum(num) from (SELECT SUM(Despensing_Num) as num  FROM %(dbname_dp)s.`ipt_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s union SELECT SUM(Despensing_Num) as num FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s) as rlt
医疗总收入:select sum(money) from (SELECT sum(Fee_Total) as money FROM %(dbname_dp)s.`opt_fee` where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s union all SELECT sum(Fee_Total) as money FROM %(dbname_dp)s.`ipt_inpatient` where Zone_ID=%%s and Key_Time BETWEEN %%s and %%s) as rlt

#缺省维度+科室 全院指标及对应的SQL
[hospital_dept]
全院患者抗菌药物累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.Dept_Id=%%s AND t1.Antimicrobial = 1 AND t1.key_time BETWEEN %%s AND %%s  UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND t4.Out_Dept_Code=%%s AND t1.Antimicrobial = 1  AND t1.key_time BETWEEN %%s AND %%s) rlt
全院患者药品累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.Dept_Id=%%s AND t1.key_time BETWEEN %%s AND %%s  UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND  t4.Out_Dept_Code=%%s AND t1.key_time BETWEEN %%s AND %%s) rlt
全院患者使用西药药品累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s AND  t4.Dept_Id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001003%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND  t4.Out_Dept_Code=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001003%%') rlt
全院患者使用中成药总品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s AND t4.Dept_Id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002002%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND  t4.Out_Dept_Code=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002002%%') rlt
全院患者使用中药饮片总品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s AND t4.Dept_Id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002001%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND t4.Out_Dept_Code=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002001%%') rlt
全院患者使用抗菌药物累计品规数:SELECT COUNT(distinct(drug_id)) FROM  (SELECT  t2.drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t2 inner join %(dbname_dp)s.`opt_recipe` t3 on t2.recipe_id = t3.recipe_id  WHERE t2.Zone_ID = %%s and t2.dept_id = %%s AND t2.key_time BETWEEN %%s AND %%s AND t2.Antimicrobial = 1  UNION ALL  SELECT  t.drug_id  FROM  %(dbname_dp)s.`ipt_drug` t inner join %(dbname_dp)s.ipt_inpatient t1 on t.event_no = t1.event_no  WHERE t.Zone_ID = %%s AND t1.Out_Dept_Code = %%s AND t.key_time BETWEEN %%s AND %%s   AND t.Antimicrobial = 1) rlt
全院患者使用口服剂型抗菌药物品规数:SELECT COUNT(distinct(drug_id)) FROM  (SELECT  t2.drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t2 inner join %(dbname_dp)s.`opt_recipe` t3 on t2.recipe_id = t3.recipe_id   WHERE t2.Zone_ID = %%s AND t3.dept_id = %%s AND t2.key_time BETWEEN %%s AND %%s AND t2.Antimicrobial = 1 AND t2.Drug_Admin_Route_Name='消化道全身给药' UNION ALL  SELECT  drug_id  FROM  %(dbname_dp)s.`ipt_drug` t inner join %(dbname_dp)s.ipt_inpatient t1 on t.event_no = t1.event_no WHERE t.Zone_ID = %%s AND t1.Out_Dept_Code = %%s AND t.key_time BETWEEN %%s AND %%s   AND t.Antimicrobial = 1 AND t.Drug_Admin_Route_Name='消化道全身给药') rlt
全院患者使用注射剂型抗菌药物品规数:SELECT COUNT(distinct(drug_id)) FROM  (SELECT  t2.drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t2 inner join %(dbname_dp)s.`opt_recipe` t3 on t2.recipe_id = t3.recipe_id   WHERE t2.Zone_ID = %%s AND t3.Dept_Id = %%s AND t2.key_time BETWEEN %%s AND %%s AND t2.Antimicrobial = 1 AND t2.Drug_Admin_Route_Name='非消化道全身给药' UNION ALL  SELECT  t.drug_id  FROM  %(dbname_dp)s.`ipt_drug` t inner join %(dbname_dp)s.ipt_inpatient t1 on t.event_no = t1.event_no  WHERE t.Zone_ID = %%s AND t1.Out_Dept_Code = %%s AND t.key_time BETWEEN %%s AND %%s   AND t.Antimicrobial = 1 AND t.Drug_Admin_Route_Name='非消化道全身给药') rlt
全院使用头霉素类抗菌药物品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug`  t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001004%%') AND t0.Antimicrobial=1 AND t0.Zone_ID = %%s t.Out_Dept_Code = %%s AND t0.key_time BETWEEN %%s AND %%s UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN  (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001004%%')  AND t4.Zone_ID =%%s AND t5.Dept_Id = %%s AND t4.key_time BETWEEN %%s AND %%s AND t4.Antimicrobial=1) rlt
全院患者使用三代及四代头孢菌素注射剂型品规数:#SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT DISTINCT(t0.drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` t0 inner join %(dbname_dp)s.`opt_recipe` t on t0.recipe_id = t.recipe_id WHERE t0.Antimicrobial=1 AND t0.Drug_Admin_Route_Name='非消化道全身给药' AND t0.Zone_ID = %%s AND t.dept_id = %%s AND t0.key_time BETWEEN %%s AND %%s  AND t0.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.`map_product_id`=t3.product_id WHERE drug_code LIKE '001003001007001002003%%' OR drug_code LIKE '001003001007001002004%%' )UNION ALL SELECT DISTINCT(t4.drug_id) FROM %(dbname_dp)s.`ipt_drug` t4 inner join %(dbname_dp)s.ipt_inpatient t5 on t4.event_no = t5.event_no WHERE t4.Antimicrobial=1 AND t4.Drug_Admin_Route_Name='非消化道全身给药' AND t4.Zone_ID = %%s AND t5.Out_Dept_Code = %%s AND t4.key_time BETWEEN %%s AND %%s AND t4.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.`map_product_id`=t3.product_id WHERE drug_code LIKE '001003001007001002003%%' OR drug_code LIKE '001003001007001002004%%' )) rlt
全院患者使用三代及四代头孢菌素口服剂型品规数:SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT DISTINCT(t0.drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` t0 inner join %(dbname_dp)s.`opt_recipe` t on t0.recipe_id = t.recipe_id WHERE t0.Antimicrobial=1 AND t0.Drug_Admin_Route_Name='消化道全身给药' AND t0.Zone_ID = %%s AND t.dept_id = %%s AND t0.key_time BETWEEN %%s AND %%s  AND t0.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.`map_product_id`=t3.product_id WHERE drug_code LIKE '001003001007001002003%%' OR drug_code LIKE '001003001007001002004%%' )UNION ALL SELECT DISTINCT(t4.drug_id) FROM %(dbname_dp)s.`ipt_drug` t4 inner join %(dbname_dp)s.ipt_inpatient t5 on t4.event_no = t5.event_no  WHERE t4.Antimicrobial=1 AND t4.Drug_Admin_Route_Name='消化道全身给药' AND t4.Zone_ID = %%s AND t5.Out_Dept_Code = %%s AND t4.key_time BETWEEN %%s AND %%s AND t4.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.`map_product_id`=t3.product_id WHERE drug_code LIKE '001003001007001002003%%' OR drug_code LIKE '001003001007001002004%%' )) rlt
全院碳青霉烯类注射剂型品规数:SELECT COUNT(distinct(drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.ipt_drug t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug`t2 ON t1.map_product_id=t2.product_id WHERE t2.drug_code LIKE '001003001007001004002%%')  AND t0.Drug_Admin_Route_Name='非消化道全身给药' and t0.Zone_ID = %%s AND t.Out_Dept_Code = %%s AND t0.key_time BETWEEN %%s AND %%s UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.opt_recipe_drug t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id  WHERE t4.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug`t2 ON t1.map_product_id=t2.product_id WHERE t2.drug_code LIKE '001003001007001004002%%') AND  t4.Drug_Admin_Route_Name='非消化道全身给药' and   t4.Zone_ID = %%s AND Dept_Id =%%s AND t4.key_time BETWEEN %%s AND %%s) rlt
全院氟喹诺酮类口服剂型品规数:SELECT COUNT(distinct(drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or t2.drug_code LIKE '001003001007001002004%%') AND t0.Antimicrobial=1 AND t0.Drug_Admin_Route_Name='消化道全身给药' and t0.Zone_ID = %%s AND t.Out_Dept_Code= %%s AND t0.key_time BETWEEN %%s AND %%s UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or drug_code LIKE '001003001007001002004%%' and  Zone_ID = %%s AND key_time BETWEEN %%s AND %%s) AND t4.Antimicrobial=1 AND Dept_Id =%%s t4.Drug_Admin_Route_Name='消化道全身给药') rlt
全院氟喹诺酮类注射剂型品规数:SELECT COUNT(distinct(drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or t2.drug_code LIKE '001003001007001002004%%') AND t0.Antimicrobial=1 AND t0.Drug_Admin_Route_Name='非消化道全身给药' and t0.Zone_ID = %%s AND t.Out_Dept_Code= %%s AND t0.key_time BETWEEN %%s AND %%s UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or drug_code LIKE '001003001007001002004%%' and  Zone_ID = %%s AND key_time BETWEEN %%s AND %%s) AND t4.Antimicrobial=1 AND Dept_Id =%%s AND t4.Drug_Admin_Route_Name='非消化道全身给药') rlt
全院患者使用药品总品规数:SELECT COUNT(DISTINCT(drug_id)) FROM  (SELECT  t0.drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t0 inner join %(dbname_dp)s.`opt_recipe` t on t0.recipe_id = t.recipe_id  WHERE t0.Zone_ID = %%s AND t.Dept_Id = %%s AND t0.key_time BETWEEN %%s AND %%s  UNION ALL  SELECT  t1.drug_id  FROM  %(dbname_dp)s.`ipt_drug` t1 inner join %(dbname_dp)s.ipt_inpatient t2 on t1.event_no = t2.event_no WHERE t1.Zone_ID =%%s AND t2.Out_Dept_Code = %%s AND t1.key_time BETWEEN %%s AND %%s  ) rlt
全院患者使用西药药品总品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN  (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001003%%') AND t0.Zone_ID =%%s AND t.Out_Dept_Code AND t0.key_time BETWEEN %%s AND %%s   UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN  (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001003%%') AND t4.Zone_ID =%%s AND t5.dept_id=%%s AND t4.key_time BETWEEN %%s AND %%s ) rlt
全院患者使用中成药总品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN  (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001002002%%') AND t0.Zone_ID =%%s AND Out_Dept_Code=%%s AND t0.key_time BETWEEN %%s AND %%s   UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN  (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001002002%%') AND t4.Zone_ID =%%s AND t5.dept_id=%%s AND t4.key_time BETWEEN %%s AND %%s ) rlt
医疗药品总收入:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`opt_recipe_drug` t1 inner join %(dbname_dp)s.`opt_recipe` t0 on t1.recipe_id = t0.recipe_id WHERE t1.zone_id=%%s AND t0.Dept_Id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE  t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`ipt_drug` t1 inner join %(dbname_dp)s.ipt_inpatient t3 on t1.event_no = t3.event_no WHERE t1.zone_id=%%s  AND t3.Out_Dept_Code=%%s AND t1.key_time BETWEEN %%s AND %%s AND t1.drug_id  IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE  t2.is_ignore =0)) AS rlt
国家基药目录品种使用金额:select sum(Total_Money) from (SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.opt_recipe_drug t0 inner join %(dbname_dp)s.`opt_recipe` t on t0.recipe_id = t.recipe_id WHERE t0.Zone_Id = %%s AND Dept_Id=%%s AND t0.Key_Time between %%s and %%s AND t0.base_drug IN (1) UNION ALL SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.ipt_drug t3 inner join %(dbname_dp)s.ipt_inpatient t4 on t3.event_no = t4.event_no WHERE t3.Zone_Id = %%s AND t4.Out_Dept_Code=%%s AND t3.Key_Time between %%s and %%s AND t3.base_drug IN (1)) rlt
全院抗菌药物使用金额:SELECT SUM(price) from (SELECT SUM(price * Despensing_Num) as price FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE  t0.Zone_ID=%%s AND t.Out_Dept_Code=%%s AND t0.key_time BETWEEN %%s AND %%s  AND t0.Antimicrobial= 1 UNION ALL SELECT SUM(price * Despensing_Num) as price FROM %(dbname_dp)s.`opt_recipe_drug` t3 inner join %(dbname_dp)s.`opt_recipe` t4 on t3.recipe_id = t4.recipe_id WHERE  t3.Zone_ID=%%s AND t4.Dept_Id=%%s AND t3.key_time BETWEEN %%s AND %%s  AND t3.Antimicrobial= 1) rlt
全院患者使用中药饮片费用:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`opt_recipe_drug` t1 inner join %(dbname_dp)s.`opt_recipe` t on t1.recipe_id = t.recipe_id WHERE t1.zone_id=%%s AND Dept_Id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t3.drug_code LIKE '001002001%%' and t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`ipt_drug` t1 inner join %(dbname_dp)s.ipt_inpatient t5 on t1.event_no = t5.event_no WHERE t1.zone_id=%%s AND t5.Out_Dept_Code=%%s AND t1.key_time BETWEEN %%s AND %%s AND t1.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t3.drug_code LIKE '001002001%%' and t2.is_ignore =0)) AS rlt

#缺省维度+科室 全院指标及对应的SQL
[hospital_doc]
全院患者抗菌药物累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_doc_id=%%s AND t1.Antimicrobial = 1 AND t1.key_time BETWEEN %%s AND %%s  UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND t1.Order_Doc_ID=%%s AND t1.Antimicrobial = 1  AND t1.key_time BETWEEN %%s AND %%s) rlt
全院患者药品累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s  AND t4.recipe_doc_id=%%s AND t1.key_time BETWEEN %%s AND %%s  UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND  t1.Order_Doc_ID=%%s AND t1.key_time BETWEEN %%s AND %%s) rlt
全院患者使用西药药品累计品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s AND  t4.recipe_doc_id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001003%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND  t1.Order_Doc_ID=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001003%%') rlt
全院患者使用中成药总品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s AND t4.recipe_doc_id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002002%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND  t1.Order_Doc_ID=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002002%%') rlt
全院患者使用中药饮片总品种数:SELECT COUNT(DISTINCT (drug_name)) FROM (SELECT t3.drug_name FROM %(dbname_dp)s.`opt_recipe_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2  ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`opt_recipe` t4  ON t1.recipe_id = t4.recipe_id  WHERE t1.Zone_ID = %%s AND t4.recipe_doc_id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002001%%' UNION ALL SELECT t3.drug_name  FROM  %(dbname_dp)s.`ipt_drug` t1  INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3  ON t2.map_product_id = t3.product_id  INNER JOIN %(dbname_dp)s.`ipt_inpatient` t4  ON t1.event_no = t4.event_no  WHERE t1.Zone_ID = %%s AND t1.Order_Doc_ID=%%s AND t1.key_time BETWEEN %%s AND %%s AND t3.`drug_code` LIKE '001002001%%') rlt
全院患者使用抗菌药物累计品规数:SELECT COUNT(distinct(drug_id)) FROM  (SELECT  t2.drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t2 inner join %(dbname_dp)s.`opt_recipe` t3 on t2.recipe_id = t3.recipe_id  WHERE t2.Zone_ID = %%s and t2.recipe_doc_id=%%s AND t2.key_time BETWEEN %%s AND %%s AND t2.Antimicrobial = 1  UNION ALL  SELECT  t.drug_id  FROM  %(dbname_dp)s.`ipt_drug` t inner join %(dbname_dp)s.ipt_inpatient t1 on t.event_no = t1.event_no  WHERE t.Zone_ID = %%s AND t.Order_Doc_ID=%%s AND t.key_time BETWEEN %%s AND %%s   AND t.Antimicrobial = 1) rlt
全院患者使用口服剂型抗菌药物品规数:SELECT COUNT(distinct(drug_id)) FROM  (SELECT  t2.drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t2 inner join %(dbname_dp)s.`opt_recipe` t3 on t2.recipe_id = t3.recipe_id   WHERE t2.Zone_ID = %%s AND t3.recipe_doc_id=%%s AND t2.key_time BETWEEN %%s AND %%s AND t2.Antimicrobial = 1 AND t2.Drug_Admin_Route_Name='消化道全身给药' UNION ALL  SELECT  drug_id  FROM  %(dbname_dp)s.`ipt_drug` t inner join %(dbname_dp)s.ipt_inpatient t1 on t.event_no = t1.event_no WHERE t.Zone_ID = %%s AND t.Order_Doc_ID=%%s AND t.key_time BETWEEN %%s AND %%s   AND t.Antimicrobial = 1 AND t.Drug_Admin_Route_Name='消化道全身给药') rlt
全院患者使用注射剂型抗菌药物品规数:SELECT COUNT(distinct(drug_id)) FROM  (SELECT  t2.drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t2 inner join %(dbname_dp)s.`opt_recipe` t3 on t2.recipe_id = t3.recipe_id   WHERE t2.Zone_ID = %%s AND t3.recipe_doc_id=%%s AND t2.key_time BETWEEN %%s AND %%s AND t2.Antimicrobial = 1 AND t2.Drug_Admin_Route_Name='非消化道全身给药' UNION ALL  SELECT  t.drug_id  FROM  %(dbname_dp)s.`ipt_drug` t inner join %(dbname_dp)s.ipt_inpatient t1 on t.event_no = t1.event_no  WHERE t.Zone_ID = %%s AND t.Order_Doc_ID=%%s AND t.key_time BETWEEN %%s AND %%s   AND t.Antimicrobial = 1 AND t.Drug_Admin_Route_Name='非消化道全身给药') rlt
全院使用头霉素类抗菌药物品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug`  t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001004%%') AND t0.Antimicrobial=1 AND t0.Zone_ID = %%s t0.Order_Doc_ID=%%s AND t0.key_time BETWEEN %%s AND %%s UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN  (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001004%%')  AND t4.Zone_ID =%%s AND t5.recipe_doc_id=%%s = %%s AND t4.key_time BETWEEN %%s AND %%s AND t4.Antimicrobial=1) rlt
全院患者使用三代及四代头孢菌素注射剂型品规数:#SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT DISTINCT(t0.drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` t0 inner join %(dbname_dp)s.`opt_recipe` t on t0.recipe_id = t.recipe_id WHERE t0.Antimicrobial=1 AND t0.Drug_Admin_Route_Name='非消化道全身给药' AND t0.Zone_ID = %%s AND t.recipe_doc_id=%%s = %%s AND t0.key_time BETWEEN %%s AND %%s  AND t0.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.`map_product_id`=t3.product_id WHERE drug_code LIKE '001003001007001002003%%' OR drug_code LIKE '001003001007001002004%%' )UNION ALL SELECT DISTINCT(t4.drug_id) FROM %(dbname_dp)s.`ipt_drug` t4 inner join %(dbname_dp)s.ipt_inpatient t5 on t4.event_no = t5.event_no WHERE t4.Antimicrobial=1 AND t4.Drug_Admin_Route_Name='非消化道全身给药' AND t4.Zone_ID = %%s AND t4.Order_Doc_ID=%%s AND t4.key_time BETWEEN %%s AND %%s AND t4.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.`map_product_id`=t3.product_id WHERE drug_code LIKE '001003001007001002003%%' OR drug_code LIKE '001003001007001002004%%' )) rlt
全院患者使用三代及四代头孢菌素口服剂型品规数:SELECT COUNT(DISTINCT(drug_id)) FROM (SELECT DISTINCT(t0.drug_id) FROM %(dbname_dp)s.`opt_recipe_drug` t0 inner join %(dbname_dp)s.`opt_recipe` t on t0.recipe_id = t.recipe_id WHERE t0.Antimicrobial=1 AND t0.Drug_Admin_Route_Name='消化道全身给药' AND t0.Zone_ID = %%s AND t.recipe_doc_id=%%s AND t0.key_time BETWEEN %%s AND %%s  AND t0.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.`map_product_id`=t3.product_id WHERE drug_code LIKE '001003001007001002003%%' OR drug_code LIKE '001003001007001002004%%' )UNION ALL SELECT DISTINCT(t4.drug_id) FROM %(dbname_dp)s.`ipt_drug` t4 inner join %(dbname_dp)s.ipt_inpatient t5 on t4.event_no = t5.event_no  WHERE t4.Antimicrobial=1 AND t4.Drug_Admin_Route_Name='消化道全身给药' AND t4.Zone_ID = %%s AND t4.Order_Doc_ID=%%s AND t4.key_time BETWEEN %%s AND %%s AND t4.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.`map_product_id`=t3.product_id WHERE drug_code LIKE '001003001007001002003%%' OR drug_code LIKE '001003001007001002004%%' )) rlt
全院碳青霉烯类注射剂型品规数:SELECT COUNT(distinct(drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.ipt_drug t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug`t2 ON t1.map_product_id=t2.product_id WHERE t2.drug_code LIKE '001003001007001004002%%')  AND t0.Drug_Admin_Route_Name='非消化道全身给药' and t0.Zone_ID = %%s AND t0.Order_Doc_ID=%%s AND t0.key_time BETWEEN %%s AND %%s UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.opt_recipe_drug t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id  WHERE t4.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug`t2 ON t1.map_product_id=t2.product_id WHERE t2.drug_code LIKE '001003001007001004002%%') AND  t4.Drug_Admin_Route_Name='非消化道全身给药' and   t4.Zone_ID = %%s AND recipe_doc_id=%%s AND t4.key_time BETWEEN %%s AND %%s) rlt
全院氟喹诺酮类口服剂型品规数:SELECT COUNT(distinct(drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or t2.drug_code LIKE '001003001007001002004%%') AND t0.Antimicrobial=1 AND t0.Drug_Admin_Route_Name='消化道全身给药' and t0.Zone_ID = %%s AND t0.Order_Doc_ID=%%s AND t0.key_time BETWEEN %%s AND %%s UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or drug_code LIKE '001003001007001002004%%' and  Zone_ID = %%s AND recipe_doc_id=%%s AND key_time BETWEEN %%s AND %%s) AND t4.Antimicrobial=1  t4.Drug_Admin_Route_Name='消化道全身给药') rlt
全院氟喹诺酮类注射剂型品规数:SELECT COUNT(distinct(drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or t2.drug_code LIKE '001003001007001002004%%') AND t0.Antimicrobial=1 AND t0.Drug_Admin_Route_Name='非消化道全身给药' and t0.Zone_ID = %%s AND t0.Order_Doc_ID=%%s AND t0.key_time BETWEEN %%s AND %%s UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN (SELECT t1.product_id FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2 ON t1.`map_product_id`=t2.`product_id` WHERE t2.`drug_code` LIKE '001003001007001002003%%' or drug_code LIKE '001003001007001002004%%' and  Zone_ID = %%s AND key_time BETWEEN %%s AND %%s) AND t4.Antimicrobial=1 AND recipe_doc_id=%%s AND t4.Drug_Admin_Route_Name='非消化道全身给药') rlt
全院患者使用药品总品规数:SELECT COUNT(DISTINCT(drug_id)) FROM  (SELECT  t0.drug_id   FROM  %(dbname_dp)s.`opt_recipe_drug` t0 inner join %(dbname_dp)s.`opt_recipe` t on t0.recipe_id = t.recipe_id  WHERE t0.Zone_ID = %%s AND t.recipe_doc_id=%%s AND t0.key_time BETWEEN %%s AND %%s  UNION ALL  SELECT  t1.drug_id  FROM  %(dbname_dp)s.`ipt_drug` t1 inner join %(dbname_dp)s.ipt_inpatient t2 on t1.event_no = t2.event_no WHERE t1.Zone_ID =%%s AND t1.Order_Doc_ID=%%s AND t1.key_time BETWEEN %%s AND %%s  ) rlt
全院患者使用西药药品总品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN  (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001003%%') AND t0.Zone_ID =%%s AND t0.Order_Doc_ID=%%s AND t0.key_time BETWEEN %%s AND %%s   UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN  (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001003%%') AND t4.Zone_ID =%%s AND t5.recipe_doc_id=%%s AND t4.key_time BETWEEN %%s AND %%s ) rlt
全院患者使用中成药总品规数:SELECT COUNT(DISTINCT (drug_id)) FROM (SELECT t0.drug_id FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE t0.drug_id IN  (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001002002%%') AND t0.Zone_ID =%%s AND t0.Order_Doc_ID=%%s AND t0.key_time BETWEEN %%s AND %%s   UNION ALL SELECT t4.drug_id FROM %(dbname_dp)s.`opt_recipe_drug` t4 inner join %(dbname_dp)s.`opt_recipe` t5 on t4.recipe_id = t5.recipe_id WHERE t4.drug_id IN  (SELECT  t1.product_id  FROM %(dbname_knowledge)s.`base_product` t1 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t2 ON t1. map_product_id =t2.product_id WHERE t2.drug_code  LIKE '001002002%%') AND t4.Zone_ID =%%s AND t5.recipe_doc_id=%%s AND t4.key_time BETWEEN %%s AND %%s ) rlt
医疗药品总收入:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`opt_recipe_drug` t1 inner join %(dbname_dp)s.`opt_recipe` t0 on t1.recipe_id = t0.recipe_id WHERE t1.zone_id=%%s AND t0.recipe_doc_id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE  t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`ipt_drug` t1 inner join %(dbname_dp)s.ipt_inpatient t3 on t1.event_no = t3.event_no WHERE t1.zone_id=%%s  AND t1.Order_Doc_ID=%%s AND t1.key_time BETWEEN %%s AND %%s AND t1.drug_id  IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE  t2.is_ignore =0)) AS rlt
国家基药目录品种使用金额:select sum(Total_Money) from (SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.opt_recipe_drug t0 inner join %(dbname_dp)s.`opt_recipe` t on t0.recipe_id = t.recipe_id WHERE t0.Zone_Id = %%s AND t.recipe_doc_id=%%s AND t0.Key_Time between %%s and %%s AND t0.base_drug IN (1) UNION ALL SELECT SUM(Price*Despensing_Num) AS Total_Money FROM %(dbname_dp)s.ipt_drug t3 inner join %(dbname_dp)s.ipt_inpatient t4 on t3.event_no = t4.event_no WHERE t3.Zone_Id = %%s AND t3.Order_Doc_ID=%%s AND t3.Key_Time between %%s and %%s AND t3.base_drug IN (1)) rlt
全院抗菌药物使用金额:SELECT SUM(price) from (SELECT SUM(price * Despensing_Num) as price FROM %(dbname_dp)s.`ipt_drug` t0 inner join %(dbname_dp)s.ipt_inpatient t on t0.event_no = t.event_no WHERE  t0.Zone_ID=%%s AND t0.Order_Doc_ID=%%s AND t0.key_time BETWEEN %%s AND %%s  AND t0.Antimicrobial= 1 UNION ALL SELECT SUM(price * Despensing_Num) as price FROM %(dbname_dp)s.`opt_recipe_drug` t3 inner join %(dbname_dp)s.`opt_recipe` t4 on t3.recipe_id = t4.recipe_id WHERE  t3.Zone_ID=%%s AND t4.recipe_doc_id=%%s AND t3.key_time BETWEEN %%s AND %%s  AND t3.Antimicrobial= 1) rlt
全院患者使用中药饮片费用:SELECT SUM(price) FROM (SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`opt_recipe_drug` t1 inner join %(dbname_dp)s.`opt_recipe` t on t1.recipe_id = t.recipe_id WHERE t1.zone_id=%%s AND t.recipe_doc_id=%%s AND t1.key_time BETWEEN %%s AND %%s AND t1.drug_id  IN(SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t3.drug_code LIKE '001002001%%' and t2.is_ignore =0 )UNION ALL SELECT SUM(Price*Despensing_Num) price FROM %(dbname_dp)s.`ipt_drug` t1 inner join %(dbname_dp)s.ipt_inpatient t5 on t1.event_no = t5.event_no WHERE t1.zone_id=%%s AND t1.Order_Doc_ID=%%s AND t1.key_time BETWEEN %%s AND %%s AND t1.drug_id IN (SELECT t2.product_id FROM %(dbname_knowledge)s.`base_product` t2 INNER JOIN   %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id=t3.product_id WHERE t3.drug_code LIKE '001002001%%' and t2.is_ignore =0)) AS rlt

#药品维度+机构下的指标及对应的SQL
[drug_zone]
self_values:SELECT product_id,ddd,ddd_unit,trans_spec,trans_spec_unit FROM %(dbname_knowledge)s.tb_product_self
门诊药品使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1   INNER JOIN %(dbname_dp)s.`opt_recipe` t2     ON t1.recipe_id = t2.recipe_id   INNER JOIN %(dbname_knowledge)s.`base_product` t3     ON t1.drug_id = t3.product_id   INNER JOIN %(dbname_knowledge)s.`tb_product` t4     ON t3.map_product_id = t4.id WHERE t1.zone_id =%%s  AND t1.Key_Time BETWEEN %%s  AND %%s  AND t1.Antimicrobial = 1   AND t2.recipe_source = '门诊' and t3.map_product_id=%%s
急诊患者就诊总人次:SELECT COUNT(DISTINCT(Patient_Id)) FROM %(dbname_dp)s.`opt_recipe` WHERE zone_id=%%s AND recipe_source='急诊'AND key_time BETWEEN %%s AND %%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
出院患者总人次:SELECT COUNT(patient_id) FROM %(dbname_dp)s.`ipt_inpatient` WHERE zone_id=%%s AND key_time BETWEEN %%s AND %%s AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
门诊患者使用药物总费用:SELECT SUM(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='门诊') AND key_time BETWEEN %%s AND %%s AND drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)
急诊药品使用量:SELECT t3.`product_id`,t3.`map_product_id`,t1.Count_Unit, t1.Despensing_Num ,t4.enSpecUnit,t4.specquantity , t4.ddd,t4.dddunit FROM  %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_dp)s.`opt_recipe` t2  ON t1.recipe_id =t2.recipe_id  INNER JOIN %(dbname_knowledge)s.`base_product` t3  ON t1.drug_id = t3.product_id  INNER JOIN %(dbname_knowledge)s.`tb_product` t4  ON t3.map_product_id = t4.id  WHERE t1.zone_id = %%s  AND t1.Antimicrobial = 1 AND t1.Key_Time between %%s and %%s  AND t2.recipe_source='急诊' and t3.map_product_id=%%s
急诊患者使用药物总费用:SELECT SUM(price*despensing_num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE zone_id=%%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.opt_recipe WHERE recipe_source='急诊') AND key_time BETWEEN %%s AND %%s AND drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)

全院患者使用处方数:SELECT count(DISTINCT(recipe_id)) FROM %(dbname_dp)s.opt_recipe WHERE	zone_id =%%s AND key_time BETWEEN %%s AND %%s and  recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe_drug where drug_id IN (SELECT product_id	FROM %(dbname_knowledge)s.`base_product` t1	WHERE	t1.`map_product_id` =%%s))
门诊患者使用处方数:SELECT count(DISTINCT(recipe_id)) FROM %(dbname_dp)s.opt_recipe WHERE	zone_id =%%s AND recipe_source = '门诊' AND key_time BETWEEN %%s AND %%s AND recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe_drug where drug_id IN (SELECT product_id	FROM %(dbname_knowledge)s.`base_product` t1	WHERE	t1.`map_product_id` =%%s))
急诊患者使用处方数:SELECT count(DISTINCT(recipe_id)) FROM %(dbname_dp)s.opt_recipe WHERE	zone_id =%%s AND recipe_source = '急诊' AND key_time BETWEEN %%s AND %%s AND recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe_drug where drug_id IN (SELECT product_id	FROM %(dbname_knowledge)s.`base_product` t1	WHERE	t1.`map_product_id` =%%s))
住院患者使用频次:SELECT COUNT(*) AS drugCount FROM	%(dbname_dp)s.`ipt_drug` t WHERE t.Zone_ID = %%s	AND t.Key_Time BETWEEN %%s AND %%s 	AND t.Drug_ID IN (SELECT b.product_id FROM %(dbname_knowledge)s.`base_product` b	WHERE b.map_product_id =%%s)
门诊患者使用频次:SELECT COUNT(*) AS drugCount FROM	%(dbname_dp)s.`opt_recipe_drug` t WHERE t.Zone_ID = %%s	AND t.Key_Time BETWEEN %%s AND %%s 	AND t.Drug_ID IN (SELECT b.product_id FROM %(dbname_knowledge)s.`base_product` b	WHERE b.map_product_id =%%s) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
急诊患者使用频次:SELECT COUNT(*) AS drugCount FROM	%(dbname_dp)s.`opt_recipe_drug` t WHERE t.Zone_ID = %%s	AND t.Key_Time BETWEEN %%s AND %%s 	AND t.Drug_ID IN (SELECT b.product_id FROM %(dbname_knowledge)s.`base_product` b	WHERE b.map_product_id =%%s) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
住院患者使用数量:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`ipt_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s)
门诊患者使用数量:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
急诊患者使用数量:SELECT SUM(Despensing_Num) FROM %(dbname_dp)s.`opt_recipe_drug` WHERE  zone_id=%%s AND key_time BETWEEN %%s AND %%s and drug_id IN (SELECT product_id FROM %(dbname_knowledge)s.`base_product` t1 where t1.`map_product_id`=%%s) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')

住院患者使用药物总费用:SELECT SUM(price * Despensing_Num) FROM  %(dbname_dp)s.`ipt_drug` WHERE  zone_id =%%s AND key_time BETWEEN %%s  AND %%s and drug_id IN (SELECT  t1.product_id  FROM  %(dbname_knowledge)s.`base_product` t1  INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t2  ON t1.`map_product_id` = t2.`product_id`  WHERE t1.`is_ignore` =0 and t1.map_product_id=%%s)
最高处方金额:SELECT MAX(Recipe_Fee_Total) FROM %(dbname_dp)s.`opt_recipe` WHERE Zone_ID =%%s AND Key_Time BETWEEN %%s AND %%s AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.`Drug_ID`=t2.`product_id` WHERE t2.`map_product_id`=%%s)
出院患者最高用药金额:SELECT MAX(drug_money) FROM (SELECT event_no,SUM(price*despensing_num) AS drug_money FROM  %(dbname_dp)s.`ipt_drug`  t1  WHERE t1.zone_id=%%s AND t1.Key_Time BETWEEN %%s AND %%s AND drug_id IN(SELECT product_id FROM %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s) GROUP BY event_no) AS drugmoney
住院不适宜问题发生数:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析'  AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性诊断:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='诊断' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性肾功能:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='肾功能' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性适应症:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='适应症' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性不良反应:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='不良反应' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性过敏:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='过敏' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性配伍:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='配伍' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性用法用量:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='用法用量' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性给药时机:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药时机' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性给药途径:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药途径' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性相互作用:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='相互作用' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性重复用药:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='重复用药' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
住院适宜性特殊人群:SELECT  COUNT(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='特殊人群' AND event_no IN (SELECT event_no FROM %(dbname_dp)s.`ipt_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s))
门诊适宜性诊断:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='诊断' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性适应症:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='适应症' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性不良反应:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='不良反应' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性肾功能:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='肾功能' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性过敏:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='过敏' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性用法用量:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='用法用量' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性配伍:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='配伍' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性给药时机:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药时机' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性相互作用:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='相互作用' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性给药途径:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药途径' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性重复用药:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='重复用药' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊适宜性特殊人群:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='特殊人群' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
门诊不适宜问题发生数:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析'  AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='门诊')
急诊不适宜问题发生数:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析'  AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性诊断:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='诊断' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性适应症:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='适应症' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性不良反应:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='不良反应' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性肾功能:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='肾功能' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性过敏:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='过敏' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性用法用量:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='用法用量' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性配伍:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='配伍' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性给药时机:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药时机' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性相互作用:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='相互作用' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性给药途径:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='给药途径' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性重复用药:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='重复用药' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')
急诊适宜性特殊人群:SELECT  COUNT(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 WHERE t1.message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2   WHERE t2.check_status IN (0, 1))  AND zone_id = %%s  AND t1.key_date BETWEEN %%s  AND %%s  AND t1.analysis_type='适宜性分析' AND t1.`analysis_result_type`='特殊人群' AND recipe_id IN (SELECT recipe_id FROM %(dbname_dp)s.`opt_recipe_drug` WHERE drug_id IN (SELECT product_id FROM  %(dbname_knowledge)s.`base_product` WHERE map_product_id=%%s)) and recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe where recipe_source='急诊')



#药品维度下标准产品的属性
[drug_productInfor]
规格:SELECT chineseSpecification FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
剂型:SELECT formulation FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
生产厂家:SELECT chineseManufactureName FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
DDD值:SELECT ddd FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
DDD单位:SELECT dddUnit FROM %(dbname_knowledge)s.`tb_product` WHERE id=%%s
产品编号:select id from %(dbname_knowledge)s.`tb_product` WHERE id=%%s


#手术维度+机构下的指标及对应的SQL
[operation_zone]
出院患者预防使用抗菌药物手术例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND t1.Zone_ID = %%s AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.key_time between %%s and %%s  AND Operation_code regexp %%s
总手术例次: SELECT COUNT(DISTINCT(operation_no)) FROM %(dbname_dp)s.`ipt_operation` WHERE zone_id=%%s AND key_time BETWEEN %%s AND %%s  AND Operation_code regexp %%s
I类切口手术预防使用抗菌药物例次:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation`  t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 USING(Event_No) WHERE  t1.Zone_ID = %%s  AND t1.Operation_Cut_Type = 'Ⅰ' AND t2.`Antimicrobial` = '1' AND t2.Drug_Using_Aim = '预防' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -72 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) and t1.key_time between %%s and %%s AND Operation_code regexp %%s
术前24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s  AND ((TIME_TO_SEC(TIMEDIFF(operation_start_time,Invalid_Time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(operation_start_time,valid_time))>0*60*60)) and t2.key_time between %%s and %%s AND Operation_code regexp %%s
术后24h内使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM  %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1 AND t1.`Operation_Cut_Type` ='Ⅰ'  AND t2.zone_id = %%s  AND ((TIME_TO_SEC(TIMEDIFF(valid_time,operation_end_time)) < 24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>0*60*60)) and t2.key_time between %%s and %%s AND Operation_code regexp %%s
术后使用抗菌药物例数:SELECT COUNT(DISTINCT(t1.operation_no)) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.`Event_No` = t2.`Event_No` WHERE t2.`Antimicrobial` = 1   AND t1.`Operation_Cut_Type` = 'Ⅰ' AND t2.zone_id=%%s AND t2.key_time between %%s and %%s AND ((TIME_TO_SEC(TIMEDIFF(invalid_time,operation_end_time))>=0*60*60)) AND Operation_code regexp %%s
I类切口手术预防使用抗菌药物时间≤24小时:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1 INNER JOIN %(dbname_dp)s.`ipt_drug` t2 ON t1.Event_No = t2.Event_No  WHERE t2.Antimicrobial =1 AND t1.Operation_Cut_Type='Ⅰ' AND ((TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) >=  -24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(Valid_Time,Operation_Start_Time)) <= 24 * 60 * 60)) AND t1.Zone_ID = %%s AND t1.Key_Time between %%s and %%s AND t2.Drug_Using_Aim = '预防' AND Operation_code regexp %%s
I类切口预防用抗菌药物时间>24h且≤48h例数:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >24 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 48 * 60 * 60)) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防' AND Operation_code regexp %%s
I类切口预防用抗菌药物时间>48h且≤72h例数:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >48 * 60 * 60 AND TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) <= 72 * 60 * 60)) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防' AND Operation_code regexp %%s
I类切口预防用抗菌药物>72h例数:SELECT COUNT(DISTINCT t1.Operation_No) FROM %(dbname_dp)s.`ipt_operation` t1  INNER JOIN %(dbname_dp)s.`ipt_drug` t2  ON t1.Event_No = t2.Event_No  AND t1.Operation_Cut_Type = 'Ⅰ' WHERE t2.Antimicrobial = 1  AND ((TIME_TO_SEC(TIMEDIFF(invalid_Time,Operation_Start_Time)) >72 * 60 * 60 )) AND t1.Zone_ID = %%s  AND t1.Key_Time BETWEEN %%s AND %%s AND t2.Drug_Using_Aim = '预防' AND Operation_code regexp %%s

#警示维度+机构下的指标及对应的SQL
[message_zone]:
住院三级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=3  and key_date between %%s and %%s  AND  t1.analysis_result_type=%%s
住院四级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=4  and key_date between %%s and %%s  AND  t1.analysis_result_type=%%s
住院五级警示信息人次数:SELECT COUNT(DISTINCT(event_no)) FROM %(dbname_dp)s.`ipt_alertmessage` t1 WHERE message_id IN (SELECT long_id FROM %(dbname_knowledge)s.`engine_rule_message` t2 WHERE t2.check_status IN (0,1)) AND zone_id=%%s AND t1.severity=5  and key_date between %%s and %%s  AND  t1.analysis_result_type=%%s
门诊三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and t1.key_date between %%s and %%s AND  t1.analysis_result_type=%%s
门诊四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and t1.key_date between %%s and %%s AND  t1.analysis_result_type=%%s
门诊五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and t1.key_date between %%s and %%s AND  t1.analysis_result_type=%%s
门诊所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`opt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s  and t1.key_date between %%s and %%s AND  t1.analysis_result_type=%%s
住院三级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and t1.key_date between %%s and %%s and t1.analysis_result_type=%%s
住院四级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and t1.key_date between %%s and %%s and  t1.analysis_result_type=%%s
住院五级警示信息发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and t1.key_date between %%s and %%s and t1.analysis_result_type=%%s
住院所有警示等级发生次数:SELECT count(*) FROM %(dbname_dp)s.`ipt_alertmessage` t1 where t1.message_id in (select long_id from  %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.key_date between %%s and %%s and  t1.analysis_result_type=%%s
#门诊三级警示信息发生次数占比:
#门诊四级警示信息发生次数占比:
#门诊五级警示信息发生次数占比:
#住院三级警示信息发生次数占比:
#住院四级警示信息发生次数占比:
#住院五级警示信息发生次数占比:
三级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=3 and key_date between %%s and %%s and  t1.analysis_result_type=%%s
四级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=4 and key_date between %%s and %%s and  t1.analysis_result_type=%%s
五级警示信息发生处方数:select count(distinct(recipe_id)) FROM %(dbname_dp)s.`opt_alertmessage` t1 where message_id in (select long_id from %(dbname_knowledge)s.`engine_rule_message` t2 where t2.check_status in (0,1)) and zone_id=%%s and t1.severity=5 and key_date between %%s and %%s and  t1.analysis_result_type=%%s
#三级警示信息发生处方占比:
#四级警示信息发生处方占比:
#五级警示信息发生处方占比:

[定制报表]
药品金额超过N元的药品:SELECT zone_id,recipe_id,drug_name,key_time,price,Despensing_num, price*Despensing_num AS prices FROM `opt_recipe_drug` WHERE zone_id=24 AND key_time='2014-08-01' GROUP BY recipe_id,drug_name HAVING price*Despensing_num>9000
药品品种数超过N种的处方数量:select count(DISTINCT(recipe_id)) from(SELECT	t1.recipe_id,count(distinct(t3.drug_name)) as num FROM	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE	t1.Zone_ID = 328 AND t1.key_time BETWEEN '2014-08-01' AND '2014-08-01' GROUP BY t1.recipe_id having num>0) as rlt
药品品种数超过N种的处方号及品种数:SELECT t1.recipe_id,count(distinct(t3.drug_name)) as num FROM	%(dbname_dp)s.`opt_recipe_drug` t1 INNER JOIN %(dbname_knowledge)s.`base_product` t2 ON t1.drug_id = t2.product_id INNER JOIN %(dbname_knowledge)s.`tb_product_drug` t3 ON t2.map_product_id = t3.product_id WHERE	t1.Zone_ID = 328 AND t1.key_time BETWEEN '2014-08-01' AND '2014-08-01' GROUP BY t1.recipe_id having num>0
日均金额:处方包含指定药品的金额总和/包含指定药品的处方数
处方占比:超过日均金额的处方数/总处方数
处方包含指定药品的金额总和:select sum(prices) from (SELECT	zone_id,recipe_id,drug_name,key_time,price * Despensing_num AS prices FROM	353_dp.`opt_recipe_drug` WHERE	zone_id = 328 AND key_time = '2014-08-01' GROUP BY	recipe_id,	drug_name having Drug_Name='0.9%氯化钠注射液') as rlt
包含指定药品的处方数:select count(recipe_id) FROM %(dbname_dp)s.opt_recipe  where recipe_id in (select recipe_id FROM %(dbname_dp)s.opt_recipe_drug where Drug_Name='0.9%氯化钠注射液') and zone_id=328 and key_time='2014-08-01'
